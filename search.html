<!doctype html><html class="han-la"><head><link rel="manifest" href="/manifest.json"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="renderer" content="webkit"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#16a085"><meta name="description" content="Search"><meta name="keywords" content="Sora酱,Sora酱的博客,あかねぞら,typecho,动漫,番剧"><title>Search | あかねぞら</title><link rel="icon shortcut" type="image/ico" href="/favicon.ico"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/assets/app.css?v=8d1df858eb15fc61"><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="あかねぞら" type="application/atom+xml"></head><body><div id="pjax-container"><header class="container"><a href="/"><h1 style="color:#34495e">あかねぞら</h1></a><p class="description">=w=</p><hr></header><div class="container" id="main-search"><form action="/search.html"><p><input type="search" placeholder="Search anything here~" name="q" autocomplete="off" class="form-control"></p></form><div class="post-content"><br></div><script id="search-item-template" type="text/template"><article class="post"><div class="arc-t"><div class="arc-tile"><small><a itemType="url" href="{url}">{title}</a></small><br/><span class="arc-date"><time>{date}</time></span></div></div></article></script><script id="search-none-template" type="text/template"><article class="post" style="text-align:center"><h1 class="post-title">,,Ծ‸Ծ,,</h1><h6>表示没有写过关于这方面的内容唉...</h6></article></script><script id="search-json" type="text/json">[{"title":"TypeScript React 中的一些坑","content":"使用 // @ts-ignore  忽略某一个 props\n&lt;NavItem \n  to=\"/test\"\n  componentClass={Link}>\n  Test\n&lt;/NavItem>\n\n如果像这样， NavItem  组件上没有 to  这个属性，很自然的会报错。\nProperty 'to' does not exist on type 'IntrinsicAttributes &amp; IntrinsicClassAttributes&lt;NavItem&gt; &amp; Readonly&lt;NavItemProps&gt; &amp; Readonly&lt;...&gt;'.ts(2769)\n\n然而 TypeScript 只认带双斜杠的 // @ts-ignore ，JSX 代码中写注释的只能通过 {/* */} , 类似这样的代码是不行的呢\n&lt;NavItem \n  // @ts-ignore\n  to=\"/test\"\n  componentClass={Link}>\n  Test\n&lt;/NavItem>\n\n正确答案是这样的↓↓↓ ，加 /* prettier-ignore */  的原因是可能格式化后会破坏这种微妙的结构 hhh\n{/*\n  // @ts-ignore */ /* prettier-ignore */}\n&lt;NavItem to=\"/test\"\n  componentClass={Link}>\n  Test\n&lt;/NavItem>\n\nReact Router 相关\n路由中参数的声明：\nimport { RouteComponentProps } from 'react-router';\n\ninterface IPageRouteInfo {\n  id: string;\n}\n\ninterface IPageProps extends RouteComponentProps&lt;IPageRouteInfo> {}\n\nclass Page extends React.Component&lt;IPageProps> {}\n\nwithRouter  装饰器的用法，没找到什么好的方式，我一般这么写（（（\nimport { withRouter, RouteComponentProps } from 'react-router';\n\ninterface ISearchProps extends Partial&lt;RouteComponentProps> {}\n\n@(withRouter as any)\nclass Search extends React.Component&lt;ISearchProps> {}\n\n为第三方库添加声明文件 .d.ts\n有些库时没有声明文件的，需要自己添加添加声明文件。一般在 src/types  中新建一个 模块名.d.ts ，内容如下：\ndeclare module 'scroll-to' {\n  const scrollTo: (x: number, y: number, options: any) => void;\n  export = scrollTo;\n}\n\n使用 ESLint 取代 TSLint\n由于 TSLint  已停止维护，推荐使用 ESLint  进行检查。\n需要安装的包：\nyarn add @typescript-eslint/eslint-plugin @typescript-eslint/parser eslint eslint-plugin-react -D\n\n.eslintrc.js  配置：\nmodule.exports = {\n  parser: '@typescript-eslint/parser',\n  parserOptions: {\n    ecmaFeatures: { jsx: true },\n    ecmaVersion: 2019,\n    sourceType: 'module',\n    project: ['./tsconfig.json'],\n    tsconfigRootDir: __dirname\n  },\n  env: {\n    browser: true,\n    es6: true,\n    node: true\n  },\n  extends: [\n    // ...\n    'plugin:@typescript-eslint/eslint-recommended',\n    'plugin:@typescript-eslint/recommended'\n  ],\n  plugins: [\n    '@typescript-eslint',\n    'react'\n  ],\n  settings: {\n    react: {\n      version: require('react').version\n    }\n  }\n};\n\n更多的规则可以查看 typescript-eslint/typescript-eslint。\n用 TypeScript 来写 webpack 配置\n有强迫症患者的同学可以用 TypeScript 的语法来写 webpack 的配置文件。\n首先是需要安装的包：\nyarn add ts-node webpack webpack-cli webpack-dev-server @types/webpack @types/webpack-dev-server tsconfig-paths -D\n\n在项目根目录下创建 tsconfig-node.json ：\n{\n  \"compilerOptions\": {\n    \"module\": \"commonjs\",\n    \"target\": \"es5\",\n    \"esModuleInterop\": true\n  }\n}\n\n创建 webpack.config.ts ：\nimport webpack from 'webpack';\n\nconst config: webpack.Configuration = {\n  // ...\n};\n\nexport default config;\n\n冲鸭！！\ncross-env TS_NODE_PROJECT=\\\"tsconfig-node.json\\\" NODE_ENV=development webpack-dev-server --config ./webpack.config.ts\n\n","url":"/archives/typescript-react.html","date":"Feb 06, 2020"},{"title":"「2020」 除草 (★^O^★)","content":"突然想起来还有这个地方，2020 年为了证明我还活着！！！\n我把 Typecho 转到 Hexo 啦～～～\n","url":"/archives/first-post-2020.html","date":"Feb 02, 2020"},{"title":"adb 删除乱码文件 (夹)","content":"\nemmmm… 万年不水文\n\n事情是这样的，在 Windows 下拷贝了一个中文目录进去，结果在手机上看就乱码了，而且目录里的文件都看不到，于是搜索找到一个 Linux 下删除乱码的办法：\nadb shell\nls -i\n\n看到类似的输出：\n 6283265 鏂板缓\\346\\226\n\n然后使用命令删除：\nfind -inum 6283265 -exec rm -rf {} \\;\n\n","url":"/archives/adb-delete-garbled-file.html","date":"Apr 18, 2018"},{"title":"Aqours LIVE && FMT 歌单","content":"\n","url":"/archives/aqours-fmt-in-shanghai-playlist.html","date":"Jan 13, 2018"},{"title":"一些好用的 git 代码段","content":"添加历史 tag\ngit tag -a v1.2 9fceb02 -m \"Message here\"\ngit push --tags origin master\n\ntag 排序\n# Loop over tags\ngit tag -l | while read -r tag\ndo\n\n    # get the commit hash of the current tag\n    COMMIT_HASH=$(git rev-list -1 $tag)\n\n    # get the commit date of the tag and create a new tag using\n    # the tag's name and message. By specifying the environment\n    # environment variable GIT_COMMITTER_DATE before this is\n    # run, we override the default tag date. Note that if you\n    # specify the variable on a different line, it will apply to\n    # the current environment. This isn't desired as probably\n    # don't want your future tags to also have that past date.\n    # Of course, when you close your shell, the variable will no\n    # longer persist.\n    GIT_COMMITTER_DATE=\"$(git show $COMMIT_HASH --format=%aD | head -1)\" git tag -a -f $tag -m\"$tag\" $COMMIT_HASH\n\n\ndone\n\n# Force push tags and overwrite ones on the server with the same name\ngit push --tags --force\n\n","url":"/archives/useful-git-snippets.html","date":"Dec 02, 2017"},{"title":"React AsyncComponent 的一些问题","content":"找到一个 react-async-component 可以实现 React 组件的异步加载。\n使用方法大概是这样的：（以 react-cropper  为例）\nimport { asyncComponent } from 'react-async-component';\n\nexport default asyncComponent({\n  resolve: () => import('react-cropper')\n});\n\n但是这样导致的问题是无法获取到 react-cropper  组件的 ref 属性，此时获取到的 ref 是 AsyncComponent 。\n\n所以需要把 react-cropper  包一层：\n// Cropper.js\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport ReactCropper from 'react-cropper';\nimport 'cropperjs/dist/cropper.css';\n\nexport default class Cropper extends React.Component {\n  static defaultProps = {\n    onRef() {}\n  };\n\n  static propTypes = {\n    onRef: PropTypes.func\n  };\n\n  componentDidMount() {\n    this.props.onRef(this.cropperRef);\n  }\n\n  render() {\n    return (\n      &lt;ReactCropper ref={ref => (this.cropperRef = ref)} {...this.props} />\n    );\n  }\n}\n\n// AsyncCropper.js\nimport { asyncComponent } from 'react-async-component';\n\nexport default asyncComponent({\n  resolve: () => import('@/components/Cropper')\n});\n\n\n然后引入 AsyncCropper  就可以了 = w=\n&lt;AsyncCropper onRef={ref=>this.cropper = ref} />\n\n","url":"/archives/problems-with-react-async-component.html","date":"Nov 27, 2017"},{"title":"webpack 集成 basket.js 实现 localStorage 本地缓存","content":"basket.js 是什么\nbasket.js 可以用来加载 js 和 css 脚本并且保存到  LocalStorage  上，使我们可以更加精准地控制缓存，即使是在 http 缓存过期之后也可以使用。因此可以使我们防止不必要的重新请求 js 脚本，提升网站加载速度。\nbasket.js 的简单使用方式\nbasket.require({url: 'helloworld.js'});\n\n和浏览器缓存相比的优势\n在 PC 端和浏览器缓存相比没有任何优势，移动端 SPA 值得尝试。\n（特别是在某信的 WebView 里，304 缓存的时间短如小香菇 2333）\n\n以下总结来自某乎：\nPC 上应用价值不大的原因在于：\n\n兼容性不太好，不支持 LS 的浏览器比例仍然很大\n网络速度快，协商缓存响应快，LS 读取 + eval 很多时候会比不上 304\n通常需要 SEO，导致 css 不能缓存，仅缓存 js 使得整个缓存方案意义进一步减小\n浏览器本地缓存足够可靠持久\n跨页面间共享缓存即便有浪费也差别不大\n\n移动端 webapp 值得一试的原因在于：\n\n兼容性好\n网速慢，LS 读取 + eval 大多数情况下快于 304\n都说是 webapp 了，不需要 seo，css 也可以缓存，再通过 js 加载\n浏览器缓存经常会被清理，LS 被清理的几率低一些\n以模块文件为单位，缓存失效率低\n不同页面状态直接访问、二次访问、页面状态跳转资源组合是不确定的，不能通过 url 来缓存资源，否则就不 “增量” 啦\n\n暗中观察\n以最常见的 vue-cli  来举例（PS：虽然不用 Vue，但是它的 webpack 配置还行，直接抄了），默认会打包出以下几个 js 文件，在 Chrome 的 network  选项卡中可以看到加载过程。\n\n改造 HtmlWebpackPlugin 的模板文件\n在 ejs 模板中加入以下代码， keys  数组可能需要对应自己的 entry  名来修改。\n&lt;% if (process.env.NODE_ENV === 'production') { %>\n    &lt;script src=\"&lt;%=htmlWebpackPlugin.files.publicPath %>basket.full.min.js\">&lt;/script>\n    &lt;script>\n      &lt;%\n      var resources = [];\n      var keys = [\"manifest\", \"vendor\", \"main\"];\n      // css\n      for (var css in htmlWebpackPlugin.files.css) {\n        resources.push({\n          url: htmlWebpackPlugin.files.css[css],\n          execute: false\n        });\n      }\n      // js\n      var i = -1;\n      for (var chunk in htmlWebpackPlugin.files.chunks) {\n        i++;\n        resources.push({\n          url: htmlWebpackPlugin.files.chunks[chunk].entry,\n          execute: true\n        });\n      }\n      %>\n      (function(b) {\n        b.require.apply(this, &lt;%=JSON.stringify(resources) %>)\n          .then(function(responses) {\n            responses.forEach(function(response) {\n              if (!response.execute) {\n                var style = document.createElement('style');\n                style.innerHTML = response.data;\n                var head = document.getElementsByTagName('head')[0];\n                head.appendChild(style);\n              }\n            });\n          });\n      })(basket);\n    &lt;/script>\n&lt;% } >\n\nwebpack 配置文件也需要相应修改，因为没有用到 CDN 上的 basket.full.min.js ，所以就自己本地托管吧。\n使用 CopyWebpackPlugin  把 node_modules  目录中的 js 复制到打包目录下：\n new CopyWebpackPlugin([\n      {\n        from: path.join(__dirname, 'node_modules/basket.js/dist/basket.full.min.js'),\n        to: path.join(__dirname, 'dist')\n      }\n])\n\n同时 HtmlWebpackPlugin  中 inject  选项需要设置为 false ，这样打包的时候就不会在 index.html  中置入 &lt;script&gt;  标签啦～(≧▽≦)/~。\n大成功\n重新打包编译，打开浏览器测试，可以看到结果。 basket.js  会以 ajax 的形式调用这些静态文件并缓存到 LocalStorage  里。\n\n\n再次刷新页面，就不会有这些请求～(≧▽≦)/~ 啦。\n","url":"/archives/integrates-basket-into-webpack.html","date":"Nov 09, 2017"},{"title":"webpack-dev-server 在 Safari 中的问题","content":"webpack-dev-server &gt;= 2.8.0 的版本在 iOS Safari 下无法打开网页，效果为白屏。\n控制台报错： Can't find variable: SockJS\n应该是 Safari 的 BUG，比如下面的代码就会抛出 Error\neval(\"const a = function () {}; function b() {  a(); }; b();\")\n\n\nReferenceError: Can’t find variable: a\n\n解决方法\n使用老版本（bu\nyarn add webpack-dev-server@~2.7.0 -D\n\n其它方法\nyarn add babel-plugin-transform-es2015-block-scoping -D\n\n修改 webpack 相关配置\n{\n  test: /\\.js$/,\n  loader: 'babel-loader',\n  include: [\n    ...,\n    /node_modules\\/webpack-dev-server/\n  ]\n}\n\n","url":"/archives/webpack-dev-server-issue-in-safari.html","date":"Oct 11, 2017"},{"title":"LINE 社交登录简单记录","content":"首先要去 LINE developers 注册一个账号～\n创建好应用以后获取 client_id  和 client_secret\n大致流程和微信是一样的 0w0\n\n获取 code\n将用户重定向到 https://access.line.me/dialog/oauth/weblogin?response_type=code&amp;client_id=xxx&amp;redirect_uri=xxx  这个地址\n用户登录完了以后会跳转至上一步的 redirect_uri ，并带上 code 参数。\n\n获取 access_token\n我们的服务器获取到 code 以后，向 LINE 的服务器发送一个 POST 请求，注意这里的 Content-Type  是 application/x-www-form-urlencoded 。\ncurl -X POST \\\nhttps://api.line.me/v2/oauth/accessToken \\\n-H 'content-type: application/x-www-form-urlencoded' \\\n-d 'grant_type=authorization_code&amp;client_id=xxx&amp;client_secret=xxx&amp;code=xxx&amp;redirect_uri=xxx'\n\nLINE 服务器会返回如下结果：\n    {\n       \"scope\":\"P\",\n       \"access_token\":\"bNl4YEFPI/hjFWhTqexp4MuEw5YPs7qhr6dJDXKwNPuLka...\",\n       \"token_type\":\"Bearer\",\n       \"expires_in\":2591977,\n       \"refresh_token\":\"8iFFRdyxNVNLWYeteMMJ\"\n     }\n\n获取用户信息\n最后使用获取到的 access_token  发送获取用户信息的请求：\ncurl -X GET \\\n-H 'Authorization: Bearer bNl4YEFPI/hjFWhTqexp4MuEw5YPs7qhr6dJDXKwNPuLka...' \\\nhttps://api.line.me/v2/profile\n\n结果是酱紫的：\n{\n  \"userId\":\"Ufr47556f2e40dba2456887320ba7c76d\",\n  \"displayName\":\"Brown\",\n  \"pictureUrl\":\"https://example.com/abcdefghijklmn\",\n  \"statusMessage\":\"Hello, LINE!\"\n}\n\n\n结束惹。很简单吧（x\n最后发现 Web 版 Social Login 能唤醒客户端。\n","url":"/archives/line-social-login.html","date":"Sep 26, 2017"},{"title":"React JSX 中 unicode 的处理","content":"因为某些需要，创建了一个 iconfont 的组件，旨在根据 unicode 的～～id???~~ 来创建对应的图标字体，大致用法是这样的\n&lt;Icon content=\"628\" />\n\n这样就会生成一段 html\n&lt;i class=\"iconfont\">&amp;#xe628;&lt;/i>\n\n如果这样还好办，可以用 dangerouslySetInnerHTML  达到效果。\n但是，有些情况下，需要达到如下效果\n&lt;Icon tagName=\"input\" content=\"628\" />\n\n生成这样的 html\n&lt;input class=\"iconfont\" type=\"button\" value=\"&amp;#xe628;\" />\n\n可是为什么不生成 &lt;button type=&quot;button&quot;&gt;&amp;#xe628;&lt;/button&gt;  呢 (⊙o⊙)\n如果在组件中直接拼字符串，会在页面上吧 &amp;#xe628;  直接输出\nconst Icon = ({ content }) =>\n  &lt;input className=\"iconfont\" type=\"button\" defaultValue={`&amp;#xe${content};`} />;\n\n不过，把 unicode 稍微转换一下就可以啦 (●′ω`●)\nconst convertUnicode = input =>\n  input.replace(/\\\\u(\\w\\w\\w\\w)/g, (a, b) =>\n    String.fromCharCode(parseInt(b, 16))\n  );\n\nconst Icon = ({ content }) =>\n  &lt;input class=\"iconfont\" type=\"button\" defaultValue={convertUnicode(`\\\\ue${content}`)} />;\n\n","url":"/archives/unicode-in-jsx.html","date":"Aug 25, 2017"},{"title":"从外部获取 php 类的私有属性","content":"\n最近把 Typecho 升级到了 1.1 (17.8.17)，然后主题部分功能挂了，应该是以前魔改过核心代码导致的，70 说国庆会出一个 Beta 版，看来以后还是不改源代码了 …⁄(⁄ ⁄・⁄ω⁄・⁄ ⁄)⁄…\n\nTypecho 评论页中，如果要获取当前的页码是没有办法的，可能需要调用 $comments-&gt;_currentPage ，但是 Widget_Comments_Archive::_currentPage  是 private  的。\n在不修改源代码的情况下，可以使用 ReflectionClass 来获取。\n代码如下：\n$reflection = new ReflectionClass($comments);\n\n$currentPage = $reflection->getProperty('_currentPage');\n$currentPage->setAccessible(true);\n$currentPage = $currentPage->getValue(($comments));\n\necho $currentPage;\n\n","url":"/archives/php-get-private-property.html","date":"Aug 23, 2017"},{"title":"定位领取 SIF 感谢祭奖励","content":"\n\n池袋・サンシャインシティ周辺にて、スクフェスにログインすると、ゲーム内の「背景」や「称号」をゲットすることができます！！\nゲットした「背景」や「称号」を設定してみんなで「スクフェス感謝祭 2017」を盛り上げよう♪\n\n\n※ご使用端末の位置情報設定を ON にしてご利用ください。\n※1 アカウントにつき各種 1 回まで取得可能です。\n※6/10 (土) 09:00 〜 6/11 (日) 23:59 まではホームバナーおよび「その他 ＞ 位置情報」メニューから受け取り可能です\n※背景のみ 6/12 (月) 0:00 以降も「その他 ＞ 位置情報メニュー」から受け取り可能です\n\n\n【背景】噴水広場・池袋 サンシャインシティ\n配布期間: 6/10 (土) 09:00 〜 無期限\n\n\n【称号】スクフェス感謝祭 2017\n 配布期間: 6/10 (土) 09:00 〜 6/11 (日) 23:59\n※こちらの称号は先行配信です。後日、7/15 よりシール SHOP にて再配信予定です。\n\n大概就是 10 号感谢祭到现场可以领取背景和称号奖励，嘛就是这样……\n难道我等不在日玩家就要少了一个背景吗。。。\n虚拟定位到 Sunshine City (サンシャインシティ、池袋附近)\n 可破 （应该，到时候测试一下吧）\n\n设置好位置后，打开其他地图应用，可以看到位置已经变了 (┌^o^)┐\n\n\n6 月 5 日更新\n Android 开启了开发者模式后会在游戏中提示！！！\n设备的开发者选项被打开了\n模拟位置函数不能被使用\n请检查你的设备设置\n\n","url":"/archives/lovelive-sif-2017-thanksgiving-virtual-positioning.html","date":"Jun 02, 2017"},{"title":"SIF 账号申诉流程","content":"嘛…… 之前 SIF 账号由于手贱弄丢了，所以这里记录一下申诉流程 w\n首先要给 \tinfo-lovelive@klab.com  发一封邮件表明情况\n如果是切账号时忘记设置密码就用这个\n\n私は二つのアカウントを持ちます。普通は引き継ぎパスワードにスクリーンショットをして保存します。でも、今回は、私はパスワードを設定せずに別のアカウントを引き継ぎしました。今、このアカウントがローグインできません。すみませんが、お助けをください。お面倒を挂けて本当にすみませんでした。\n私のゲームの名前：【】\nユーザー ID：【】\n端末の OS は Android/IOS です。\n\n老玩家回归没有新版引继码的用这个\n\n今私もう一度ゲームをインストールしました。でも、引き継ぎ ID がなかったので、引き継ぐことができませんでした。今、このアカウントがローグインできません。すみませんが、お助けをください。お面倒を挂けて本当にすみませんでした。\n私のゲームの名前：【】\nユーザー ID：【】\n端末の OS は Android/IOS です。\n\n然后不许摸过了一天就会给你发一封邮件：（以下省略不许摸的客套话）\n\n※お客様情報入力時の注意点※\n１.【回答】部分にご記載ください。\n２. すべての項目にご回答ください。\n３. わからない場合は「不明」とご記載ください。\n\n\n\n\n◆別のメールアドレスでお問い合わせをされたことがあるか\n　ある場合、該当のメールアドレスをお教えください\n　（ドメインが異なる場合もご連絡ください）\n【回答】：\n\n※お問い合わせをされたことがない場合は、回答欄に「なし」とご記載ください。\n\n\n\n◆ユーザー ID〈必須〉游戏 ID\n【回答】：\n\n\n※プロフィール画面の 9 桁の数字です。\n\n\n\n◆登録名〈必須〉 名字\n【回答】：\n\n\n\n\n◆ランク rank\n【回答】：\n\n\n\n◆有償アイテム (ラブカストーン、各種セット販売アイテム等) の購入履歴画像の添付（2 枚以上）\n【回答】：课金记录截图\n\n※購入したことがない場合は、回答欄に「購入なし」とご記載ください。\n※iTunes または、Google ウォレットの購入履歴・レシートメールのスクリーンショット\n\n\n\n◆過去に使用したことのあるシリアルコード 所有使用过的序列号\n【回答】：\n\n\n※使用したことがない場合は、回答欄に「なし」とご記載ください。\n\n\n\n◆過去の課金時に使用していた端末名と OS バージョン 课金设备和操作系统版本号\n【回答】：\n\n\n※OS バージョンは覚えている場合ご記載ください。\n\n\n\n◆アプリの登録日時〈必須〉第一次登录日期\n【回答】：\n\n\n例）20●●年●月●日\n\n\n\n◆初期選択部員名〈必須〉初始部员\n【回答】：\n\n\n※当アプリを始めた時に一番最初に選んだ部員名をご記載ください。\n\n\n\n◆最後にログインを行った日時〈必須〉最后登录时间\n【回答】：\n\n\n例）20●●年●月●日\n\n\n\n◆これまで使用していた端末名と OS バージョン〈必須〉 所有使用过的设备和操作系统版本\n【回答】：\n\n\n※OS バージョンは覚えている場合ご記載ください。\n※複数使用されていた場合は、覚えている範囲の端末名をすべてご記載ください。\n\n\n\n◆過去に使用した引き継ぎパスワード（16 桁の数字） 过去使用过的继承码\n【回答】：\n\n\n※過去に当アプリで発行した引き継ぎパスワード（16 桁の数字）をご記載ください。\n※ご自身で設定した引き継ぎパスワードを使用した場合は、回答欄に「なし」とご記載ください。\n\n\n\n◆ユニット名〈必須〉 队伍名\n【回答】：\n\n\n※設定したユニット名を覚えている範囲ですべてご記載ください。\n\n\n\n◆メイン以外のセンター部員 主队以外的 C 位部员的技能名或卡名\n【回答】：\n\n\n※部員名と絵柄の特徴、または特技名をご記載ください。\n\n\n\n◆フレンドの名前 好友的名字\n【回答】：\n\n\n\n\n◆アプリ内メールの履歴〈必須〉邮件历史\n【回答】：\n\n※他のユーザー様とメールのやりとりをした場合、その内容をご記載ください。\n　(例：◯◯さんと◯◯について話をしました 等)\n\n以上全部填完以后回信，一天左右，会告诉你已经收到信息，等待我们审核\n然后大概一星期左右，收到如下邮件：（省略废话）\n\n今回は情報不足のため本人確認をおこなうことができませんでした。\nお客様のお力になれず、誠に申し訳ございません。\n\n\n以前のデータの復旧をご希望される場合は、\n下記項目についてご記入の上、ご返信ください。\n\n\n===============\n\n\n◆チュートリアルの際に選択した μ’s もしくは Aqours の部員名を教えてください：初始部员\n\n\n◆初めて参加したイベントを教えてください：初次参加的活动名\n\n\n◆最初に獲得した UR 部員の名前と特技名を教えてください：最初获得的 UR\n\n\n◆今までに当アプリで使用したことがある端末の正確な機種名、OS のバージョンを全て教えてください 所有登录过的设备\n　※OS のみの申告では調査を行うことができません\n　　機種名（iPhone4、Xperia Z など）：\n　　OS（iOS7、Android4.1 など）：\n\n由此可见，初始部员、初始时间、登录过的设备名，在其它信息正确的情况下，这三者只要回答对一个就能 100% 申诉成功。\n然后再过一个礼拜，如果信息都正确的话，不许摸爸爸就会把引继码发回了\n\n后记（？）\n\n回答不要答非所问，多用敬语\n被问到是否经手第三者一定要回答不，就算是朋友也不行\n如果申诉失败的话就换个邮箱继续\n千万不要回信催不许摸爸爸！\n可以说说你和这个账号的故事（大概能提高成功率）\n\n完惹\n","url":"/archives/lovelive-sif-account-recovery.html","date":"May 31, 2017"},{"title":"一个动漫拉动一个市的经济","content":"贴吧盗链 test\n \n\n\n","url":"/archives/lovelive-sunshine-special-announcement.html","date":"Apr 27, 2017"},{"title":"Ubuntu Sublime Text 3 中文输入法","content":"sudo apt-get install build-essential libgtk2.0-dev\n\n\nvim ~/.sublime_imfix.c\n#include &lt;gtk/gtkimcontext.h>\nvoid gtk_im_context_set_client_window (GtkIMContext *context, GdkWindow *window)\n{\n    GtkIMContextClass *klass;\n    g_return_if_fail (GTK_IS_IM_CONTEXT (context));\n    klass = GTK_IM_CONTEXT_GET_CLASS (context);\n    if (klass->set_client_window)\n        klass->set_client_window (context, window);\n    g_object_set_data(G_OBJECT(context),\"window\",window);\n    if(!GDK_IS_WINDOW (window))\n        return;\n    int width = gdk_window_get_width(window);\n    int height = gdk_window_get_height(window);\n    if(width != 0 &amp;&amp; height !=0)\n        gtk_im_context_focus_in(context);\n}\n\n\ncd ~\ngcc -shared -o libsublime-imfix.so sublime_imfix.c  `pkg-config --libs --cflags gtk+-2.0` -fPIC\n\n\nsudo mv libsublime-imfix.so /opt/sublime_text/\n\n\nsudo vim /usr/bin/subl\n\n#!/bin/sh\nLD_PRELOAD=/opt/sublime_text/libsublime-imfix.so exec /opt/sublime_text/sublime_text \"$@\"\n\n\nsudo vim /usr/share/applications/sublime_text.desktop\n\n[Desktop Entry]\nVersion=1.0\nType=Application\nName=Sublime Text\nGenericName=Text Editor\nComment=Sophisticated text editor for code, markup and prose\nExec=bash -c &quot;LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so exec /opt/sublime_text/sublime_text %F&quot;\nTerminal=false\nMimeType=text/plain;\nIcon=sublime-text\nCategories=TextEditor;Development;\nStartupNotify=true\nActions=Window;Document;\n\n[Desktop Action Window]\nName=New Window\nExec=bash -c &quot;LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so exec /opt/sublime_text/sublime_text -n&quot;\nOnlyShowIn=Unity;\n\n[Desktop Action Document]\nName=New File\nExec=bash -c &quot;LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so exec /opt/sublime_text/sublime_text --command new_file&quot;\nOnlyShowIn=Unity;\n\n","url":"/archives/ubuntu-sublime-text-imfix.html","date":"Apr 24, 2017"},{"title":"模拟登录 pixiv.net 后续","content":"继上一篇文章《模拟登录 pixiv.net 后续》，老接口已经在 html 上消失了，那么只能按新版接口来惹\n直接上代码，添加了登录错误的异常 = w= 同时不再需要 sunra/php-simple-html-dom-parse 。\n可以看到 p 站添加了 Google reCAPTCHA ，但是目前没有碰到验证码。\nPS:  is_cookie_ok  没有改动，依旧按原来的使用。\nPSS: nodejs 版 pixiv-cookie\ndefine('BEFORE_LOGIN_COOKIE', __DIR__ . '/BEFORE_LOGIN_COOKIE.txt'); //登录页面的cookie\ndefine('AFTER_LOGIN_COOKIE', __DIR__ . '/AFTER_LOGIN_COOKIE.txt'); //登录成功后获取到的cookie\ndefine('USER_AGENT', 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.59 Safari/537.36');\n\nlogin_pixiv('YOUR_PIXIVID', 'YOUR_PWD');\nvar_dump(is_cookie_ok(AFTER_LOGIN_COOKIE));\n\nfunction login_pixiv($username, $password)\n{\n    //获取登陆页cookie\n    $ch = curl_init();\n    curl_setopt($ch, CURLOPT_URL, 'http://www.pixiv.net');\n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n    curl_setopt($ch, CURLOPT_COOKIEJAR, BEFORE_LOGIN_COOKIE);\n    curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 15);\n    curl_setopt($ch, CURLOPT_TIMEOUT, 15);\n    curl_setopt($ch, CURLOPT_USERAGENT, USER_AGENT);\n\n    $login_html = curl_exec($ch);\n    curl_close($ch);\n\n    preg_match('/pixiv\\.context\\.token(.*)=(.*?)(\\\"|\\')(.*?)(\\\"|\\')/', $login_html, $matches);\n    if (!isset($matches[4])) {\n        throw new Exception('没有获取到token');\n    }\n\n    $data['pixiv_id'] = $username;\n    $data['password'] = $password;\n    $data['captcha'] = '';\n    $data['g_recaptcha_response'] = '';\n    $data['post_key'] = $matches[4];\n    $data['source'] = 'pc';\n    $data['ref'] = 'wwwtop_accounts_index';\n    $data['return_to'] = 'http://www.pixiv.net/';\n\n    $ch = curl_init();\n    curl_setopt($ch, CURLOPT_URL, 'https://accounts.pixiv.net/api/login?lang=zh');\n    curl_setopt($ch, CURLOPT_HTTPHEADER, array(\n        'Origin: https://accounts.pixiv.net',\n        'User-Agent: ' . USER_AGENT,\n        'Content-Type: application/x-www-form-urlencoded; charset=UTF-8',\n        'Referer: https://accounts.pixiv.net/login?lang=zh&amp;source=pc&amp;view_type=page&amp;ref=wwwtop_accounts_index',\n        'X-Requested-With: XMLHttpRequest',\n    ));\n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n    curl_setopt($ch, CURLOPT_COOKIEFILE, BEFORE_LOGIN_COOKIE);\n    curl_setopt($ch, CURLOPT_COOKIEJAR, AFTER_LOGIN_COOKIE);\n    curl_setopt($ch, CURLOPT_POST, 1);\n    curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query($data));\n    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);\n    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0);\n    $result = curl_exec($ch);\n    if ($result === false) {\n        throw new Exception(curl_error($ch));\n    } else {\n        $result = json_decode($result, true);\n        if ($result['error']) {\n            throw new Exception($result['message']);\n        } else {\n            if (!$result['body']['success']) {\n                throw new Exception(json_encode($result['body']));\n            }\n        }\n    }\n    curl_close($ch);\n}\n\n","url":"/archives/curl-login-pixiv-next.html","date":"Mar 03, 2017"},{"title":"一道神奇的 JavaScript 面试题","content":"以下记录自一道群里的面试题\nconst foo = {\n  bar: &lt;?php echo $strFromServer;?>\n}\n\n这段 php 代码，可能输出一个 JSON，也可能输出空。（不是 '' ）\n当输出 空 的时候\nconst foo = {\n  bar: \n}\n\n很明显会抛出异常\n那么怎么从 JS 语法层面避免这个异常？ (eval is evil)\n方法一： [&lt;?php?&gt;][0] \n 方法二： (x =&gt; x)(&lt;?php&gt;) \n 方法三 (擦边)： new Object(&lt;?php?&gt;)\n","url":"/archives/a-javascript-question-create-json-object-from-server.html","date":"Feb 21, 2017"},{"title":"微信浏览器下 pushState 的坑","content":"iOS 的微信浏览器有一个巨坑，使用 pushState 改变 url 后，此时 location.href 确实变化了，但是微信浏览器认为地址还是打开页面时的地址，这个可以从 “在 Safari 中打开” 看到。\n所以下面的代码就会导致 JSSDK 在 pushState 后验证失败，报错 invalid signature ，原因如上。\nimport wx from 'weixin-js-sdk';\n\nexport function initWX() {\n    getConfigFromServer(location.href.split('#')[0])\n        .then((response) => {\n            wx.config(response);\n        });\n}\n\n// ...监听路由变化\n$router.onUpdate(() => {\n    initWX();\n});\n\n解决方法\n首先按照正常的地址进行计算签名，如果失败，就按照页面刚进入时的地址来计算。\n// 进入应用时先记录进入时的地址\nglobal.originalUrl = location.href.split('#')[0];\n\n// initWX方法添加error事件\nexport function initWX(url = location.href.split('#')[0]) {\n    getConfigFromServer(url)\n        .then((response) => {\n            wx.config(response});\n\t\t\twx.error(() => {\n\t\t\t\tinitWX(global.originalUrl);\n\t\t\t});\n        });\n}\n\n","url":"/archives/vulnerable-pushstate-in-wechat-browser.html","date":"Feb 20, 2017"},{"title":"2016 年度博客统计报告","content":"会话数与浏览量\n过去的 365 天里，本博客的基本访问情况如下图：\n\n这期间，本博客一共迎来了 3309 位用户，他们一共产生了 7417 次会话以及 20986 次浏览。平均每天 9 位用户、20 次会话以及 57 次浏览。\n地理位置与语言\n毫无疑问，本博客主要流量都来自于中国大陆，占到 56.61%：\n\n而从浏览器语言上看，简体中文占到 74.65%，也就是说以上的中国大陆流量并不准确（\n\n操作系统与浏览器\n首先来看操作系统概况，本博客主要流量还是来自于桌面端。\n\n浏览器方面，来自 IE 的份额不足 2%：\n\n流量来源\n本博客流量来源主要有搜索引擎、第三方网站引荐、直接访问三大块。完整统计如下：\n\nGoogle 对原创博客非常友好，使用 HTTPS 并提高访问速度也有利于 Google 权重，所以本博客在 Google 的排名非常好，最终高达 11.31% 的流量均来自于 Google 搜索。而百度对原创博客就没有这么友好了，但基于它在国内庞大的市场份额，本博客也有 0.62% 的流量来自于百度：\n\n后记\n在 2016 年已经过去的这五个月里，我一共写了 18 篇文章，如果保持这个更新频率，今年的总文章数会达到 83 篇。\n","url":"/archives/2016-blog-analytics.html","date":"Jan 07, 2017"},{"title":"react.js を利用して、創建した挿絵の画像欄","content":"react + redux  を使って、Web アプリケーションを組み合わせた。それは pixiv.net  の挿絵の画像欄であり、私はそれを pixivの「ラブライブ」発見 と呼ばれている。 pixiv.net  挿絵のインターネットにラブライブに関するラブライブ！学園アイドル祭の作品を用いる。ラブライブがそのアプリケーションが好きになると思う。\n特徴\n\nラベルによって、挿絵を選別する\n挿絵の詳細情報を調べる\npixiv に登録して、好きな挿絵にブックマークをする\n\n主な技術:\n\nreact\nreact-dom\nreact-router-component\nredux\nredux-thunk\nreact-redux\nreact-mdl\nwhatwg-fetch\nwebpack\n\nAJAX リクエスト\nAJAX リクエストに関して、たくさんの選択肢がある: fetch 、 superagent 、 axios 、その上  jQuery.ajax 。総合的に比べて、標準的な fetch  は必ず最高な選択である。\nfetch の主な長所:\n\n簡単な文法、更に語義化のようだ\nPromise の標準に基いで、async/await にサポートする。\n便利な同型定理\n\n原生の支持率は高くない。しかし以下の polyfill を取り入れて、IE8 + にサポートすることができる:\n\nIE8 は ES3 であるから、ES5 の polyfill を取り入れるのが必要である:es5-shim, es5-sham\nPromise の polyfill を取り入れ: es6-promise\nfetch 探測倉を取り入れ:fetch-detector\nfetch の polyfill を取り入れ: fetch-ie8\n選ばれ：もし jsonp も使えば、fetch-jsonp を取り入れる\n選ばれ：Babel の runtime・モデルを開けて、今、async/await を使っていく\n\nFetch polyfill の基本的な原理は window.fetch の方法があるかどうかを測定する。ないなら、XHR を利用して実現する。これも github/fetch の方法であり、しかしあるブラウザー（Chrome45）は元で fetch をサポートする。これらの庫は今、毎日に数千万のリクエストが使用していて、問題ないである！\nfetch のよくある質問\n\nFetch リクエストは既定に cookie が無いから、 fetch(url, {credentials: 'include'})  を設置するのが必要である。\nサーバーは 400 、 500  ミス番号に戻る時、拒絶しない。ネットワーク・ミスのせいで、そのリクエストが完成できない場合、fetch が拒絶される。\n\n性能合理化\nこのアプリケーションの中に、一つの長いリストがあって、すべての画像のモジュールで onClick 事件を縛って、もしリストの数量は上がってきて、性能の問題も明らかで、ソリューションは主に以下:\nprops の中で bind 方法を使えないでください。\nonClick  中で bind(this)  を操作しないでください。そうすると、毎回 render  が新しい関数を形成するから、性能に対する影響は顕著である。同じ、矢じり関数 ()=&gt;{}  のを使う場合、同じ理論である。それも一回に自動 bind  する。良い方案は constructor  の中で事前にバンドしたそうである。Don’t Use Bind When Passing Props 。この文章は共に 9 種類のソリューションに言及して、それぞれ利害がある。\nリストに１つの正しい key 属性をあげる\n周知のように、react 循環中のリストは必ず key  属性を与えなければならなくて、この属性はユーザーが自分で使うのではなくて、React 自分で使ったのです。配列の元素に必ず唯一の key  属性を提供しなければならなくて、私達は直接に配列の index  を使って key  とする。実はそれが何度も一挙であり、 key  を提供しないなら、react は黙認に採用したのが index  である。良い方案は shortid を使って形成するのである。それは主に Index as a key is an anti-pattern を参考した。\nsetState 慎重に用いる\nデータを Redux  に任せて管理したなら、できるだけ Redux  でデータと状態 state  を管理してください。少数の情況以外、 shouldComponentUpdate  も state  の比較が必要なことを忘れないでください。\nComponent が必要な props だけを順送りする\n順送りしたのが多すぎ、あるいは段階が深すぎの場合、 shouldComponentUpdate  のデータ比較の負担をもたらして、そして、慎重に用いてください。\nshouldComponentUpdate 使用\nshouldComponentUpdate  は黙認状況で true  に戻って、つまり props  あるいは state が変化すれば、このモジュールは更新して、そのとおり、 props  の変化のように、モジュールも更新する可能性がある。 リストの VirtualDOM  は毎回レンダリングする時、新生するから、最も簡単な方法はすべての Item の shouldComponentUpdate  を実現することである（現在と取り入れた props を比較するのを通じて、更新するかどうかを判断する。属性は object  であるのが、内部の変化を判断するのが必要ので、もし私達は immutable―js  が必要である）。\nPureRenderMixin\nReact が提供した PureRenderMixin  は、実は以上の必要なことをやってくれて、ファイルの方法に基づいて、十分である。しかし、このプラグインはすべての属性を比較して、いくつか状況で予想するのと違う可能性がある。\nモバイルサイドのロード最適化\nJavascript を localStorage  にキャッシュメモリして、バージョンが変動した後、サーバーで新しい js をダウンロードする。ソリューションはモバイル WEB 通用最適化策略紹介からのである。 localStorage  は静態の資源をキャッシュメモリして、モバイルサイドと高いバージョンのブラウザーで試み価値があるそうである。ブラウザーを通じて、静的ファイルをキャッシュメモリすることができるけど、いくつか状況で（たとえば f5 の更新）、それども cache―control: max―age=0  のリクエストを提出する。リクエストを節約する目的で、静態資源のリクエスト方法を改造することができて、すべての静態資源をひとつのリクエストを通じてロードする。そうすれば、いずれにしても、ページはただ一つのリクエストを出す。もし静的なファイルは更新があれば、サーバーは更新するファイル内容に戻って、js を通じてページの中に挿入して、 localStorage  の中でキャッシュメモリをする。もし静的ファイルは更新がないなら、直接に localStorage  の中から取り出して、ページの中で挿入して十分である。モバイルサイドにとって、js と css これらの静的ファイルのリクエストをひとつに減らして、やはり効果があるそうである。具体的なものは百度のモバイル版、に参考してください。単のページの運用にとって、 localStorage  の貯蓄枠板を使うのも良い選択である。\nインターネット・リクエスト合理化\nAjax のリクエストもキャッシュメモリして、キャッシュメモリが必要なリクエストは期限が切れ時間のカラムに戻る。データを得た後、期限が切れ時間とデータを localStroage  中で保存して、次回にのリクエストは期限が切れ時間と現在時間に比べて、再度リクエストが必要かどうかを判断する。\nその他、react 各種の問題の集合を進め:react-faq\nプロジェクト・アドレス:\nhttps://pixiv.moe\nhttps://github.com/LoveLiveSunshine/pixiv.moe\n1 枚の GIF プレビュー図:\n\nQiita\n","url":"/archives/react-js-pinterest-style-layout-site.html","date":"Nov 25, 2016"},{"title":"模拟登录 pixiv.net","content":"注意：本文的方法已作废，新方法在这里\n\n由于 pixivAPI 有一些内容无法获取，于是模拟登录就派上用场辣\n\n旧版登录接口 (https://www.secure.pixiv.net/login.php) 已经作废。目前新版登录页是用 React 渲染的，但是还是为老浏览器用户开启了兼容♂通道，首先找出这段表单代码：\n&lt;div id=\"old-login\" style=\"display: none;\">\n  &lt;form action=\"/login\" method=\"POST\">\n    &lt;input type=\"hidden\" name=\"post_key\" value=\"b827a089c8e7209503d23235d2ba4b43\">\n    &lt;input type=\"hidden\" name=\"return_to\" value=\"http://www.pixiv.net/\">\n    &lt;input type=\"hidden\" name=\"lang\" value=\"zh\">\n    &lt;input type=\"hidden\" name=\"source\" value=\"pc\">\n    &lt;div class=\"input-field-group\">\n      &lt;div class=\"input-field\">\n        &lt;input type=\"text\" name=\"pixiv_id\" placeholder=\"邮箱地址/pixiv ID\" autocapitalize=\"off\" autocomplete=\"off\">\n      &lt;/div>\n      &lt;div class=\"input-field\">\n        &lt;input type=\"password\" name=\"password\" placeholder=\"密码\" autocapitalize=\"off\" autocomplete=\"off\">\n      &lt;/div>\n    &lt;/div>\n    &lt;ul class=\"error-msg-list\">&lt;/ul>\n    &lt;button type=\"submit\" class=\"signup-form__submit\">登录&lt;/button>\n    &lt;div class=\"signup-form-nav\">\n      &lt;div class=\"left\">&lt;/div>\n      &lt;div class=\"right\">&lt;a href=\"https://www.pixiv.net/reminder.php\" target=\"_blank\">忘记了&lt;/a>&lt;/div>\n    &lt;/div>\n  &lt;/form>\n&lt;/div>\n\n发现需要 post 如下参数：\n\n\n\n参数名\n说明\n\n\n\n\npost_key\n类似于 token\n\n\nreturn_to\n回跳地址\n\n\nlang\n语言\n\n\nsource\n来源\n\n\npixiv_id\n用户名\n\n\npassword\n密码\n\n\n\n提交的表单网址： https://accounts.pixiv.net/login\n因为有 token 的存在，所以提交的时候也需要登录页的生成的 cookie，不提交 cookie 的后果就是如下的 400 Bad Request：(/´Д｀)/\n\n下面直接上全宇宙最好的语言进行登录（啪）\n需要注意，首先需要安装一个 HTML DOM 解析包 sunra/php-simple-html-dom-parse ，运行一下 composer require &quot;sunra/php-simple-html-dom-parser&quot;  就行了。\n主要的代码：\nuse Sunra\\PhpSimple\\HtmlDomParser;\n\ndefine('BEFORE_LOGIN_COOKIE', __DIR__ . '/BEFORE_LOGIN_COOKIE.txt');//登录页面的cookie\ndefine('AFTER_LOGIN_COOKIE', __DIR__ . '/AFTER_LOGIN_COOKIE.txt');//登录成功后获取到的cookie\ndefine('USER_AGENT', 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.59 Safari/537.36');\n\nfunction login_pixiv($username, $password)\n{\n    $login_url = 'https://accounts.pixiv.net/login';\n    //获取登陆页cookie\n    $ch = curl_init();\n    curl_setopt($ch, CURLOPT_URL, $login_url);\n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n    curl_setopt($ch, CURLOPT_COOKIEJAR, BEFORE_LOGIN_COOKIE);\n    curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 15);\n    curl_setopt($ch, CURLOPT_TIMEOUT, 15);\n    curl_setopt($ch, CURLOPT_USERAGENT, USER_AGENT);\n\n    $login_html = curl_exec($ch);\n\n    curl_close($ch);\n\n    $dom = HtmlDomParser::str_get_html($login_html);\n\n    $form = $dom-&gt;find('#old-login', 0)-&gt;find('form', 0);\n\n    $data['post_key'] = $form-&gt;find('input[name=&quot;post_key&quot;]', 0)-&gt;value;\n    $data['return_to'] = $form-&gt;find('input[name=&quot;return_to&quot;]', 0)-&gt;value;\n    $data['lang'] = $form-&gt;find('input[name=&quot;lang&quot;]', 0)-&gt;value;\n    $data['source'] = $form-&gt;find('input[name=&quot;source&quot;]', 0)-&gt;value;\n    $data['pixiv_id'] = $username;\n    $data['password'] = $password;\n\n    $ch = curl_init();\n    curl_setopt($ch, CURLOPT_URL, $login_url);\n    curl_setopt($ch, CURLOPT_HEADER, 0);\n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n    curl_setopt($ch, CURLOPT_COOKIEFILE, BEFORE_LOGIN_COOKIE);\n    curl_setopt($ch, CURLOPT_COOKIEJAR, AFTER_LOGIN_COOKIE);\n    curl_setopt($ch, CURLOPT_POST, 1);\n    curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query($data));\n    curl_exec($ch);\n    curl_close($ch);\n}\n\n调用 login_pixiv()  方法登录成功获取到 cookie 后，就可以为♂所♂欲♂为了，这个 cookie 的有效期为一个月，提供一个验证 cookie 是否有效的方法：\nfunction is_cookie_ok($cookie)\n{\n    $ch = curl_init();\n    curl_setopt($ch, CURLOPT_URL, 'http://www.pixiv.net/setting_profile.php');\n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n    curl_setopt($ch, CURLOPT_HEADER, 1);\n    curl_setopt($ch, CURLOPT_AUTOREFERER, 1);\n    curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 15);\n    curl_setopt($ch, CURLOPT_TIMEOUT, 15);\n    curl_setopt($ch, CURLOPT_USERAGENT, USER_AGENT);\n    curl_setopt($ch, CURLOPT_COOKIEFILE, $cookie);\n    $response = curl_exec($ch);\n    curl_close($ch);\n    $headers = [];\n\n    $header_text = substr($response, 0, strpos($response, &quot;\\r\\n\\r\\n&quot;));\n\n    foreach (explode(&quot;\\r\\n&quot;, $header_text) as $i =&gt; $line) {\n        if ($i === 0) {\n            $headers['http_code'] = $line;\n        } else {\n            list($key, $value) = explode(': ', $line);\n\n            $headers[$key] = $value;\n        }\n    }\n\n    if (strpos($headers['http_code'], '200') === false) {\n        return false;\n    }\n    return true;\n\n}\n\n","url":"/archives/curl-login-pixiv.html","date":"Nov 01, 2016"},{"title":"μ'sic forever (・8・)","content":"半年、6 个月、183 天、4392 小时、263520 分钟、15811200 秒\n新田惠海、内田彩、三森铃子、久保由利香、饭田里穂、Pile、徳井青空、楠田亚衣奈、南条爱乃。高坂穗乃果、南小鸟、园田海未、小泉花阳、星空凛、西木野真姬、矢泽妮可、东条希、绚濑绘里。\n18 个名字，9 个人，3 个小队，2 个次元，1 个组合，写作 μ’s，读作奇迹！\nFinal Live 已经过去了 ，但还是无法忘记她们：正因为 Lovelive 不仅仅是 LLer 的信仰，而是每一个 LLer 的交流的文化。\n从横滨 BLITZ 到 Tokyo dome\n 六年半个月，\n无论风吹雨打\n挫折再多，困难再多\n 18 位小姐姐\n你们辛苦了\n我们期待你们能再次回来\n我们一直在等着！！\n正因为 μ’s 不仅仅是经历风吹雨打走过来的组合，而是每一位 LLer 未来的憧憬，我们的山川，河流和信仰，都为之而活。\n有很多人问我为什么喜欢 LoveLive，因为她们是奇迹吗，我只知道，她们有一种特别的吸引力，使人陶醉，使人痴迷，我们从前的 μ’s!Music!START! 是有多么洪亮，它包含着我们的梦想与希望，一句简简单单的 μ’sic Forever 成为我们的指向，成为我们响亮的口号。\n一直以来，我们 LLer 一直在喊如果奇迹有颜色那么它一定是橙色的！μ’sic Forever! 这些话里有欢笑，有泪水，有兴奋激动，也有泪流满面，当我听到僕たちはひとつの光，これから… 泪腺情不自禁的崩坏，因为某些原因被误认为是邪教，然而从来都不是，如今成为了我们之间交流的一种文化。\nμ’s 这六年一路走来，粉丝多种多样，有的说大法好，有的说 μ’sic Forever，其实大家的心都是一样的，最后的歌也没让我们失望，给这个组合画上了一个圆满的感叹号。就算结束了，尽管有些许遗憾，但 μ’s 的辉煌将会永远留在 LLer 心中。\n你说过我们在一起的夏日不会终结，但秋日的你却渐行渐远，冬天带来的预感告诉我，春天即是我们分别的季节，我们的轨迹就是在当下开始冲刺，夏日的笑容让我们如何对告别说再见。 一单销量的低迷如果没有小姐姐们和 STAFF 的努力，LLer 们以及三巨头财力的付出，那么面临的将是企划的暴死，那么如今我们也看不到 LoveLive! 这个企划了。\n感谢 μ’s 的 18 位小姐姐，感谢在背后默默付出的 STAFF 们，感觉这六年陪着 μ’s 一路走来的 LLer 们。本当にありがとうございました！μ’sic Forever!\n语：我现在想继续的唱下去，继续的跳下去。 海未和小鸟一定也这么想。 我还是第一次体会到这种心情。 真的觉得这么做真是太好了！ 我想要去相信现在的这份感情！ 说不定接下来也不会有人看， 也不会有人替我们加油… 但是我们会想尽办法努力的传播出去！ 将我们此时此刻这份心情传达出去！总有一天我们一定 —— 会让这里座无虚席！ —— 高坂穗乃果\n如果奇迹有颜色，那么一定是橙色的，\n因为那是高坂穗乃果的颜色！\n如果奇迹有颜色，那么一定是蓝色的，\n因为那是园田海未的颜色！\n如果奇迹有颜色，那么一定是白色的，\n因为那是南小鸟的颜色！\n如果奇迹有颜色，那么一定是冰蓝色的，\n因为那是绚濑绘里的颜色！\n如果奇迹有颜色，那么一定是紫色的，\n因为那是东条希的颜色！\n如果奇迹有颜色，那么一定是粉色的，\n因为那是矢泽妮可的颜色！\n如果奇迹有颜色，那么一定是红色的，\n因为那是西木野真姬的颜色！\n如果奇迹有颜色，那么一定是黄色的，\n因为那是星空凛的颜色！\n如果奇迹有颜色，那么一定是绿色的，\n因为那是小泉花阳的颜色！\n如果奇迹有颜色，那么一定是九色的，\n因为那是μ's的颜色！\nμ's：\n有一种**开始**叫做《僕らのLIVE君らのLIFE》\n有一种**坚持**叫做《START:DASH》\n有一种**力量**叫做《No brand girls》\n有一种**前进**叫做《ススメ→トウモロウ》\n有一种**巅峰**叫做《それは僕たちの奇迹》\n有一种**鼓励**叫做《Love wing bell》\n有一种**魔法**叫做《Dancing start on me》\n有一种**奇迹**叫做《Snow halation》\n有一种**活力**叫做《僕らは今のながで》\n有一种**喜欢**叫做《爱してるばんざーぃ》\n有一种**欢乐**叫做《SUNNY DAY SONG》\n有一种**光芒**叫做《僕たちはひとつの光》\n有一种**不舍**叫做《さようならへさよなら！》\n有一种**分别**叫做《これがら》\n有一种**永恒**叫做《ミはμ'sicのミ》\n有一个**组合**写做μ's，读做奇迹\n有一种**颜色**是奇迹的橙色\n有一句不变的话叫做μ'sic forever\nμ's由小小的星光到如今璀璨的光芒，将九人的名字写到歌词里去，将九人的情感融入到曲调中，永不分离，即便解散了，九个人依然在一起，直到永远……\n告诉了我们很多六年的艰辛与结果，每一个角色都是迷人的，每一首歌都是充满正能量和安慰的，每一段经历都是艰辛的、来之不易的，每一次机会是珍贵的，每一个足迹都是引人深思的\n不论未来怎样，我们都会永远记得，那18位小姐姐：\n新田恵海/高坂穂乃果、内田彩/南ことり、三森鈴子/園田海未、久保ユリカ/小泉花阳、飯田里穂/星空凛、Pile/西木野真姫、徳井青空/矢澤にこ、楠田亜衣奈/東條希、南條爱乃/絢瀬絵里，\n那9种颜色：橙白蓝绿黄红粉紫冰蓝\n那个永远的奇迹：\n> μ's\n“1、2、3、4、5、6、7、8、9！”\n“10！”\n\"μ's，Music，START!!\"\n愛してるばんざーい！【爱上你万岁！】\n叶え！私たちの夢！叶え！みんなの夢！ずっとずっと永遠に一生懸命応援します！ミューズが大好きだから！\nAh!ほのか(高坂穂乃果)な予感から始まり\nAh!希望(東條希)が星空(星空凛)駈けて\n花(小泉花陽)を咲かせるにっこ(矢澤にこ)リ笑颜は\nずっと同じさ友情の笑颜\n忘れない　いつまでも忘れない\nこんなにも心がひとつになる\n世界を見つけた喜び(ともに)歌おう\n最後まで(僕たちはひとつ)\n小鳥(南ことり)の翼がついに大きくなって\n旅立ちの日だよ\n遠くへと広がる海(園田海未)の色暖かく\n夢の中で描いた絵(絢瀬絵里)のようなんだ\n切なくて時をまき(西木野真姫)もどしてみるかい？\nNo no no\nいまが最高！\nみんなと出会えたこと嬉しくて\n離れたくないよ本当だよ\n涙はいらない　このまま踊ろう\n手を振\n\n虽说舞台上只有九个人但在我心中却是十八人 —— 楠田亚衣奈\n我一直在想 会不会我们才是 μ’s 最死忠的粉丝呢 ——Pile\n 一日三餐大家都是一起开动所有人都围着一张桌子吃饭如果现场有两张桌子的话 会有人说这样太寂寞了把桌子拼起来吧于是把桌子拼起来 九人围成一个圈吃饭感觉很开心 像是旅行 又像是户外教学 也很像毕业旅行真的是一段言语无法形容的有趣时光 —— 德井青空\n只要九个人到齐就会变得吵吵闹闹的这份让人心情愉悦的嘈杂 才是 μ’s 的九人啊 —— 久保ユリカ\n感觉九人就是无所不能 —— 内田彩\n希望 μ’s 的歌不管过了几年就算大家都变成了老爷爷老奶奶了 去卡拉 OK 时也会点来唱成为如此永不褪色的经典存在 —— 德井青空\n「直到最后一刻 我们办到了」为了说出这句话一路努力过来就仅仅只是朝着这句话 剩下的时光中我们也会努力奔驰\n在仅有的时光中发光发热 是我们的使命把穗乃果她们 μ’s 九人的感情打造出形状是我们的使命至今为止 我们办到了\n我们永远都是 μ’s，至今的六年谢谢大家，尽管无法和各位立下约定，但我们还想和大家再次见面\n\n（节选自 μ’s Chronicle）\nμ’sic 如果奇迹有颜色，那么一定橙色，也是衍生的九色！\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","url":"/archives/final-lovelive-repo.html","date":"Oct 01, 2016"},{"title":"μ'sic forever","content":"从初回一单只有 434 的销量，到现在七单发售的第一天到处都抢光。\n\n2010 年 11 月 21 日，是她们九个人第一次以 μ’s 的名义和大家见面。\n2012 年 2 月 19 日，在横滨 BLITZ, 一个只有几百人的演唱会。\n2013 年 1 月 3 日，第二次演唱会，顺便在演唱会上公布了动漫的放送。\n2013 年 1 月 6 日，动漫正式开始放送，在第一季的时候，lovelive 的名气并没有多大。\n2013 年 6 月 16 日，只有几千人的演唱会，公布动漫第二季的时候，九个人都泪崩了\n\n\n「lovelive 还能继续呢」\n「能走到今天全是靠大家的支持」\n「这里会不会就是我们的最高点了呢」\n\n这样的感言她们九个人已经说了很多遍\n2014 年 2 月的 8 日到 9 日，在 SSA 举办了体育场模式 的演唱会，上万的粉丝加上在看转播的粉丝，反正就是有很多啦\n 2014 年 4 月，第二季动漫开始放送，也就是这个时候吧，lovelive 逐渐开始有名气了\n第二季动漫之后，觉得动漫完结了 μ’s 的活动还会不会继续呢，应广大群众的要求\n 2015 年 1 月 31 到 2 月 1 日，第五次演唱会开始了，也大概就是这个时候，人气开始极速上升，虽然我也 不知道为什么，反正就是从 2014 年到 2015 年人气都一直在上升。\n在第五次演唱会上宣布了下一个演唱会决定和剧场版\n九个人都笑着说\n\n「太好了还能继续呢！」\n「这真的是大家一起实现的梦想」\n\n还很清楚的记得你派说了「又能和大家一起开演唱会了」\n在第五演唱会上，这九个人都笑着炫耀说「今天我没有哭哦」之类的话，一边咬嘴唇吸鼻子还有 边跑边哭的德井大爷，用羽毛擦泪水的话唠彩， 说了无数次谢谢每次鞠躬都已经不止 90° 了。\n另外，还记得小鹿说「不想回去了！」\n麻吉天使「那就停在这里吧！」\n2015 年 3 月 7 日，在第九届声优奖里获奖\n 2015 年 6 月 3 日，在 Oricon 榜（日本最具知名度的音乐排行榜）6 月 8 日付周间 CD Album 排行榜中 5 月 27 日发售的 &quot;μ’s Best Album Best Live! collection II&quot; 获得第一名，同时也是月间排行榜第一名。\n同时 lovelive 剧场版也是票房 28 亿\n然后，就是！\n九位小姐姐真的做到了！\n红白歌会 μ’s 确认演出！（相当于中国春晩）\n同时决定在 12 月 4 日的 Music Station 中出场演唱\n 2015 年 6 月 15 日，决定了在东京巨蛋举办最后一场演唱会！\n从一个只有几百人在小小的会场里到现在东京巨蛋一张演唱会票都要炒到几十万，从一单被别人说垃圾的她们到现在一次次打下亚洲榜，获得 30 届日本金唱片大赏中，LoveLive! 关联作品获得了特别赏的奖项，μ’s Best Album Best Live! Collection II 获得年度最佳动画专辑的奖项\n剧场版动画《LoveLive! The School idol Movie》获得了第 39 回日本电影金像奖优秀动画作品奖。\nμ’s 到底是什么？\n是一单惨淡的销量么？\n是空无一人的大礼堂么？\n是 tn 经常性不关心的嗓子么？\n是 utchi 那维持鸟音的不易么？\n是三森努力遮盖的重黑眼圈么？\n是 Pile 刚出道的那些磕磕碰碰么？\n是 Sora 一人在无人的展台拍的照么？\n是南条在便利店硬是饿出来的泪水么？\n是 kssn 哭着说是和希一起成长的哽咽么？\n是 rippi 明明年龄最小却险些完全的下海么？\n是小鹿体验过的孤身一人没朋友的那感受么？\n五年如今，感谢有你们创造并赋予我们的奇迹 或许多年后她们会慢慢淡出人们的视野… 当年与 ller 所实现的梦想，创造的奇迹，初心不変，从未动摇，仍萦绕着九色梦幻般的光芒。\n再也没有什么可以替代了吧\n那个被称为搞笑艺人的 μ’s\n 那个打破次元墙的 μ’s\n 那个一路上磕磕绊绊的 μ’s\n 那个发起疯来连粉丝都怕的 μ’s\n 那个在舞台上挥洒汗水的 μ’s\n 那个一次次完成目标的 μ’s\n总而言之，最喜欢 μ’s 了！\n不会忘记她们来上海的那天，空丸很大声的说了 一句「还会再来」我相信，一定还会看见你们以 μ’s 的名义来大陆活动的。\n大家一起实现的故事！ LOVE LIVE!\n 向再见说再见，以后的路也请多多指教\nμ’sic forever!\n(注：本文出自 QQ 空间)\n","url":"/archives/%CE%BC'sic%20forever.html","date":"Oct 01, 2016"},{"title":"备份服务器数据至 git","content":"之前有过一篇《将 VPS 备份到 Dropbox 的脚本》，现在研究了一下备份到 git 的脚本，去他喵的 Dropbox\n#!/usr/bin/env bash\n\nMYSQL_USR=\"\"\nMYSQL_PWD=\"\"\n\nWEB_DIR=/data/wwwroot\nNGINX_CONF_DIR=/usr/local/tengine/conf\nSCRIPT_DIR=/root/bin\nLOCAL_BAK_DIR=/data/backup/to_git\nCOMMIT=\"Automatic Backup @ $(date)\"\n\neval `ssh-agent -s`\nssh-add ~/.ssh/github\n\nrm -rf $LOCAL_BAK_DIR\nmkdir -p $LOCAL_BAK_DIR\n\ngit clone git@github.com:kokororin/backup.git $LOCAL_BAK_DIR\n\ncd $LOCAL_BAK_DIR\ngit rm -rf .\ngit clean -fxd\n\ncp -r $WEB_DIR $LOCAL_BAK_DIR\ncp -r $NGINX_CONF_DIR $LOCAL_BAK_DIR/nginx_conf\ncp -r $SCRIPT_DIR $LOCAL_BAK_DIR/scripts\ncrontab -l > $LOCAL_BAK_DIR/scripts/crontab\n\nmkdir $LOCAL_BAK_DIR/db\n\nfor db in `/usr/local/mysql/bin/mysql -u$MYSQL_USR -p$MYSQL_PWD -B -N -e 'SHOW DATABASES' | xargs`; do\n    (/usr/local/mysql/bin/mysqldump -u$MYSQL_USR -p$MYSQL_PWD ${db} >  $LOCAL_BAK_DIR/db/${db}.sql\n    sed -i '$d' $LOCAL_BAK_DIR/db/${db}.sql)\ndone\n\n\ncd $LOCAL_BAK_DIR\n\ngit add -A\ngit commit -m \"$COMMIT\"\ngit push origin master\n\nrm -rf $LOCAL_BAK_DIR\n\n","url":"/archives/backup-vps-to-git.html","date":"Sep 30, 2016"},{"title":"Pixiv の画像を一括ダウンロード","content":"必要 → pixiv-api-php\n#!/usr/bin/env php\n&lt;?php\nrequire_once '/path/to/pixiv-api-php/pixiv.php';\n\n$word = '南ことり';\n\n$api = new PixivAPI();\n\n$result = $api->search_works($word, 1, 10, 'tag');\n$origin = [];\nwhile ($result['pagination']['next'] != '') {\n    foreach ($result['response'] as $value) {\n        array_push($origin, [\n            'filename' => $value['id'] . '_' . $value['title'] . '.jpg',\n            'url' => $value['image_urls']['large'],\n        ]);\n    }\n    $result = $api->search_works($word, $result['pagination']['next'], 10, 'tag');\n}\n\nforeach ($origin as $value) {\n    echo 'start: ' . $value['url'] . PHP_EOL;\n    download_image($value['url'], $value['filename']);\n}\n\nfunction download_image($url, $filename)\n{\n    $filepath = __DIR__ . '/dl/' . $filename;\n    if (is_file($filepath)) {\n        return;\n    }\n    $ch = curl_init();\n    curl_setopt($ch, CURLOPT_URL, $url);\n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n    curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 10);\n    curl_setopt($ch, CURLOPT_USERAGENT, 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.106 Safari/537.36');\n    curl_setopt($ch, CURLOPT_REFERER, 'http://www.pixiv.net/');\n    $result = curl_exec($ch);\n    curl_close($ch);\n    $fp = fopen($filepath, 'w');\n    fwrite($fp, $result);\n    fclose($fp);\n}\n\n","url":"/archives/pixiv-batch-download.html","date":"Aug 22, 2016"},{"title":"React Native 中的坑","content":"复合组件无法在 TouchableOpacity 使用\n&lt;TouchableOpacity&gt;\n        &lt;MyButton label=&quot;Press me!&quot; /&gt;\n&lt;/TouchableOpacity&gt;\n\n会报 Touchable child must either be native or forward setNativeProps to a native component ，这是因为：\n\nIf you run this you will immediately see this error: Touchable child must either be native or forward setNativeProps to a native component. This occurs because MyButton isn’t directly backed by a native view whose opacity should be set. You can think about it like this: if you define a component with React.createClass you would not expect to be able to set a style prop on it and have that work - you would need to pass the style prop down to a child, unless you are wrapping a native component. Similarly, we are going to forward setNativeProps to a native-backed child component.\n\n解决办法就是在 MyButton 组件中添加\nsetNativeProps(nativeProps) {\n    this._root.setNativeProps(nativeProps);\n  }\n\n其中 this._root 代表组件的引用\n0.29/0.30 中 flexDirection: row  布局异常\n改动前：\n imageContainer: {\n    flexDirection: 'row',\n    flexWrap: 'wrap'\n  }\n\n改动后：\n imageContainer: {\n    flexDirection: 'row',\n    flexWrap: 'wrap',\n    alignItems: 'flex-start'\n  }\n\n引入 moment.js\n参考 facebook/react-native#1629\nimport moment from 'moment';\nimport momentLocale from 'moment/locale/zh-cn';\n...\nmoment.updateLocale('zh-cn', momentLocale);\n\n","url":"/archives/vulnerable-react-native.html","date":"Aug 03, 2016"},{"title":"React Native 中的上传","content":"最近做了上传图片到服务端，其实不用第三方模块。\n窝建议直接和 web 端一样采用 multipart/form-data  来上传，这样 APP 端和 web 端用的接口可以通用，至于将图片编码成 base64，再到服务端解码保存也是可以的，且效率差别也不是很大。但是由于要改服务端的逻辑，我就懒得用这个方法了。\n\n如果仅从应用层观察，base64 是会按 4/3 比例增加传输成本。\n但实际操作上，物理层和 MAC 层协议本身是有做压缩和冗余，所以用 base64，至少在这两层上讲，传输成本并不会按照 4/3 比例增多，传输效率可能和纯二进制序列传输没什么区别。\n\n单文件\nlet formData = new FormData();\n\nlet params = {\n  uploadImg: {\n    uri: uri,\n    type: 'application/octet-stream',\n    name: 'image.jpg'\n  }\n};\n\nfor (let key in params) {\n  formData.append(key, params[key]);\n}\n\nfetch('https://api.domain.com/upload.json', {\n  body: formData,\n  method: 'post',\n  headers: {\n    'Auth-Token': 'XXXXX'//php端直接用$_SERVER['HTTP_AUTH_TOKEN]接收\n  }\n}).then((response) => {\n  console.log(response);\n});\n\n\n文件数组\nPHP 可以直接用文件数组批量上传文件\n&lt;input type=\"file\" name=\"image[]\" />\n&lt;input type=\"file\" name=\"image[]\" />\n&lt;input type=\"file\" name=\"image[]\" />\n&lt;input type=\"file\" name=\"image[]\" />\n&lt;input type=\"file\" name=\"image[]\" />\n\n然而我尝试在 RN 中也构造类似的结构却不行：\nlet params = {\n  'uploadImg[]': {\n    uri: uri,\n    type: 'application/octet-stream',\n    name: 'image.jpg'\n  },\n  'uploadImg[]': {\n    uri: uri,\n    type: 'application/octet-stream',\n    name: 'image.jpg'\n  }\n};\n\n于是按照 java web 里的类似方式构造是可以的：\nlet params = {\n  'uploadImg[0]': {\n    uri: uri,\n    type: 'application/octet-stream',\n    name: 'image.jpg'\n  },\n  'uploadImg[1]': {\n    uri: uri,\n    type: 'application/octet-stream',\n    name: 'image.jpg'\n  }\n};\n\n嫌麻烦的话使用 for 循环构造一下即可\n最后总结一下 RN 中有关图片的第三方包 (也是踩坑过程中碰到的 (｡･ω･｡))\n\nreact-native-image-picker 图片选取组件，但是不支持多选，裁剪功能不完善，窝现在只用到了它的照相功能，选取需要结合 react-native-image-crop-picker\nreact-native-image-crop-picker 和上面的类似，但是它支持多选和裁剪，然而不支持照相，所以…\nreact-native-image-resizer 这个主要用来压缩图片，一般 iOS 和 Android 拍摄出来的图片都有 3~5MB 左右，所以上传前压缩下当然是极好的\n\n","url":"/archives/react-native-upload.html","date":"Jul 27, 2016"},{"title":"React/React Native 的 ES5 ES6 写法对照表","content":"模块\n引用\n在 ES5 里，如果使用 CommonJS 标准，引入 React 包基本通过 require 进行，代码类似这样：\n//ES5\nvar React = require(\"react\");\nvar {\n    Component,\n    PropTypes\n} = React;  //引用React抽象组件\n\nvar ReactNative = require(\"react-native\");\nvar {\n    Image,\n    Text,\n} = ReactNative;  //引用具体的React Native组件\n\n在 ES6 里，import 写法更为标准\n//ES6\nimport React, { \n    Component,\n    PropTypes,\n} from 'react';\nimport {\n    Image,\n    Text\n} from 'react-native'\n\n注意在 React Native 里，import 直到 0.12 + 才能正常运作。\n导出单个类\n在 ES5 里，要导出一个类给别的模块用，一般通过 module.exports  来导出\n//ES5\nvar MyComponent = React.createClass({\n    ...\n});\nmodule.exports = MyComponent;\n\n在 ES6 里，通常用 export default 来实现相同的功能：\n//ES6\n\nexport default class MyComponent extends Component{\n    ...\n}\n\n引用的时候也类似：\n//ES5\nvar MyComponent = require('./MyComponent');\n\n//ES6\nimport MyComponent from './MyComponent';\n\n定义组件\n在 ES5 里，通常通过 React.createClass 来定义一个组件类，像这样：\n//ES5\nvar Photo = React.createClass({\n    render: function() {\n        return (\n            &lt;Image source={this.props.source} />\n        );\n    },\n});\n\n在 ES6 里，我们通过定义一个继承自 React.Component 的 class 来定义一个组件类，像这样：\n//ES6\nclass Photo extends React.Component {\n    render() {\n        return (\n            &lt;Image source={this.props.source} />\n        );\n    }\n}\n\n给组件定义方法\n从上面的例子里可以看到，给组件定义方法不再用 名字: function () 的写法，而是直接用名字 ()，在方法的最后也不能有逗号了。\n//ES5 \nvar Photo = React.createClass({\n    componentWillMount: function(){\n\n    },\n    render: function() {\n        return (\n            &lt;Image source={this.props.source} />\n        );\n    },\n});\n//ES6\nclass Photo extends React.Component {\n    componentWillMount() {\n\n    }\n    render() {\n        return (\n            &lt;Image source={this.props.source} />\n        );\n    }\n}\n\n定义组件的属性类型和默认属性\n在 ES5 里，属性类型和默认属性分别通过 propTypes 成员和 getDefaultProps 方法来实现\n//ES5 \nvar Video = React.createClass({\n    getDefaultProps: function() {\n        return {\n            autoPlay: false,\n            maxLoops: 10,\n        };\n    },\n    propTypes: {\n        autoPlay: React.PropTypes.bool.isRequired,\n        maxLoops: React.PropTypes.number.isRequired,\n        posterFrameSrc: React.PropTypes.string.isRequired,\n        videoSrc: React.PropTypes.string.isRequired,\n    },\n    render: function() {\n        return (\n            &lt;View />\n        );\n    },\n});\n\n在 ES6 里，可以统一使用 static 成员来实现\n//ES6\nclass Video extends React.Component {\n    static defaultProps = {\n        autoPlay: false,\n        maxLoops: 10,\n    };  // 注意这里有分号\n    static propTypes = {\n        autoPlay: React.PropTypes.bool.isRequired,\n        maxLoops: React.PropTypes.number.isRequired,\n        posterFrameSrc: React.PropTypes.string.isRequired,\n        videoSrc: React.PropTypes.string.isRequired,\n    };  // 注意这里有分号\n    render() {\n        return (\n            &lt;View />\n        );\n    } // 注意这里既没有分号也没有逗号\n}\n\n也有人这么写，虽然不推荐，但读到代码的时候你应当能明白它的意思：\n//ES6\nclass Video extends React.Component {\n    render() {\n        return (\n            &lt;View />\n        );\n    }\n}\nVideo.defaultProps = {\n    autoPlay: false,\n    maxLoops: 10,\n};\nVideo.propTypes = {\n    autoPlay: React.PropTypes.bool.isRequired,\n    maxLoops: React.PropTypes.number.isRequired,\n    posterFrameSrc: React.PropTypes.string.isRequired,\n    videoSrc: React.PropTypes.string.isRequired,\n};\n\n注意：对 React 开发者而言，static 成员在 IE10 及之前版本不能被继承，而在 IE11 和其它浏览器上可以，这有时候会带来一些问题。React Native 开发者可以不用担心这个问题。\n初始化 STATE\nES5 下情况类似，\n//ES5 \nvar Video = React.createClass({\n    getInitialState: function() {\n        return {\n            loopsRemaining: this.props.maxLoops,\n        };\n    },\n})\n\nES6 下，有两种写法：\n//ES6\nclass Video extends React.Component {\n    state = {\n        loopsRemaining: this.props.maxLoops,\n    }\n}\n\n不过我们推荐更易理解的在构造函数中初始化（这样你还可以根据需要做一些计算）：\n//ES6\nclass Video extends React.Component {\n    constructor(props){\n        super(props);\n        this.state = {\n            loopsRemaining: this.props.maxLoops,\n        };\n    }\n}\n\n把方法作为回调提供\n很多习惯于 ES6 的用户反而不理解在 ES5 下可以这么做：\n//ES5\nvar PostInfo = React.createClass({\n    handleOptionsButtonClick: function(e) {\n        // Here, 'this' refers to the component instance.\n        this.setState({showOptionsModal: true});\n    },\n    render: function(){\n        return (\n            &lt;TouchableHighlight onPress={this.handleOptionsButtonClick}>\n                &lt;Text>{this.props.label}&lt;/Text>\n            &lt;/TouchableHighlight>\n        )\n    },\n});\n\n在 ES5 下，React.createClass 会把所有的方法都 bind 一遍，这样可以提交到任意的地方作为回调函数，而 this 不会变化。但官方现在逐步认为这反而是不标准、不易理解的。\n在 ES6 下，你需要通过 bind 来绑定 this 引用，或者使用箭头函数（它会绑定当前 scope 的 this 引用）来调用\n//ES6\nclass PostInfo extends React.Component\n{\n    handleOptionsButtonClick(e){\n        this.setState({showOptionsModal: true});\n    }\n    render(){\n        return (\n            &lt;TouchableHighlight \n                onPress={this.handleOptionsButtonClick.bind(this)}\n                onPress={e=>this.handleOptionsButtonClick(e)}\n                >\n                &lt;Text>{this.props.label}&lt;/Text>\n            &lt;/TouchableHighlight>\n        )\n    },\n}\n\n箭头函数实际上是在这里定义了一个临时的函数，箭头函数的箭头 =&gt; 之前是一个空括号、单个的参数名、或用括号括起的多个参数名，而箭头之后可以是一个表达式（作为函数的返回值），或者是用花括号括起的函数体（需要自行通过 return 来返回值，否则返回的是 undefined）。\n// 箭头函数的例子\n()=>1\nv=>v+1\n(a,b)=>a+b\n()=>{\n    alert(\"foo\");\n}\ne=>{\n    if (e == 0){\n        return 0;\n    }\n    return 1000/e;\n}\n\n需要注意的是，不论是 bind 还是箭头函数，每次被执行都返回的是一个新的函数引用，因此如果你还需要函数的引用去做一些别的事情（譬如卸载监听器），那么你必须自己保存这个引用\n// 错误的做法\nclass PauseMenu extends React.Component{\n    componentWillMount(){\n        AppStateIOS.addEventListener('change', this.onAppPaused.bind(this));\n    }\n    componentDidUnmount(){\n        AppStateIOS.removeEventListener('change', this.onAppPaused.bind(this));\n    }\n    onAppPaused(event){\n    }\n}\n// 正确的做法\nclass PauseMenu extends React.Component{\n    constructor(props){\n        super(props);\n        this._onAppPaused = this.onAppPaused.bind(this);\n    }\n    componentWillMount(){\n        AppStateIOS.addEventListener('change', this._onAppPaused);\n    }\n    componentDidUnmount(){\n        AppStateIOS.removeEventListener('change', this._onAppPaused);\n    }\n    onAppPaused(event){\n    }\n}\n\n从这个帖子中我们还学习到一种新的做法：\n// 正确的做法\nclass PauseMenu extends React.Component{\n    componentWillMount(){\n        AppStateIOS.addEventListener('change', this.onAppPaused);\n    }\n    componentDidUnmount(){\n        AppStateIOS.removeEventListener('change', this.onAppPaused);\n    }\n    onAppPaused = (event) => {\n        //把方法直接作为一个arrow function的属性来定义，初始化的时候就绑定好了this指针\n    }\n}\n\nMixins\n在 ES5 下，我们经常使用 mixin 来为我们的类添加一些新的方法，譬如 PureRenderMixin\nvar PureRenderMixin = require('react-addons-pure-render-mixin');\nReact.createClass({\n  mixins: [PureRenderMixin],\n\n  render: function() {\n    return &lt;div className={this.props.className}>foo&lt;/div>;\n  }\n});\n\n然而现在官方已经不再打算在 ES6 里继续推行 Mixin，他们说：Mixins Are Dead. Long Live Composition。\n尽管如果要继续使用 mixin，还是有一些第三方的方案可以用，譬如这个方案\n不过官方推荐，对于库编写者而言，应当尽快放弃 Mixin 的编写方式，上文中提到 Sebastian Markbåge 的一段代码推荐了一种新的编码方式：\n//Enhance.js\nimport { Component } from \"React\";\n\nexport var Enhance = ComposedComponent => class extends Component {\n    constructor() {\n        this.state = { data: null };\n    }\n    componentDidMount() {\n        this.setState({ data: 'Hello' });\n    }\n    render() {\n        return &lt;ComposedComponent {...this.props} data={this.state.data} />;\n    }\n};\n//HigherOrderComponent.js\nimport { Enhance } from \"./Enhance\";\n\nclass MyComponent {\n    render() {\n        if (!this.data) return &lt;div>Waiting...&lt;/div>;\n        return &lt;div>{this.data}&lt;/div>;\n    }\n}\n\nexport default Enhance(MyComponent); // Enhanced component\n\n用一个 “增强函数”，来某个类增加一些方法，并且返回一个新类，这无疑能实现 mixin 所实现的大部分需求。\nES6 + 带来的其它好处\n解构 &amp; 属性延展\n结合使用 ES6 + 的解构和属性延展，我们给孩子传递一批属性更为方便了。这个例子把 className 以外的所有属性传递给 div 标签：\nclass AutoloadingPostsGrid extends React.Component {\n    render() {\n        var {\n            className,\n            ...others,  // contains all properties of this.props except for className\n        } = this.props;\n        return (\n            &lt;div className={className}>\n                &lt;PostsGrid {...others} />\n                &lt;button onClick={this.handleLoadMoreClick}>Load more&lt;/button>\n            &lt;/div>\n        );\n    }\n}\n\n下面这种写法，则是传递所有属性的同时，用覆盖新的 className 值：\n&lt;div {...this.props} className=&quot;override&quot;&gt;\n    …\n&lt;/div&gt;\n\n这个例子则相反，如果属性中没有包含 className，则提供默认的值，而如果属性中已经包含了，则使用属性中的值\n&lt;div className=&quot;base&quot; {...this.props}&gt;\n    …\n&lt;/div&gt;\n\n\n转自 http://bbs.reactnative.cn/topic/15/react-react-native-% E7%9A%84es5-es6% E5%86%99% E6% B3%95% E5% AF% B9% E7%85% A7% E8% A1% A8/2\n\n","url":"/archives/react-native-es5-es6-difference.html","date":"Jul 13, 2016"},{"title":"初探 memcached","content":"\n因为公司下一个项目要用到 Memcached 集群，所以学习下。。。\n\n安装\nbrew install memcached\ncp /usr/local/Cellar/memcached/1.4.24/homebrew.mxcl.memcached.plist ~/Library/LaunchAgents\nlaunchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.memcached.plist\n\n参数解释\n/usr/bin/memcached -d -m 128 -l 192.168.1.1 -p 11211 -u httpd\n\n-p 监听的端口\n-l 连接的IP地址, 默认是本机\n-d start 启动memcached服务\n-d restart 重起memcached服务\n-d stop|shutdown 关闭正在运行的memcached服务\n-d install 安装memcached服务\n-d uninstall 卸载memcached服务\n-u 以的身份运行 (仅在以root运行的时候有效)\n-m 最大内存使用，单位MB。默认64MB\n-M 内存耗尽时返回错误，而不是删除项\n-c 最大同时连接数，默认是1024\n-f 块大小增长因子，默认是1.25\n-n 最小分配空间，key+value+flags默认是48\n-h 显示帮助\n\n查看状态\ntelnet 127.0.0.1 11211\nstats\n\n这些状态的说明如下：\n\n\n\n参数名\n描述\n\n\n\n\npid\nmemcache 服务器的进程 ID\n\n\nuptime\n服务器已经运行的秒数\n\n\ntime\n服务器当前的 unix 时间戳\n\n\nversion\nmemcache 版本\n\n\npointer_size\n当前操作系统的指针大小（32 位系统一般是 32bit）\n\n\nrusage_user\n进程的累计用户时间\n\n\nrusage_system\n进程的累计系统时间\n\n\ncurr_items\n服务器当前存储的 items 数量\n\n\ntotal_items\n从服务器启动以后存储的 items 总数量\n\n\nbytes\n当前服务器存储 items 占用的字节数\n\n\ncurr_connections\n当前打开着的连接数\n\n\ntotal_connections\n从服务器启动以后曾经打开过的连接数\n\n\nconnection_structures\n服务器分配的连接构造数\n\n\ncmd_get\nget 命令（获取）总请求次数\n\n\ncmd_set\nset 命令（保存）总请求次数\n\n\nget_hits\n总命中次数\n\n\nget_misses\n总未命中次数\n\n\nevictions\n为获取空闲内存而删除的 items 数（分配给 memcache 的空间用满后需要删除旧的 items 来得到空间分配给新的 items）\n\n\nbytes_read\n总读取字节数（请求字节数）\n\n\nbytes_written\n总发送字节数（结果字节数）\n\n\nlimit_maxbytes\n分配给 memcache 的内存大小（字节）\n\n\nthreads\n当前线程数\n\n\n\n安装 &amp; 配置 php 扩展\nbrew install homebrew/php/php56-memcached \nphp-fpm.restart \n\n查看 phpinfo，可以看到配置成功\n\n未完待续\n","url":"/archives/php-memcached.html","date":"Apr 11, 2016"},{"title":"解决新版 Chrome 被强制显示的扩展图标","content":"\nGoogle Chrome 48.0.2564.116 开始，所有的扩展图标全部被显示出来了，包括国旗扩展也不能显示在地址栏了，看上去非常难受。\n\nWindows/Linux\n快捷方式 /.desktop 文件 增加启动项： --extension-action-redesign=0\nMac OS X\ncd /Applications/Google Chrome.app/Contents/MacOS\nmv Google\\ Chrome Chrome.real\nprintf '#!/bin/bash\\ncd \"/Applications/Google Chrome.app/Contents/MacOS\"\\n\"/Applications/Google Chrome.app/Contents/MacOS/Chrome.real\" --extension-action-redesign=0 \"$@\"\\n' > Google\\ Chrome\nchmod u+x Google\\ Chrome\n\n","url":"/archives/google-chrome-new-ui-solution.html","date":"Mar 09, 2016"},{"title":"Typecho 全站 pjax 方案","content":"\n其实最早添加 pjax 的时候就发现了评论会有问题，只是一直不知道怎么去解决，后来就放弃了。最近想出一种办法，使得全站 pjax 生效。\n（可能不具有通用性，因为我使用的 Ajax 评论不是 willin kan 的那款）\n\n搜索引擎搜到的有关 Typecho&amp;pjax 的内容主要有如下几篇：\n\nTypecho 使用 pjax\n解决因 pjax 导致 typecho 评论失效的问题\ntypecho 使用 pjax\nTypecho PJAX/AJAX 下评论丢失\n\n其中基本都要修改 Typecho 的内核代码，主要是 header 中的评论 js 输出，或者是用修改版 pjax.js。\n引入 js 文件\n&lt;script src=\"//cdn.bootcss.com/jquery/2.1.4/jquery.min.js\">&lt;/script>\n&lt;script src=\"//cdn.bootcss.com/jquery.pjax/1.9.6/jquery.pjax.min.js\">&lt;/script>\n\npjax 初始化\nfunction pjaxInit() {\n    var pjaxContainer = '#pjax-container',\n        pjaxSearchForm = '#search-form',\n        pjaxTimeout = 30000;\n\n    $(document).pjax('a[target!=_blank]', pjaxContainer, {\n        fragment: pjaxContainer,\n        timeout: pjaxTimeout\n    });\n    $(document).on('submit', 'pjaxSearchForm', function(event) {\n        $.pjax.submit(event, pjaxContainer, {\n            fragment: pjaxContainer,\n            timeout: pjaxTimeout\n        });\n    });\n    $(document).on('pjax:send', function() {\n        //载入动画\n    });\n    $(document).on('pjax:complete', function() {\n        //需要重载的插件\n        //载入动画结束\n        ajaxCommentRewrite();\n    });\n}\n\n干掉 TypechoComment\n在 bindCommentReplyButton () 方法中加入\najaxCommentRewrite();\n\najaxCommentRewrite () 方法的具体代码\n$(selector.commentReplyButton + ' a').prop('onclick', null).attr('href', 'javascript:;');\n$(selector.commentCancelReplyLink).prop('onclick', null).attr('href', 'javascript:;');\n\n原 Ajax 评论代码中需要修改的地方\nTypechoComment.cancelReply();\n\n替换为\ncancelReply();\n\najaxComments () 添加\nremoveTextareaEvent();\n\ncancelReply () 方法的具体代码\nfunction cancelReply() {\n    var response = $(selector.respondContainer)[0],\n        holder = $('#comment-form-place-holder')[0],\n        input = $('#comment-parent')[0];\n    if (null != input) {\n        input.parentNode.removeChild(input);\n    }\n    if (null == holder) {\n        return true;\n    }\n    $(selector.commentCancelReplyLink)[0].style.display = 'none';\n    holder.parentNode.insertBefore(response, holder);\n    return false;\n}\n\n\nremoveTextarea () 方法的具体代码\nfunction removeTextareaEvent() {\n    $(document).on('click', selector.submitTextarea, function() {\n        $(selector.submitForm + ' input[name=\"_\"]:not(#comment_)').remove();\n    });\n}\n\n\n使用 jQuery 重新绑定回复按钮和取消回复按钮事件\n $(document).on('click', selector.commentReplyButton, function() {\n     var cid = $(this).attr('data-cid'),\n         coid = $(this).attr('data-coid');\n     var comment = $('#' + cid)[0],\n         parent = comment.parentNode,\n         response = $(selector.respondContainer)[0],\n         input = $('#comment-parent')[0],\n         form = 'form' == response.tagName ? response : response.getElementsByTagName('form')[0],\n         textarea = response.getElementsByTagName('textarea')[0];\n     if (null == input) {\n         input = createElement('input', {\n             'type': 'hidden',\n             'name': 'parent',\n             'id': 'comment-parent'\n         });\n         form.appendChild(input);\n     }\n     input.setAttribute('value', coid);\n     if (null == document.getElementById('comment-form-place-holder')) {\n         var holder = createElement('div', {\n             'id': 'comment-form-place-holder'\n         });\n         response.parentNode.insertBefore(holder, response);\n     }\n     comment.appendChild(response);\n     $(selector.commentCancelReplyLink)[0].style.display = '';\n     if (null != textarea &amp;&amp; 'text' == textarea.name) {\n         textarea.focus();\n     }\n     return false;\n });\n\n$(document).on('click', selector.commentCancelReplyLink, function() {\n    cancelReply();\n});\n\ncreateElement () 方法具体代码\nfunction createElement(tag, attr) {\n    var el = document.createElement(tag);\n    for (var key in attr) {\n        el.setAttribute(key, attr[key]);\n    }\n    return el;\n}\n\n修改 comments.php\nform 中添加 (注意把 wrap 修改为你对应的 pjaxContainer)\n&lt;input name=\"_\" type=\"hidden\" id=\"comment_\" value=\"&lt;?php echo Helper::security()->getToken(str_replace(array('?_pjax=%23wrap', '&amp;_pjax=%23wrap'), '', Typecho_Request::getInstance()->getRequestUrl()));?>\"/>\n\n回复楼层按钮改为\n&lt;span class=\"reply\" data-cid=\"comment-&lt;?php $comments->coid();?>\" data-coid=\"&lt;?php $comments->coid();?>\">\n\n别忘了修改公共模板部分，通过添加 is_pjax () 方法来判断\nfunction is_pjax()\n{\n    return (isset($_SERVER['HTTP_X_PJAX']) &amp;&amp; $_SERVER['HTTP_X_PJAX'] == 'true');\n}\n\n至此 Ajax 评论的问题基本解决\n重载统计代码\n在 pjax:success 中添加\nif (window.ga) {\n    var location = window.location.pathname + window.location.search;\n    ga('send', 'pageview', {\n        'page': location,\n        'title': document.title\n    });\n}\n\n同时移除原来的\nga('send', 'pageview');\n\n","url":"/archives/typecho-pjax.html","date":"Feb 26, 2016"},{"title":"Pixiv LoveLive Viewer For Android","content":"简介\n这是一款从 Pixiv 插画网站搜索 LoveLive! 相关作品的 Android 应用，包含的标签有：\n\nラブライブ\n高坂穂乃果\n南ことり\n園田海未\n西木野真姫\n星空凛\n小泉花陽\n矢澤にこ\n絢瀬絵里\n东条希\n\n参考的开源项目\n\nthreezj/FuLiApp\ndrakeet/Meizhi\ntangqi92/BuildingBlocks\n\n所用到的开源库\n\nRealm (跨平台共享的数据库，可以完全取代 SQLite)\nVolley (HTTP 通信)\nGlide (平滑滚动的图片加载库)\nPagerSlidingTabStrip (使 ViewPager 的横线跟着屏幕的滑动而滑动)\n\n图片来源\n应用内图片来自于 Pixiv Public API，博主根据 Python 版整理出了 PHP 版\n应用截图\n\n\n\n\nTODO\n详见 GitHub\n源代码及下载\n\nDownload\nGitHub 源码\n\n","url":"/archives/pixiv-lovelive-viewer-for-android.html","date":"Feb 12, 2016"},{"title":"我们是合而为一的光芒","content":"从前，有一位女神，在一片荒野里种下了 18 种花，并将 9 束光芒分别赐予了她们。其中，橙光给了向日葵和非洲菊，蓝光给了紫色和蓝色的紫阳花，白光给了百合和水仙，绿光给了鳞托菊和圣诞玫瑰，黄光给了金毛菊和硫华菊，红光给了蔷薇和牡丹，紫光给了大春花和桔梗，水蓝光给了勿忘草和喜林草，粉光给了大丽花和康乃馨。起初，花朵们很瘦弱，光芒也并不明亮。很多人觉得，这些花甚至还没等到开放就会枯死。但这位女神却坚信着，这些花和光芒，终会绽放，终会将世界照亮。“因为感觉到了可能性，所以前进吧，不要让自己后悔，我们的明天就在前方！” 她轻轻地吟唱着，凝视着那些花儿。\n渐渐地，一朵花开放了、两朵开放了、三朵、四朵…… 她们发出的光芒也愈发明亮。转眼，5 年的时间过去了，期间不知经历了多少风雨之夜、不知经历了多少干旱与洪涝，但她们都一一挺了过来。终于，昔日的不毛之地变成了一片芬芳扑鼻、光彩绚烂夺目的大花园，她们发出的那九道光芒，也变成了一条壮丽耀眼的虹。每一个来到花园里的人，无不为之倾倒沉醉。当然，花园里的大家，也不乏坚信当初的那份希望而不辞辛苦地前来浇灌的人。他们笑得尤为开心。\n“啊，终于做到了呢！” 女神微笑道。“那么，就到此为止吧～与其任其枯萎而被人遗忘，不如就在这辉煌的时刻谢幕呢！” 得到这个消息的大家，顿时消沉了下来，悲声四起。“不可以这样哦～” 女神对大家说道，“no no no，いまが最高！” 女神再次吟唱。终于，大家不再悲伤，决定和花儿们、和九道光芒共同走过这最后的时光。花儿和光芒们仿佛也收到了感召，拼命地把自己的美呈现给大家。终于，那个时刻到来了。那是一个春天，花儿们刚刚完成了一次新的绽放，光芒也变得无比耀眼，大家笑着、跳着，仿佛遗忘了将要结束这件事。而在不知不觉中，女神轻轻一挥手，画面便永远地定格在了那个瞬间，那个瞬间，也深深烙印在了大家的记忆中。这时，从远处飞来了一只鸽子，它飞过花园上空，一片洁白的羽毛从它身上飘落，落在了那多散发着最耀眼的橙光的向日葵上……\n6 个月的等待，终于看到了传说中的剧场版。真正体验到了什么叫 “笑着笑着就哭了”。没错，笑点与泪点巧妙地糅合在一起、欢笑伴着感动，快乐伴着泪水，是剧场版最大的特点之一，也算是整个 lovelive 的一大特色。但说剧场版内容本身，不得不佩服制作方的细腻，几乎每个细节都有着非同一般的意义、都值得去细细品味。而且整体结构上十分紧凑，所有内容与主题的呼应都堪称完美。举例来说（来自贴吧大神 @Valencia_御 的分析），μ’s 在出发去美国前，希用塔罗牌占卜，出现的是星星牌，这张牌的图案中有着一个女子拿着两罐水，分别倒在水池和草地上，倒在草地上的水分成五股，代表着人的感官，最后又汇成一股，代表着潜意识。后面有颗树，代表着智慧。这张卡片的内容没有什么太多的东西，显得非常的祥和， 宁静。这张牌代表着内心的，宁静，和平，希望。这张牌代表的是巨变后的宁静，就是因为经历了大事件，自己已经没有什么可以在乎的，这个时候人才能真正的拥有时间去做该做的事。当一个人摆脱了世俗的看法和功利之后，才会真正的看开，得到新的希望。九颗星星代表了 μ’s 九人，其中黄色的那个，就是穗乃果这个 leader 啊！不论怎样，星星这张牌更多指的是内心。如果仔细看的话，这张牌多么应景啊！希虽然说这张牌适合出行，但是要我说，这张牌可以代表了整个剧场版的走向！μ’s 在这次美国之旅收获了不少东西，尤其是穗乃果，收获了一个长大了的自己，那个流浪歌手。那个流浪歌手长得看起来就像是长大后的穗乃果，蓝色的眼睛，头发暗了一些，但是不论你怎么看，不都是一个更加成熟稳重的穗乃果吗？她给在穗乃果迷路时，也就是比较危机的时候把她带了回来，并讲了不少有寓意的东西，在星星里，意思也是一样，在经历过危机之后得到了希望。而在大家看来，这个歌手其实就是长大后的穗乃果，也是她的内心，这更应了星星牌强调内心平静，希望的意思。当然，这只是一个小插曲，真正体现这张牌意思的在后面。回到日本，μ’s 突然发现粉丝变多了，到处都有人在尾随她们。突然间，她们变成了超级名人，所有人都期望着和她们合影，签名，希望参加她们的演唱会。可是，μ’s 已经解散了，去美国也不是自己想要去开演唱会，而是去为 ll 拉人气而已。每个粉丝都那么喜欢 μ’s，当然希望她们继续下去，但是大家都不知道 μ’s 解散了呢，那你怎么办？为了大家而继续？这正应了星星的意思，世俗功利等等都出现在了 μ’s 眼前，就连 A-RISE 也是决定继续活动，这让穗乃果更不坚定了。就在这时，长大后的穗乃果又出现了，就这么突然的出现，她说了一句，“你可以翱翔的。” 随后，穗乃果就出现在了一个想梦境的世界里，那里有这一个大 大的水坑，这其实就是穗乃果的内心世界，而那水坑，就是粉丝的期望，功利，世俗规矩。在她跳越水坑的时候，三年级三人让绘里发了一个信息给穗乃果，她们想要做偶像，校园偶像，自己毕业了，自然不能继续当校园偶像了，天下没有不散的筵席，再出名组合也会解散，我们何必这么纠结呢？多重推助下，穗乃果终于跨越了这到障碍，决定和大家，所有的校园偶像一起举办 live。是啊，如同星星牌所说的，在挣扎之后，当事人可以挣脱开世俗的眼光，功利等等等等，从而达到内心的平静，拥有希望。在看透了一切之后，穗乃果和 μ’s 不就是这样吗？平静的看待着一切，没有被其他人所影响。最后，还是解散了，μ’s 就和梦一样，完美，无暇，一切就这么结束了。星星再闪亮也会有黯淡的一天，我们不可否认的是，μ’s，解散了。\nμ’s 的成长经历，是一部充满了汗水与泪水、快乐与欢笑的奇迹。从一单 434 的销量到今年二专销量荣登 oricon 周冠，其他 cd 销量也频频位居 oricon 前茅、从不知道会不会有人来的 1st live 到 5th 的 sh 时全场 2w7k 粉丝的瞬间变色、从默默无闻到登上红白的舞台…… 不断创造着一个又一个的奇迹。“大家一同实现的故事” 的主题，得到了完美的诠释。lovelive 作为一部打破次元壁的作品，角色和声优们完全一心同体。比如这回的剧场版，大家都说那个女歌手是长大后的穗乃果，但我觉得她更像是 emi 本人。想想 emi 的经历，大学时组建了一个名为 the betty 的乐队，但是小有名气后便不明不白地解散了，不加入感情色彩的话，这不正是那个女歌手的经历么！\n 想起 3rd 上 emi 说 “这或许就是我人生的巅峰了吧”，她一定想不到，三年后，自己能和 μ’s 一同登上东京巨蛋的舞台演出吧？在 live 上，小姐姐们不停的说着谢谢，但我觉得，更应该去感谢的，不应该是我们 ller 么？就我个人而言，在我最消沉的日子中，lovelive 就像一道光芒，照亮了我的心，给了我无穷的力量。就所有 ller 而言，小姐姐们为我们献上了如此绝妙的演出，难道我们不该去感谢么？μ’s，你们就是我的小太阳，感谢你们让我学会了什么叫作实现梦想需要大家的勇气；感谢你们让我学会了什么叫做这是我们的奇迹；感谢你们让我学会了什么叫做障碍是可以打破的可以击碎的；感谢你们让我学会了什么叫做我们就活在当下；感谢你们让我学会了现在的这份苦楚也终将会转化成未来；感谢你们让我学会了什么叫做爱上你万岁…\n不久前，官方发布了 final live 的消息，怀着这种心情去看剧场版，心中多了一份伤感。“难道，真的要这样结束了么？” 心中虽有不甘，但仔细一想，这或许是最好的。小姐姐们年龄不断增加，身体也愈发力不从心了，从 emi 的嗓子到南酱的膝盖，种种迹象都表明，不能再给小姐姐们添加这种高负荷的活动了。虽然以后小姐姐们可能不会再作为 μ’s 进行活动，但 lovelive 给她们提供了一个很好的跳板和舞台，自己的事业也蒸蒸日上，作为粉丝的我们，不应该感到更高兴才是么？\n剧场版告诉我们，天下没有不散的宴席，再辉煌的历史，也终会掀过这一页。铁打的营盘，流水的兵，作为军迷，我更能理解这点。但是，不要说解散！因为 old soldier never die,they just fade away；更不要说解散就意味着各奔东西，因为那道光芒早已将我们紧紧相连，我们早已一心同体、合而为一！从出生的雏鸟已将翱翔天际的承诺到羽翼终长成振翅高飞踏上旅程的日子，我们永不会忘记。很抱歉没能在最初和你们一起见证奇迹的开始和成长，很抱歉没能在你们最困难的时候献出一己之力，纵使心中遗憾万千感慨万千，但也不愿多说，一切尽在不言中，只想把这份感情化作陪伴，陪伴你们直到终点。我坚信，直到最后，我们都是合而为一的光芒。还不必说再见，不必希望时光倒流，因为，ぃまか最高！最后，让我们一同喊出那句：μ’sic forever!\n\n\n\n","url":"/archives/lovelive-the-school-idol-movie.html","date":"Dec 18, 2015"},{"title":"Typecho 仿 (?) 百度统计插件","content":"\n没错这个插件就是仿百度统计的。\n\n现阶段功能：\n\n查看 IP/UV/PV\nip 归属地使用淘宝 API\n管理员登录时不记录日志\n查看来源页和来源域名排名\n修复 Referer 记录错误的 bug\n添加删除日志的功能\n\n\n\n\n\n\n论坛地址：http://forum.typecho.org/viewtopic.php?f=6&amp;t=9022\nGithub 地址：https://github.com/kokororin/typecho-plugin-Access\n","url":"/archives/typecho-plugin-access.html","date":"Dec 05, 2015"},{"title":"一些奇怪的 nginx 配置文件","content":"RT\nGravatar\nproxy_cache_path  /data/wwwroot/gravatar.kotori.love/cache  levels=1:2   keys_zone=gravatar:10m inactive=7d max_size=1g;\n \nserver {\n    listen 80;\n    listen 443 ssl http2;\n    server_name gravatar.kotori.love;\n    access_log /data/wwwlogs/gravatar.kotori.love_nginx.log combined;\n    include none.conf;\n\n    ssl_certificate /path/to/file;\n    ssl_certificate_key /path/to/file;\n    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n    ssl_stapling on;\n    ssl_ciphers \"ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA\";\n    ssl_session_cache shared:SSL:20m;\n    ssl_session_timeout 60m;\n    add_header Strict-Transport-Security \"max-age=63072000; includeSubdomains; preload\";\n \n    if ( $query_string ~* \".*[\\;'\\&lt;\\>].*\" ){\n        return 404;\n    }\n \n    location ~ .*\\.(wma|wmv|asf|mp3|mmf|zip|rar|jpg|gif|png|swf|flv)$ {\n        valid_referers none blocked *.kotori.love gravatar.kotori.love;\n        if ($invalid_referer) {\n            return 403;\n        }\n    }\n \n    location avatar/ {\n            valid_referers none blocked *.kotori.love gravatar.kotori.love;\n            if ($invalid_referer) {\n                    #return 403;\n            }\n    }\n \n    location / {\n        valid_referers none blocked *.kotori.love gravatar.kotori.love;\n            if ($invalid_referer) {\n                #return 403;\n            }\n        proxy_redirect                   off;\n        proxy_pass                       http://gravatar.com;\n        add_header                       Nginx-Cache            \"$upstream_cache_status\";\n        proxy_connect_timeout            180;\n        proxy_send_timeout               180;\n        proxy_read_timeout               180;\n        proxy_buffer_size                128k;\n        proxy_buffers                    4                    128k;\n        proxy_busy_buffers_size          128k;\n        proxy_temp_file_write_size       128k;\n        proxy_cache                      gravatar;\n        proxy_cache_valid                200                    302        1h;\n        proxy_cache_valid                404                    1m;\n        proxy_cache_key                  $uri$is_args$args;\n        proxy_set_header                 Host                $host;\n        proxy_set_header                 Accept-Encoding        \"\";\n        proxy_set_header                 X-Real-IP            $remote_addr;\n        proxy_set_header                 X-Forwarded-For        $proxy_add_x_forwarded_for;\n        subs_filter_types                text/css text/xml    application/xml    application/xml+rss;\n        subs_filter http://gravatar.com http://gravatar.kotori.love;\n    }\n}\n\n\nGoogle\nserver {\nlisten 443 ssl;\nserver_name g.kotori.love;\naccess_log /data/wwwlogs/g.kotori.love_nginx.log combined;\nindex index.html index.htm index.jsp index.php;\n#include none.conf;\n#root /data/wwwroot/g.kotori.love;\n\nssl_certificate /path/to/file;\nssl_certificate_key /path/to/file;\nssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n#ssl_ciphers ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RS\n#ssl_prefer_server_ciphers on;\nssl_session_cache shared:SSL:20m;\nssl_session_timeout 60m;\n\nresolver 8.8.8.8;\n\n\nlocation / {\n    google on;\n    google_language zh-CN;\n   # subs_filter '_\\.ua\\(\"rwt\",function\\(\\)\\{[^\\}]*\\}\\);' '' igr;\n   subs_filter '&lt;/head>' '&lt;style id=\"kotori-custom-css\">#gb_8,#gb_78,#gb_36,#gb_5,#gb_23,#gbztm,#gb_119,#gbi4s1{display:none}&lt;/style>&lt;/head>' o;\n   subs_filter '&lt;title>Google&lt;/title>' '&lt;title>Kotori\\'s Google&lt;/title>' o;\n   subs_filter '&lt;input value=\"Google 搜索\" aria-label=\"Google 搜索\" name=\"btnK\" type=\"submit\" jsaction=\"sf.chk\">' '&lt;input value=\"Kotori 一下\" aria-label=\"Google 搜索\" name=\"btnK\" type=\"submit\" jsaction=\"sf.chk\">' o;\n   subs_filter '&lt;div style=\"position:relative;color:#4285f4;font:16px/16px roboto-regular, arial, sans-serif;left:215px;top:76px\" nowrap=\"\">简体中文&lt;/div>' '&lt;div style=\"position:relative;color:#4285f4;font:16px/16px roboto-regular, arial, sans-serif;left:215px;top:76px\" nowrap=\"\">喵星人&lt;/div>' o; \n    }\n\n}\n\nupstream www.google.com {\n      server 74.125.224.80:443;\n      server 74.125.224.82:443;\n      server 74.125.224.81:443;\n      server 74.125.224.84:443;\n      server 74.125.224.83:443;\n}\n\nserver {\nlisten 80;\nserver_name g.kotori.love;\n#return 301 https://$server_name$request_uri;\nreturn 403;\n}\n\nGoogle Ajax lib\nproxy_temp_file_write_size 128k;\nproxy_temp_path   /var/cache/nginx/temp;\nproxy_cache_path  /var/cache/nginx/cache levels=1:2 keys_zone=cache_one:50m inactive=7d max_size=5g;\n\nupstream googleajax {\n    server ajax.googleapis.com:443;\n}\n\nserver {\n    listen 80;\n\n    server_name ajax.css.network;\n\n    resolver 8.8.8.8;\n\n    location / {\n        proxy_pass_header Server;\n        proxy_set_header Host ajax.googleapis.com;\n        proxy_set_header Accept-Encoding '';\n        proxy_redirect off;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Scheme $scheme;\n        proxy_pass https://googleajax;\n        proxy_cache cache_one;\n        proxy_cache_valid  200 304 365d;\n        proxy_cache_key $host$uri$is_args$args;\n        expires max;\n    }\n}\n\nserver {\n    listen 443 ssl spdy;\n\n    ssl on;\n    ssl_certificate /root/ssl/css.crt;\n    ssl_certificate_key /root/ssl/css.key;\n\n    ssl_prefer_server_ciphers on;\n    ssl_dhparam /etc/ssl/certs/dhparam.pem;\n    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n    ssl_ciphers \"EECDH+ECDSA+AESGCM EECDH+aRSA+AESGCM EECDH+ECDSA+SHA384 EECDH+ECDSA+SHA256 EECDH+aRSA+SHA384 EECDH+aRSA+SHA256 EECDH+aRSA+RC4 EECDH EDH+aRSA !aNULL !eNULL !LOW !3DES !MD5 !EXP !PSK !SRP !DSS !RC4\";\n    keepalive_timeout 70;\n    ssl_session_cache shared:SSL:10m;\n    ssl_session_timeout 10m; \n\n    server_name ajax.css.network;\n\n    resolver 8.8.8.8;\n\n    location / {\n        proxy_pass_header Server;\n        proxy_set_header Host ajax.googleapis.com;\n        proxy_set_header Accept-Encoding '';\n        proxy_redirect off;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Scheme $scheme;\n        proxy_pass https://googleajax;\n        proxy_cache cache_one;\n        proxy_cache_valid  200 304 365d;\n        proxy_cache_key $host$uri$is_args$args;\n        expires max;\n    }\n}\n\nGoogle Fonts lib\nupstream google {\n    server fonts.googleapis.com:443;\n}\n\nupstream gstatic {\n    server fonts.gstatic.com:443;\n}\n\nserver {\n    listen 80;\n\n    server_name fonts.css.network;\n\n    resolver 8.8.8.8;\n\n    location /css {\n        sub_filter 'fonts.gstatic.com' 'fonts.css.network';\n        sub_filter_once off;\n        sub_filter_types text/css;\n        proxy_pass_header Server;\n        proxy_set_header Host fonts.googleapis.com;\n        proxy_set_header Accept-Encoding '';\n        proxy_redirect off;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Scheme $scheme;\n        proxy_pass https://google;\n        proxy_cache cache_one;\n        proxy_cache_valid  200 304 365d;\n        proxy_cache_key $host$uri$is_args$args;\n        expires max;\n    }\n\n    location /icon {\n        sub_filter 'fonts.gstatic.com' 'fonts.css.network';\n        sub_filter_once off;\n        sub_filter_types text/css;\n        proxy_pass_header Server;\n        proxy_set_header Host fonts.googleapis.com;\n        proxy_set_header Accept-Encoding '';\n        proxy_redirect off;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Scheme $scheme;\n        proxy_pass https://google;\n        proxy_cache cache_one;\n        proxy_cache_valid  200 304 365d;\n        proxy_cache_key $host$uri$is_args$args;\n        expires max;\n    }\n\n    location / {\n        proxy_pass_header Server;\n        proxy_set_header Host fonts.gstatic.com;\n        proxy_redirect off;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Scheme $scheme;\n        proxy_pass http://gstatic;\n        proxy_cache cache_one;\n        proxy_cache_valid  200 304 365d;\n        proxy_cache_key $host$uri$is_args$args;\n        expires max;\n    }\n}\n\nserver {\n    listen 443 ssl spdy;\n\n    ssl on;\n    ssl_certificate /root/ssl/css.crt;\n    ssl_certificate_key /root/ssl/css.key;\n\n    ssl_prefer_server_ciphers on;\n    ssl_dhparam /etc/ssl/certs/dhparam.pem;\n    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n    ssl_ciphers \"EECDH+ECDSA+AESGCM EECDH+aRSA+AESGCM EECDH+ECDSA+SHA384 EECDH+ECDSA+SHA256 EECDH+aRSA+SHA384 EECDH+aRSA+SHA256 EECDH+aRSA+RC4 EECDH EDH+aRSA !aNULL !eNULL !LOW !3DES !MD5 !EXP !PSK !SRP !DSS !RC4\";\n    keepalive_timeout 70;\n    ssl_session_cache shared:SSL:10m;\n    ssl_session_timeout 10m; \n\n    server_name fonts.css.network;\n\n    resolver 8.8.8.8;\n\n    location /css {\n        sub_filter 'fonts.gstatic.com' 'fonts.css.network'; \n        sub_filter_once off;\n        sub_filter_types text/css;\n        proxy_pass_header Server;\n        proxy_set_header Host fonts.googleapis.com;\n        proxy_set_header Accept-Encoding '';\n        proxy_redirect off;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Scheme $scheme;\n        proxy_pass https://google;\n        proxy_cache cache_one;\n        proxy_cache_valid  200 304 365d;\n        proxy_cache_key $host$uri$is_args$args;\n        expires max;\n    }\n\n    location /icon {\n        sub_filter 'fonts.gstatic.com' 'fonts.css.network'; \n        sub_filter_once off;\n        sub_filter_types text/css;\n        proxy_pass_header Server;\n        proxy_set_header Host fonts.googleapis.com;\n        proxy_set_header Accept-Encoding '';\n        proxy_redirect off;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Scheme $scheme;\n        proxy_pass https://google;\n        proxy_cache cache_one;\n        proxy_cache_valid  200 304 365d;\n        proxy_cache_key $host$uri$is_args$args;\n        expires max;\n    }\n\n    location / {\n        proxy_pass_header Server;\n        proxy_set_header Host fonts.gstatic.com;\n        proxy_redirect off;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Scheme $scheme;\n        proxy_pass https://gstatic;\n        proxy_cache cache_one;\n        proxy_cache_valid  200 304 365d;\n        proxy_cache_key $host$uri$is_args$args;\n        expires max;\n    }\n}\n\n","url":"/archives/nginx-config-file.html","date":"Nov 29, 2015"},{"title":"OS X 下配置 Nginx+PHP+MySQL","content":"Homebrew\nMac 下的 Homebrew 相当于 Linux 下的 apt-get、yum，可以获得最新版的各种安装包。\nruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\"\n\n安装完成后，运行以下命令检查是否安装成功\nbrew doctor\n\n然后更新、升级下 brew 源\nbrew update &amp;&amp; brew upgrade\n\nPHP-FPM\n添加必须的 tap\nbrew tap homebrew/dupes\nbrew tap homebrew/php\n\n安装 php5.6\nbrew install --without-apache --with-fpm --with-mysql php56\n\n自动启动 php\nmkdir -p ~/Library/LaunchAgents\nln -sfv /usr/local/opt/php56/homebrew.mxcl.php56.plist ~/Library/LaunchAgents/\n\n启动 php\nlaunchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.php56.plist\n\nMySQL\n安装\nbrew install mysql\n\n自动启动 MySQL\nln -sfv /usr/local/opt/mysql/*.plist ~/Library/LaunchAgents\n\n启动 MySQL\nlaunchctl load ~/Library/LaunchAgents/homebrew.mxcl.mysql.plist\n\n配置密码\nmysql_secure_installation\n\nNginx\n安装\nbrew install nginx\n\n设置自动启动\nsudo cp -v /usr/local/opt/nginx/*.plist /Library/LaunchDaemons/\nsudo chown root:wheel /Library/LaunchDaemons/homebrew.mxcl.nginx.plist\n\n配置\n创建 nginx 文件夹及配置文件\nmkdir -p /usr/local/etc/nginx/logs\nmkdir -p /usr/local/etc/nginx/sites-available\nmkdir -p /usr/local/etc/nginx/sites-enabled\nmkdir -p /usr/local/etc/nginx/conf.d\n\n修改 /usr/local/etc/nginx/nginx.conf\nuser Kotori staff;#修改对应用户名，如果你想把Document Root放在家目录下的话，反之注释\nworker_processes  1;\n\nerror_log  /usr/local/etc/nginx/logs/error.log debug;\n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include             mime.types;\n    default_type        application/octet-stream;\n\n    log_format  main  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '\n                      '$status $body_bytes_sent &quot;$http_referer&quot; '\n                      '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';\n\n    access_log  /usr/local/etc/nginx/logs/access.log  main;\n\n    sendfile            on;\n\n    keepalive_timeout   65;\n\n    autoindex on;\n    autoindex_exact_size off;\n    autoindex_localtime on;\n\n    index index.html index.php;\n\n    include /usr/local/etc/nginx/sites-enabled/*;\n}\n\n修改 /usr/local/etc/nginx/conf.d/php-fpm\nlocation ~ \\.php$ {\n    try_files      $uri = 404;\n    fastcgi_pass   127.0.0.1:9000;\n    fastcgi_index  index.php;\n    fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;\n    include        fastcgi_params;\n}\n\n修改默认虚拟主机配置\n /usr/local/etc/nginx/sites-available/default\nserver {\n    listen       80;\n    server_name  localhost;\n    root       /Users/Kotori/Documents/htdocs;#这是自定义目录\n\n    access_log  /usr/local/etc/nginx/logs/default.access.log  main;\n\n    location / {\n        include   /usr/local/etc/nginx/conf.d/php-fpm;\n    }\n\n    location = /info {\n        allow   127.0.0.1;\n        deny    all;\n        rewrite (.*) /.info.php;\n    }\n\n    error_page  404     /404.html;\n    error_page  403     /403.html;\n}\n\n软链接配置\nln -sfv /usr/local/etc/nginx/sites-available/default /usr/local/etc/nginx/sites-enabled/default\n\n启动\nsudo launchctl load /Library/LaunchDaemons/homebrew.mxcl.nginx.plist\n\n一些便利的 alias\nalias nginx.start='sudo launchctl load /Library/LaunchDaemons/homebrew.mxcl.nginx.plist'\nalias nginx.stop='sudo launchctl unload /Library/LaunchDaemons/homebrew.mxcl.nginx.plist'\nalias nginx.restart='nginx.stop &amp;&amp; nginx.start'\nalias php-fpm.start=&quot;launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.php56.plist&quot;\nalias php-fpm.stop=&quot;launchctl unload -w ~/Library/LaunchAgents/homebrew.mxcl.php56.plist&quot;\nalias php-fpm.restart='php-fpm.stop &amp;&amp; php-fpm.start'\nalias mysql.start=&quot;launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.mysql.plist&quot;\nalias mysql.stop=&quot;launchctl unload -w ~/Library/LaunchAgents/homebrew.mxcl.mysql.plist&quot;\nalias mysql.restart='mysql.stop &amp;&amp; mysql.start'\nalias nginx.logs.error='tail -250f /usr/local/etc/nginx/logs/error.log'\nalias nginx.logs.access='tail -250f /usr/local/etc/nginx/logs/access.log'\nalias nginx.logs.default.access='tail -250f /usr/local/etc/nginx/logs/default.access.log'\n\n\n参考 &amp; 精简自 frdmn’s notes\n\n","url":"/archives/install-nginx-php-mysql-on-osx.html","date":"Nov 19, 2015"},{"title":"Chrome 扩展开发笔记","content":"\n今天研究了一下 Chrome 扩展的基本结构，尝试着开发了一款音乐播放器 (Kotori Music Player)。随便记点东西。\n\n先看看这个拓展的效果，如下图:\n\n\n基本结构\nChrome 扩展都包含一个 Manifest 文件 ——manifest.json，这个文件可以告诉 Chrome 关于这个扩展的相关信息，它是整个扩展的入口，也是 Chrome 扩展必不可少的部分。 Chrome 扩展的 Manifest 文件必须包含 name、version 和 manifest_version 属性，目前来说 manifest_version 属性值只能为数字 2，对于应用来说，还必须包含 app 属性。\n其他常用的可选属性还有 browser_action、page_action、background、permissions、options_page、content_scripts，所以我们可以保留一份 manifest.json 模板，当编写新的扩展时直接填入相应的属性值。如果我们需要的属性不在这个模板中，可以再去查阅官方文档，但我想这样的一份模板可以应对大部分的扩展了。下面就放上 Kotori Music Player 的 manifest.json 文件模板：\n{\n    \"icons\": { //定义了一些图标文件，放在images文件夹下，每个图标的名称和像素需要对应。\n        \"16\": \"images/icon-16.png\",\n        \"32\": \"images/icon-32.png\",\n        \"48\": \"images/icon-48.png\",\n        \"128\": \"images/icon-128.png\"\n    },\n    \"browser_action\": { // browser_action指定扩展的图标放在Chrome的工具栏中\n        \"default_popup\": \"popup.html\",\n        \"default_icon\": { // 定义了在工具栏中显示的图标\n            \"19\": \"images/icon-19.png\",\n            \"38\": \"images/icon-38.png\"\n        }\n    },\n    \"manifest_version\": 2,//manifest的版本，这里现在填2就好了\n    \"name\": \"Kotori Music Player\",//扩展的名字\n    \"version\": \"1.4\",扩展的当前版本，这里由你自己控制，以后升级的时候，要比当前版本高就好了。\n    \"description\": \"调用虾米API播放选定的精选集，支持歌词同步显示。\",// 对于这个拓展的描述\n    \"background\": {\n        \"page\": \"background.html\",\n        \"persistent\": true\n    },\n    \"options_page\": \"options.html\",\n    \"permissions\": [\n        \"tabs\",\n        \"storage\",\n        \"notifications\",\n        \"http://*/*\",\n        \"https://*/*\"\n    ]\n}\n\n以上除了 permissions 都能根据字面意思理解，permissions 属性中声明需要跨域的权限。一些 API 比如 tabs,notifications,\ncontextMenus 等都需要在 permissions 中声明。\n接下来看一下 background.html，主要就是放置一个 audio 标签，用于后台播放歌曲文件。\n&lt;html>\n&lt;head>\n&lt;meta charset=\"utf-8\"/>\n&lt;/head>\n&lt;body>\n   &lt;audio id=\"music\" src=\"\">&lt;/audio>\n   &lt;script type=\"text/javascript\" src=\"js/jquery.min.js\">&lt;/script>\n   &lt;script type=\"text/javascript\" src=\"js/global.js\">&lt;/script>\n   &lt;script type=\"text/javascript\" src=\"js/background.js\">&lt;/script>\n&lt;/body>\n&lt;/html>\n\n其中主要的 JavaScript 脚本 background.js 如下，主要包括精选集解析，歌曲解析，LRC 格式歌词解析。在 background 处理完必要的事件后，将一些需要和前台 popup 交互的元素复制到变量里：\n//各种需要用到的变量\nvar audio = $('#music').get(0);\nvar item = null;\nvar isPlaying = false;\nvar currentMusic = 0;\nvar prevMusic = -1;\nvar repeat = parseInt(localStorage.repeat);\nvar ratio = 0;\nvar name = '';\nvar artist = '';\nvar cover = '';\nvar playlist = null;\nvar lyricUrl = null;\nvar lyric = null;\nvar collectID = getCollectID();\n\n$.ajax({\n    url: 'http://kotori.sinaapp.com/xiami/collect/' + collectID,\n    type: 'get',\n    dataType: 'json',\n    async: false,\n    success: function(data) {\n        playlist = data;\n    },\n    error: function() {\n        showNotification({\n            type: \"basic\",\n            title: 'Message',\n            message: 'Kotori API Error',\n            iconUrl: 'images/icon-128.png'\n        });\n    }\n});\n\n\nconsole.log('&lt;&lt;&lt;Kotoriの电台>>>');\nconsole.log('Version : 20150719');\nconsole.log('Current Music: ' + currentMusic + ' Repeat: ' + repeat);\n\n\nvar loadMusic = function(i) {\n\n    currentMusic = localStorage.currentMusic = i;\n    //console.log(localStorage.currentMusic);\n    item = playlist[i];\n\n    $.ajax({\n        type: \"get\",\n        async: false,\n        dataType: \"json\",\n        url: 'https://kotori.sinaapp.com/xiami/single/' + item.id,\n        success: function(data) {\n\n            if (data.url != null) {\n                src = data.url;\n                audio.setAttribute(\"src\", src);\n                cover = data.img;\n                artist = data.artist_name;\n                name = data.name;\n                lyricUrl = data.lyric;\n\n                if (isPlaying) {\n                    play();\n                    \n                     showNotification({\n                         type: \"basic\",\n                         title: name,\n                         message: artist,\n                         iconUrl: cover\n                     });\n                    \n                }\n\n                console.log('Song Title: ' + data.name + ' Song Artist: ' + data.artist_name);\n            } else {\n\n                showNotification({\n                    type: \"basic\",\n                    title: 'Message',\n                    message: '歌曲获取失败，请重试。',\n                    iconUrl: 'images/icon-128.png'\n                });\n\n            }\n        },\n    });\n}\n\nvar changeMusic = function(i) {\n    loadMusic(i);\n}\n\nvar randomNum = function(min, max) {\n    return Math.floor(min + Math.random() * (max - min));\n}\n\nvar autoChange = function() {\n    var nextMusic = 0;\n    switch (repeat) {\n        case 0:\n            prevMusic = currentMusic;\n            nextMusic = randomNum(0, playlist.length);\n            changeMusic(nextMusic);\n            break;\n        case 1:\n            audio.currentTime = 0.0;\n            play();\n            break;\n        case 2:\n            if (currentMusic == playlist.length - 1) {\n                changeMusic(0);\n            } else {\n                changeMusic(currentMusic + 1);\n            }\n            break;\n    }\n}\n\nvar updateProgress = function() {\n    if (audio.currentTime == audio.duration) {\n        //autoChange();\n        next();\n    }\n    ratio = audio.currentTime / audio.duration * 100;\n}\n\n\nvar getLyric = function() {\n    if (lyricUrl == null) {\n        return;\n    }\n    $.ajax({\n        url: lyricUrl,\n        type: 'get',\n        dataType: 'text',\n        async: false,\n        success: function(data) {\n            lyric = parseLyric(data);\n        },\n        error: function() {\n            showNotification({\n                type: \"basic\",\n                title: 'Message',\n                message: 'Lyric Fetch Error',\n                iconUrl: 'images/icon-128.png'\n            });\n        }\n    });\n}\n\nvar parseLyric = function(text) {\n    //get each line from the text\n    var lines = text.split('\\n'),\n        //this regex mathes the time [00.12.78]\n        pattern = /\\[\\d{2}:\\d{2}.\\d{2}\\]/g,\n        result = [];\n\n    // Get offset from lyrics\n    var offset = getOffset(text);\n\n    //exclude the description parts or empty parts of the lyric\n    while (!pattern.test(lines[0])) {\n        lines = lines.slice(1);\n    };\n    //remove the last empty item\n    lines[lines.length - 1].length === 0 &amp;&amp; lines.pop();\n    //display all content on the page\n    lines.forEach(function(v, i, a) {\n        var time = v.match(pattern),\n            value = v.replace(pattern, '');\n        time.forEach(function(v1, i1, a1) {\n            //convert the [min:sec] to secs format then store into result\n            var t = v1.slice(1, -1).split(':');\n            result.push([parseInt(t[0], 10) * 60 + parseFloat(t[1]) + parseInt(offset) / 1000, value]);\n        });\n    });\n    //sort the result by time\n    result.sort(function(a, b) {\n        return a[0] - b[0];\n    });\n    return result;\n}\n\nvar getOffset = function(text) {\n    //Returns offset in miliseconds.\n    var offset = 0;\n    try {\n        // Pattern matches [offset:1000]\n        var offsetPattern = /\\[offset:\\-?\\+?\\d+\\]/g,\n            // Get only the first match.\n            offset_line = text.match(offsetPattern)[0],\n            // Get the second part of the offset.\n            offset_str = offset_line.split(':')[1];\n        // Convert it to Int.\n        offset = parseInt(offset_str);\n    } catch (err) {\n        //alert(\"offset error: \"+err.message);\n        offset = 0;\n    }\n    return offset;\n}\n\n\nvar play = function() {\n    audio.play();\n    getLyric();\n    timeout = setInterval(updateProgress, 500);\n    //setInterval(showLyric, 1000);\n    isPlaying = true;\n\n}\n\n\nvar pause = function() {\n    audio.pause();\n    clearInterval(timeout);\n    isPlaying = false;\n}\n\nvar next = function() {\n    if (repeat == 0) {\n        prevMusic = currentMusic;\n        nextMusic = randomNum(0, playlist.length);\n        changeMusic(nextMusic);\n    } else if (currentMusic == playlist.length - 1) {\n        changeMusic(0);\n    } else {\n        changeMusic(currentMusic + 1);\n    }\n}\n\nvar previous = function() {\n    if (repeat == 0 &amp;&amp; prevMusic != -1) {\n        changeMusic(prevMusic);\n        prevMusic = randomNum(0, playlist.length);\n    } else if (currentMusic == 0) {\n        changeMusic(playlist.length - 1);\n    } else {\n        changeMusic(currentMusic - 1);\n    }\n}\n\n\n//初始化操作\nloadMusic(currentMusic);\n\n\n关于 LRC 歌词文件，一般格式如下：\n[ar:文筱芮]\n[by:airplay]\n[00:00.00]那个\n[00:03.00]作词:文筱芮 作曲:文筱芮\n[00:06.00]编曲:于韵非\n[00:09.00]制作人:胡海泉 秦天\n[00:12.00]演唱:文筱芮\n\n这样挺有规律的，用正则可以很方便地将时间与歌词提取分离。\n但凡事得多个心眼啊。事后发生的事情证明这句话有多正确。我在整理歌词时还发现了另外一种形式，像下面这样：\n[ar:庭竹]\n[al:爱的九宫格]\n[by:airplay]\n[00:00.17]庭竹 - 公主的天堂\n[00:05.40]作曲:陈嘉唯、Skot Suyama 陶山、庭竹\n[00:07.33]作词:庭竹\n[00:15.59]风铃的音谱 在耳边打转\n[00:18.62]城堡里 公主也摆脱了黑暗的囚禁\n[00:22.82]她一点点地 无声悄悄地慢慢长大\n[00:26.36]期待着 深锁木门后的世界\n[01:38.72][00:29.76]\n[01:51.48][00:30.32]树上 小鸟的轻响 在身边打转\n[01:55.35][00:34.09]公主已 忘记木制衣橱背后的惆怅\n[01:59.65][00:38.35]她跳舞唱歌天真无邪地寻找属于自己的光亮和快乐\n[02:06.98][00:45.76]\n[02:07.41][00:46.06]树叶一层层拨开了伪装\n[02:11.29][00:50.25]彩虹一步步露出美丽脸庞 无限的光亮\n\n这种形式的歌词把歌词内容相同但时间不同的部分合并，节省了篇幅。\n所以，现在知道的歌词其实有两种写法了，不过都还算规律，用正则可以搞定，只是对于第二种，处理时得将时间再次分割。\nJavaScript 解析法上面已经给出，本扩展最开始采用的是 PHP 解析成 JSON 格式，但是试过效率并不高，代码如下：\n    private function parseLyric($lyric)\n    {\n        if ($lyric) {\n            // 远程获取歌词内容\n            $content = @file_get_contents($lyric);\n\n            // 按”回车换行“将歌词切割成数组\n            $array = explode(\"\\n\", $content);\n            $lrc = array();\n\n            foreach ($array as $val) {\n                // 清除掉”回车不换行“符号\n                $val = preg_replace('/\\r/', '', $val);\n\n                // 正则匹配歌词时间\n                $temp = preg_match_all('/\\[\\d{2}\\:\\d{2}\\.\\d{2}\\]/', $val, $matches);\n                if (!empty($matches[0])) {\n                    $data_plus = \"\";\n                    $time_array = array();\n\n                    // 将可能匹配的多个时间挑选出来，例如：[00:21]、[03:40]\n                    foreach ($matches[0] as $V) {\n                        $data_plus .= $V;\n                        $V = str_replace(\"[\", \"\", $V);\n                        $V = str_replace(\"]\", \"\", $V);\n                        $date_array = explode(\":\", $V);\n\n                        // 将例如：00:21、03:40 转换成秒\n                        $time_array[] = intval(intval($date_array[0] * 60) + intval($date_array[1]));\n                    }\n\n                    // 将上面的得到的时间，例如：[00:21][03:40]，替换成空，得到歌词\n                    $data_plus = str_replace($data_plus, \"\", $val);\n\n                    // 将时间和歌词组合到数组中\n                    foreach ($time_array as $V) {\n                        //$lrc[] = array($V, $data_plus);\n                        $lrc['time' . $V] = $data_plus;\n                    }\n                }\n            }\n\n            // 按时间顺序来排序数组\n            //$lrc = $this->bsort($lrc);\n\n            // 输出 json格式\n            return json_encode($lrc);\n        }\n        return 'no lyric';\n    }\nprivate function bsort(array $array)\n    {\n        $count = count($array);\n        for ($i = 0; $i &lt; $count; $i++) {\n            for ($j = $count - 1; $j > $i; $j--) {\n                if ($array[$j][0] &lt; $array[$j - 1][0]) {\n                    $temp = $array[$j];\n                    $array[$j] = $array[$j - 1];\n                    $array[$j - 1] = $temp;\n                }\n            }\n        }\n        return $array;\n    }\n\n下面看一下 popup.html 文件的内容，该页面主要就是播放器和播放列表。\n&lt;html>\n&lt;head>\n  &lt;meta charset=\"utf-8\">\n  &lt;link rel=\"stylesheet\" type=\"text/css\" href=\"css/popup.css\">\n&lt;/head>\n&lt;body>\n  &lt;div id=\"popup\">\n    &lt;div id=\"nav_buttons\" role=\"button\">\n      &lt;div class=\"breadcrumb-part\">&lt;/div>\n      &lt;span class=\"tab-text\">正在播放&lt;/span>\n      &lt;input type=\"text\" placeholder=\"搜索播放列表...\" id=\"search\" style=\"display:none;\" />\n    &lt;/div>\n    &lt;div id=\"loadingOverlay\" style=\"display: none;\" class=\"regularLoadingOverlay\">&lt;/div>\n    &lt;div id=\"close_nav\" style=\"display:none;\" title=\"Click to close navigation\">X&lt;/div>\n    &lt;div id=\"navigate\" style=\"display:none;\">\n    &lt;/div>\n\n    &lt;div id=\"player\">\n      &lt;div id=\"album_art\" class=\"big_art\">\n        &lt;img id=\"album_art_img\" src=\"../images/default_album_med.png\" height=\"128\" width=\"128\" />\n      &lt;/div>\n      &lt;div id=\"song_indicator\">&lt;/div>\n      &lt;div id=\"song_info\">\n        &lt;div id=\"song_title\">&lt;/div>\n        &lt;div id=\"artist\">&lt;/div>\n        &lt;div id=\"lyric\">&lt;/div>\n      &lt;/div>\n      &lt;div id=\"time_and_slider\">\n        &lt;div class=\"player-middle\">\n          &lt;div id=\"slider\" class=\"goog-slider-horizontal goog-slider-track\" role=\"slider\" tabindex=\"0\">\n            &lt;div class=\"playing-progress-background\">\n              &lt;div id=\"played_slider\">&lt;/div>\n            &lt;/div>\n            &lt;div class=\"goog-slider-thumb\" style=\"top: 21px; left: 15px; display:none;\">&lt;/div>\n          &lt;/div>\n        &lt;/div>\n        &lt;div id=\"time\">\n          &lt;span id=\"current_time\">0:00&lt;/span> / &lt;span id=\"total_time\">0:00&lt;/span>\n        &lt;/div>\n      &lt;/div>\n      &lt;div id=\"controls\">\n        &lt;div id=\"rew\" class=\"goog-flat-button goog-inline-block\" title=\"Previous song\" style=\"-webkit-user-select: none; \">&lt;/div>\n        &lt;div id=\"playPause\" class=\"goog-flat-button goog-inline-block\" title=\"Play\" style=\"-webkit-user-select: none; \">&lt;/div>\n        &lt;div id=\"ff\" class=\"goog-flat-button goog-inline-block\" title=\"Next song\" role=\"button\" style=\"-webkit-user-select: none; \">&lt;/div>\n      &lt;/div>\n    &lt;/div>\n\n  &lt;/div>\n  &lt;script src=\"js/jquery.min.js\">&lt;/script>\n  &lt;script src=\"js/popup.js\">&lt;/script>\n&lt;/body>\n&lt;/html>\n\n这里的 js 文件主要就是控制 background 页面中的 audio 标签，就不给出篇幅了。\n关键一句就是 var bg = chrome.extension.getBackgroundPage(); \n 通过 bg.xx 就可以调用 background 中的变量和方法。\n歌词同步的具体思路：\n\n首先将 LRC 文件读取为文本\n用 String.prototype.split (’\\n’); 将整个文本以换行符为单位分隔成一行一行的文本，保存到一个数组中\n然后将开头部分不属于歌词的文本去掉，得到只有时间与歌词的干净文件\n对于每一行，匹配出时间与文字，分别存入数组 [time,text]，然后将每行得到的这样的数组存入一个大的数组 [[time,text],[time,text]…]\n利用 Audio 标签的 ontimeupdate 事件，不断比较当然播放时间 audio.currentTime 与数组中每个元素中时间，如果当前时间大于某个歌词中的时间，则显示该歌词\n\n到这里本文就基本结束了，以后再补充好了 233333\n项目地址\nGitHub\n安装地址\nChrome Web Store\n参考文档\n入门：建立 Chrome 扩展程序\n chrome.tabs\n 如何从零开始写一个 Chrome 扩展？\n官方入门文档\n Chrome 扩展开发笔记\n论 HTML5 Audio 标签歌词同步的实现\n","url":"/archives/chrome-extension-notes.html","date":"Oct 06, 2015"},{"title":"使用 aria2 黑科技高速下载百度等网盘文件","content":"\n百度云已经开始了强退会员的政策，没有会员的用户速度稳定保持在 200KB/s。\n\n虽然有破解版的百度云管家，不过还是不太稳定。偶然发现一个使用 VPS 下载百度云的方法：\n需要做以下准备工作：\n\nChrome 浏览器或 Firefox 浏览器\n\n这里以 Chrome 举例：\n首先安装百度网盘助手扩展程序。\n已下架，可以去 GItHub 手动安装。\n支持一些其它网盘 115 下载助手\n打开某百度盘页面，选择导出下载，复制 aria2 链接。\n\n登录 SSH，或者直接在 Mac/Linux 终端中直接粘贴刚才的链接。\n\n可以看到速度还是比直接下载快很多的 233333\n","url":"/archives/download-baiduyun-with-aria2.html","date":"Sep 27, 2015"},{"title":"Typecho 友链插件修复","content":"\nTypecho 官网上有一个名为 PageToLinks 的插件，其作用是把某个特定页面（友情链接页面）中的链接提取出来，并插入到模版公共区域。\n不过经过测试不支持 MarkDown 的页面，所以进行了一下修改并整合到现在这个主题中。\n\n如果你的友情链接页面中最终的格式是这样的：\n&lt;ul>\n &lt;li>&lt;a href=\"https://www.baidu.com\">baidu&lt;/a>&lt;/li>\n ...\n &lt;/li>\n&lt;/ul>\n...\n&lt;ul>\n...\n&lt;/ul>\n\n那么本文的代码就适合，下面放上代码，扔到 functions.php 中。\nfunction links($slug)\n{\n    $db = Typecho_Db::get();\n    $Contents = Typecho_Widget::widget('Widget_Abstract_Contents');\n    $value = $db->fetchRow($db->select()\n            ->from('table.contents')\n            ->where('table.contents.status = ?', 'publish')\n            ->where('table.contents.type = ?', 'page')\n            ->where('table.contents.slug = ?', $slug)\n            ->where('table.contents.password IS NULL')\n            ->limit(1));\n    $value = $Contents->filter($value);\n    if (0 === strpos($value['text'], '')) {\n        $value['isMarkdown'] = 0;\n    } else {\n        $value['isMarkdown'] = 1;\n    }\n    if ($value['isMarkdown'] == 1) {\n        $text = substr($value['text'], 15);\n        $text = $Contents->markdown($text);\n    } else {\n        $text = $Contents->autoP($value['text']);\n    }\n\n    $search = '/&lt;ul>(.*?)&lt;\\/ul>/is';\n    preg_match_all($search, $text, $matches);\n    $result = '';\n    foreach ($matches[1] as $v) {\n        $result .= $v;\n    }\n    //以下三行稍微处理了一下，如果不需要删除就可以\n    $result = str_replace('&lt;li>', '', $result);\n    $result = str_replace('&lt;/li>', '&lt;br/>', $result);\n    $result = rtrim($result, '&lt;br/>');\n    echo $result;\n}\n\n在需要输出友链的模版中插入以下代码：\n&lt;?php links('links');?>\n\n其中 links 函数的参数需要填写友情链接页面的 slug（别名），比如这里的就是 links。\n到这里就大功告成啦 ｷｬ━━━━(ﾟ∀ﾟ)━━━━!!\n","url":"/archives/typecho-pagetolinks.html","date":"Sep 26, 2015"},{"title":"Typecho IP 黑名单插件","content":"一个很简单的 IP 过滤插件，可以根据 IP 地址黑名单，来限制访问网站。\n预览图\n\n设置界面\n\n下载地址\nGitHub\n","url":"/archives/typecho-plugin-blockip.html","date":"Sep 11, 2015"},{"title":"(转) 慢慢的，就没有了，就像从未存在过","content":"\n作者：小海 原文发于豆瓣，已被河蟹\n\n几年以前，我曾经嘲笑过某科技界大佬。当时他说：也许 90 后、95 后会慢慢不知道谷歌是什么网站。\n那一年，这对于我来说简直就是世界上最好笑的笑话。谷歌，全世界最卓越的互联网公司，活在互联网的一代中国人，会不知道他们的网站？\n今天，我收回这句嘲笑。因为这件不可能的事，它慢慢变成了现实。\n没有人再关注什么谷歌不谷歌。对他们来说，百度也蛮好用的，反正他们几乎没用过谷歌。没有谷歌又怎样？大家还是开心的刷微博，看微信，听歌，看娱乐节目。对于从来就不知道谷歌的人来说，少了谷歌又有什么影响？\n多年前，我们也是可以登陆 Facebook 的。其实这个网站和校内一样，也挺蠢的。可在上面你能看到老外们的生活，可以轻易的跟一万公里以外的人互相拜访，可以看到很多根本不会开到校内上的主页。你用汉语回复，下面给你聊起来的可能是香港仔，可能是台湾人。你用英语回复，说不定有比你英语用的更蹩脚的寂寞的北欧人来跟你搭讪。你感觉地球真的变成了地球村，你还没拉门走出去，别人就推门走了进来。\n然后，它就没有了。起初，它的失踪激起了很大的声音，后来，声音就消失了。\n多年前，我们也是可以登陆 Twitter 的。其实这个网站和微博一样，也不过是些信息流，刷上一整天，也不见得有什么用处。但至少，你可以以最快速度获取你想知道的任何新事，你会真正了解什么事情在全世界是流行的，而不是经过各种截图、翻译、转发，甚至曲解、断章取义、黑白颠倒的东西。你知道的是真相，赤裸裸的，也许有点太短的真相。但至少中间不会有无数人的加工与再加工，偏激、片面，就在这个过程中产生了，不管后来者有意还是无意。\n然后，它就没有了。首先是它的本体没有了，然后它的模仿者也没有了，模仿者的模仿者也没有了。只剩一个模仿者的模仿者的模仿者，现在你每天能在上面看到无数广告。\n多年前，我们也是可以登陆 YouTube 的。对于有的人来说，这个网站就是个大型优酷，当年有人信誓旦旦的说，没有 YouTube，我们中国人会很快让优酷超过 YouTube。可这么多年过去了，视频还是那么卡，内容还是那么垃圾，原创还是那么容易被盗窃，视频丰富度还是那么的可怜。在 YouTube 上，你能看到全世界最棒的手艺人，最逗乐的笑话，最天马行空的创意，最激荡人心的音乐，最美好的完美瞬间，可在优酷上，你想看一分钟视频，请先看半分钟广告。\n哦，对了。Instagram，有些人可能感觉它和 QQ 空间也差不多。可我在上面关注了六百多个摄影师，它们都是顶好顶好的影像记录者，每天看他们的作品，我感觉到很幸福，那种即使没有到那里去，也身临其境的幸福。我还在上面认识了一个日本的爱自拍的帅小伙，一个爱喝酒的韩国大叔，一个十年前到过中国今天会在每张我发的紫禁城照片下点赞的美国大爷，一个美丽无比的俄罗斯妹子，我和他们基本上都难以交流，语言是很大的障碍，但几个简单的单词，心意也就到了，这种感觉，有时候比多年老友相聚还兴奋。因为这是人类不同族群自由交流互相沟通的过程，这种过程很神奇，真的很神奇。\n可现在，它没有了，它之所以没有就因为在某个特定的时间你在搜索特定的词汇时，会搜出来特定的照片。虽然这么搜的人并不多，虽然看到的人也不会大惊小怪，也不会觉得天黑了，天亮了，天要塌了，天要变了。可它就是没了，Instagram，就这么没了。谷歌也是这么没的，Twitter 也是这么没的，Facebook 也是这么没的。不知道是什么人，在什么场合，说了什么话，下了什么决定。就要有超过十亿人像陷于哥谭市的孤岛里一样，看着一座又一座桥梁被炸掉，又被炸掉，又被炸掉，然后，就什么都没了。\n我时常觉得悲哀，真的好悲哀，一个我根本不认识也不知道是谁的人，也许是一个群体，在不断抢走我身边的东西，而我却无能为力。我抱怨一声，他听不到，任何人都听不到。我怒吼一句，身边的大多数人却像看疯子一样的看着我。我哀嚎一声，这声音被阻碍在黑黑的幕墙以里。我发出尖锐的嘶吼，这声音传不了多远，就和我那被抢走的东西一样，消失了，不见了，就像从来没存在过一样。\n对于本来就没存在过的东西，有谁又会觉得在意呢？那些本来拥有又被掠夺的人的哀愁，后来的人又怎么懂呢？我曾经是拥有一切的，我曾经是拥有世界的，我站在这片土地上，呼吸的是自由的空气，饮下的是自由的琼浆玉液。就在长的无法计数的时间里，我自由生命的一部分又一部分就这么被杀死了，突然就杀死了。可我还始终觉得，它们还奄奄一息的活着，就像它们是慢慢的死去的一样。\n可它们终归是死了，而且随着它们的死，愈来愈多的事情慢慢的发生了，很慢很慢，几乎不被人察觉，可还是发生了。\n没有谷歌，我可以用百度呀。可某些结果被越挪越后，越挪越后，最后就不见了。就像本来就不该搜出这个结果一样。\n没有 Facebook，我可以用校内呀。可你想发只有在 Facebook 上能发的文章，很快在校内上就失踪了。接着，校内变成了人人，话题变成了人人都关心的话题。大家都在抢着看星座、明星、八卦、娱乐。没有人会关心什么消失了，反正它们本来也没多少存在感。\n没有 YouTube，我可以用优酷呀。可你却经常只能在优酷上看到抄袭别人的作品，而且还不署名，而且还洋洋得意，而且还自我陶醉，就好像那个 idea 本来属于他自己一样。你看了还要惊呼，他是如此的有创意！好一个抄袭的创意，可你却不知道，因为你不知道这个世界上有个网站叫 YouTube。\n没有 Twitter，我还可以用微博呀。可你想知道最近发生了什么，你搜的越勤快，越能看到越明显的 “根据相关法律法规，相关搜索结果不予显示”。时间长了，你想，反正知道了也没什么用，不如不看了。\n慢慢的，一扇又一扇的门关上了。今天你打开世界上最大的博客网站，发现它没了。明天你一看，世界上最好的设计师分享网站没了，一开始是刷新的很慢很慢，后来它就没了。过两天再一看，平常每天都会读两篇文章的媒体网站没了，那里的文章缤纷多彩，最后都变成了该页无法显示几个字。再过几个月，大学的网站不让上了，摄影师的网站不让上了，就连百度日本这种自家网站，也没了。\n接着，漫画看不了了，接着，动画看不成了。接着，美剧英剧失踪了。下载美剧英剧的网站又又又失踪了。尊重正版，保护权益，行吧，然后字幕网站也没了。\n游戏没了，你习惯性登陆的游戏网站，发现下载栏正在整治中。论坛关了，天天都在看的论坛，突然接到相关部门的电话，因为 “报备问题” 不让办了。个人网站，私人博客，对不起，说没就没有，你在上面存了多少多年辛勤耕耘的东西都没用。\n你关注的人，有一天你登陆微博，发现他怎么好久都没说话了，然后你搜索了一下，发现他的账号不存在了，而且你搜他的名字，他的名字未予显示。\n一盏一盏的灯，灭了。四面八方的光源，消失了。我们生活的五光十色的世界，变成了一片黑色。\n天黑了，那么睡觉吧，但愿长醉不复醒。\n最后，我们变成了一群做梦的人，这个梦的名字，叫根据相关法律法规，相关搜索结果不予显示梦。\n","url":"/archives/fuck-gfw.html","date":"Aug 31, 2015"},{"title":"nginx 自定义 header","content":"首先放上效果图：\n\n默认情况下你能看到的 http response 应该是这样的：\nHTTP/1.1 200 OK\nServer: nginx/1.6.0\nDate: Tue, 28 Apr 2015 14:46:43 GMT\nContent-Type: text/html; charset=UTF-8\nConnection: keep-alive\nVary: Accept-Encoding\nX-Powered-By: PHP/5.3.28\nVary: Accept-Encoding, Cookie\nCache-Control: max-age=3, must-revalidate\n\n\nngx_header_more 这个模块用于添加、设置和清除输入和输出的头信息。nginx 源码没有包含该模块，需要另行添加。\n该模块是 ngx_http_headers_module 模块的增强版，提供了更多的实用工具，比如复位或清除内置头信息，如 Content-Type, Content-Length, 和 Server。\n\n从 Github 上下载源码包后解压，并进入 nginx 源码目录，比如：\ncd /root/lnmp/src/nginx-1.8.0\n\n使用 nginx -V 查看当前 nginx 的编译参数，比如我的是：\nconfigure arguments: --prefix=/usr/local/nginx --user=www --group=www --with-http_stub_status_module --with-http_spdy_module --with-http_ssl_module --with-ipv6 --with-http_gzip_static_module --with-http_realip_module --with-http_flv_module\n\n然后把需要编译的模块加入：\nmake clean\n./configure --prefix=/usr/local/nginx --user=www --group=www --add-module=../headers-more-nginx-module-0.261 \\\n--with-http_stub_status_module --with-http_spdy_module --with-http_ssl_module --with-ipv6 --with-http_gzip_static_module --with-http_realip_module --with-http_flv_module\n# 以上的../headers-more-nginx-module-0.261就是刚才解压的ngx_headers_more的源码包。\nmake\nmv /usr/local/nginx/sbin/nginx{,$(date +%m%d)}\ncp objs/nginx /usr/local/nginx/sbin\nservice nginx restart\nmkdir -p /var/nginx/cache/one\nchown -R www.www /var/nginx\n\n完成后，在 nginx.conf 中的 http 块加入：\n##For Custom Header##\n  map $host $server_x_tag{\n    'kotori.love' 'Kotori';\n    default 'nginx';\n  }\n\n在虚拟主机配置文件 server 块中加入：\nmore_set_headers 'Server: $server_x_tag';\n\n最后重新载入 nginx 即可。\n","url":"/archives/nginx-custom-header.html","date":"Aug 19, 2015"},{"title":"安装 Ubuntu Server 并配置 LNMP 环境","content":"\n这篇文章给大家介绍一下如何在 Windows 系统下的 Virtual Box 虚拟机软件中安装 Ubuntu Server 系统，并配置一个 Linux+Nginx+Mysql+PHP，本文仅适合新手。\n\n准备工作\n\n下载 Virtualbox 并安装\n在网易开源镜像站下载 Ubuntu Server 14.04\n\n安装系统\n\n由于 VBox 默认的虚拟电脑位置位于系统分区，建议移到其他分区。\n\n\n\n新建一个虚拟电脑内存选择 512M，磁盘大小选择 20GB，其他配置保持默认即可。\n\n\n\n启动刚刚创建的虚拟电脑，选择下载的 iso 文件。\n选择语言 English\n\n\n\n回车选择 Install\n\n\n\n下一步照样选择 English\n\n\n\n地区推荐选择 HongKong\n\n\n\n下一步将会检测键盘布局，选择 No\n\n\n\n下一步回车\n再次回车，之后等待安装程序配置，可能需要一段时间\n\n\n\n配置 Hostname，默认 Ubuntu 就可以\n配置用户名，我这里使用 kotori，下一步回车\n配置密码，输入 kotori，询问密码弱的话不用理会，选择 Yes\n是否加密 home，选择 No\n\n\n\n询问时区是否正确，选择 Yes\n下面将开始分区，选择 Manual，之后选择刚刚创建的虚拟磁盘\n\n\n\n\n是否创建分区表，选择 Yes\n选择 Create a new partition，输入 21.0GB，分区类型选择 Primary，位置选择 Begining，然后选择 Done setting up the partition\n\n\n\n接下来还剩余一个 475MB 的空间，把该空间创建为 swap，与上一步大致一样，类型选择 Logical，位置选择 End，Use as 选择 swap area\n\n\n\n是否写入选择 Yes，接下来等待系统安装，可能会比较慢，请耐心等待\n安装完后，询问是否使用 HTTP 代理，直接回车\n询问是否自动更新，选择 No automatic updates\n使用空格键选择 OpenSSH Server，回车\n\n\n\n最后一步啦，选择 Yes，稍等一会会自动重启，到这里 Ubuntu Server 正式安装完成\n\n\n配置 LNMP\n\n登陆进入系统后，依次输入以下命令\n\nwget http://mirrors.linuxeye.com/lnmp-full.tar.gz\ntar xzf lnmp-full.tar.gz\ncd lnmp\nsudo ./install.sh\n\n\n安装选项如下选择\n\n\n\n\n安装时间较长，完成后，需进行网络配置，先将虚拟机关机 sudo poweroff，然后设置，添加一块网卡\n\n\n\n启动虚拟机后，输入 ip address 命令，可以看到多出了一个块 eth1 网卡，但是没有 ip 地址\n\n\n\n输入  sudo vim /etc/network/interfaces ，如下编辑，不会用 vim 的话请使用 nano\n\n\n\n保存后重启，再起输入 ip address 可以看到 eth1 已经有了 ip 地址了\n在实体机的浏览器中输入刚刚的 ip 地址，成功打开则安装成功\n\n\n未完待续。\n","url":"/archives/install-ubuntu-server-and-lnmp.html","date":"Aug 18, 2015"},{"title":"写了个 php 框架 (?)","content":"\nPHP 框架是 PHP 程序员开发的有利武器，在你用了一些框架之后，我相信你有一天会突发奇想 “我要自己写一个属于我自己的 PHP 框架”。\n\n为啥自己开发框架？\n框架和其他程序一样，是用来解决问题的。如果你没有遇到问题，为什么要重新制造轮子？可能只是为了开发方便？但是，通过写个框架更好的理解原理也是一件好事。\n大部分 PHP 框架做的事情：\n\n代码重用：定义包、类、函数的放置和加载规则，建议直接整合 Composer 及其 AutoLoad 特性。\n请求的分发管理：这个就是路由，Rest 风的框架喜欢 Rewrite，简单的一点的框架主要通过参数来定位模块和方法所在。\n配置文件管理：加载和动态加载配置数据\n错误和异常管理：异常捕捉、错误日志记录以及错误码规范。\nLayOut 和模板引擎：如何规划页面布局、widget 如何重用、ajax 页面如何结合、过期 session 如何重定向；数据和模板怎么渲染成 HTML，是否压缩和设置过期头。\n数据库：如何融入控制器；支持什么样的 driver；考虑主从分离的扩展性；以及是否使用 ORM。\n\n关于本框架\n还是进入正题吧，本框架的名字定为 KotoriFramework，翻译成中文就叫 “鸟框架”。初衷还是为了应付一些小项目，比如个人的小博客程序之类的。内部函数命名极大的参考了 ThinkPHP（误～。不过路由的方法还是参照了 TP 的说。本框架应该暂时没有什么特点，不知道小算不算特点？框架没有繁琐的目录结构，系统核心文件也是单文件（我把所有类都放在了一个文件里，当然是单文件了！）既然是小（微）型框架，当然没有什么附加的功能了，基本功能都有，其他成熟框架附带的一些 Helper 都是没有哒～如果要拓展功能的话，比如想加入一个分页类、Markdown 解析类之类的东西，这些都有目录可以拓展，简单快捷。\n目前唯一不足的地方可能是没有 Model 层，不过这应该也不算微型框架的缺点吧，暂时先写这些，个人感觉文档还是比较完善的，放上 Github 地址。\n","url":"/archives/kotori-php-framework.html","date":"Aug 09, 2015"},{"title":"Android 反编译","content":"\n这篇草稿存了好久了，还是发出来吧。\n\n首先介绍下要用到的工具：\n\njdk: Java Development Kit\nbaksmali：把 classes.dex 转为为 smali 文件的工具\ndex2jar：classes.dex 转为 jar 包的工具\njdgui：阅读 jar 文件的工具\nsmali：把 smali 文件编译打包为 classes.dex 的工具\n\n其中关于 baksmali 和 smali 可以看下谷歌的介绍\n反编译后得到的 dex 文件以及转为 jar 包后都无法进行修改，只能把 dex 文件转化为 smali 文件进行修改，然后再编译打包为 dex 文件，替换掉原有 apk 中的 dex 文件，然后对 apk 进行签名，这样就完成了对 apk 源码的修改，具体步骤如下：（以下操作是在 linux 下进行，windows 可能会略有差异）\n1. 解压 apk 文件，获取 classes.dex 并拷贝到资源根目录（使用 zip 或其他解压工具即可）\n2. 使用 baksmali 工具将 classes.dex 转为 smali 文件，在命令行定位到资源根目录并执行：\njava -jar baksmali-2.0.3.jar -x classes.dex \n\n执行完后会在当前目录下生成 out 目录，目录结构跟源码相同，在对应目录下查找对应的 smali 文件\n3. 使用 dex2jar 工具把 dex 转为 jar 文件，拷贝 classes.dex 到资源目录下的 dex2jar-0.0.9.15 目录下，把命令行定位到该目录并执行：\n   ./dex2jar.sh classes.dex  (windows:dex2jar.bat classes.dex)\n\n执行完后会在当前目录下生成 classes_dex2jar.jar 文件，然后可以通过 jdgui 进行查看\n4. 使用 jdgui 工具查看 HelloWorld 的源码，根据不同的系统打开资源目录下对应的 jdgui 工具，然后把第 3 步生成的 classes_dex2jar.jar 文件拖到工具中\n5. 修改对应的 smali 文件\n6. 使用 smali-2.0.3.jar 工具把 smali 文件转为 dex 文件，把命令行定位到资源根目录并执行：\n  java -jar smali-2.0.3.jar -o classes.dex out \n\n执行完后会生成并替换掉根目录下的 classes.dex 文件，这样就修改成功了\n7. 把新生成的 classes.dex 文件替换到原来的 apk 文件里（使用压缩工具）\n8. 使用签名工具对 apk 进行签名，把 apk 拷贝到资源根目录下的 sign_tool 目录，把命令行定位到该目录并执行：\n   java -jar signapk.jar platform.x509.pem platform.pk8 HelloWorld.apk Signed.apk\n\n执行完后会在该目录下生成 Signed.apk 文件，这个文件就是最终的文件了。\n","url":"/archives/decompile-apk.html","date":"Aug 01, 2015"},{"title":"一言同步数据","content":"\n简单来说，一言（ヒトコト）指的是就是一句话，可以是动漫中的台词，可以是小说中的语句，也可以是网络上的各种小段子。\n或是感动，或是开心，又或是单纯的回忆，来到这里，留下你所喜欢的那一句句话，与大家分享，这就是一言存在的目的。\n\n但是官方服务器比较慢（同时有倒闭的威胁），于是把它同步到本地。提供几个 API：\nHTML TABLE\nJSONP\n\n参数说明\n id 一言的 ID，可以通过 http://hitokoto.us/view/{ID}.html 查看指定条目\n hitokoto 一言的正文部分，不包含前后引号\n cat 分类，对应关系如下\n a Anime - 动画\n b Comic - 漫画\n c Game - 游戏\n d Novel - 小说\n e 原创\n f 来自网络\n g 其他\n catname 分类 cat 对应的名字\n author 一言的投稿人\n source 一言的出处，可能为空\n date 一言的投稿日期\n\n","url":"/archives/hitokoto-data.html","date":"Jul 15, 2015"},{"title":"简单使用 php 获取 gravatar 头像","content":"\nGravatar 头像已经成为了博客、论坛等非常流行的通用头像，他能使你的网站的留言者根据自己的邮箱匹配不同的 Gravatar 头像。但不可否认的是 Gravatar 头像的服务器及缓存服务器位于国外，由于受到了干扰，国内无法打开 Gravatar 头像服务器及缓存服务器，导致了 Gravatar 头像无法显示，这样严重的拖累了网站的打开速度，甚至会因为一篇文章的留言非常多，需要加载几百个 Gravatar 头像图片，大量 HTTP 请求的发送，直接导致了网页加载缓慢、网站出现打不开的现象。\n\npo 主之前用的是 v2ex 的源，感觉速度不太理想，所以以下代码就诞生了。\nheader(\"Content-type:image/png\");\n$path_info  = $_SERVER['PATH_INFO'];\n$path_array = explode('/', $path_info);\n\n$m     = ($path_array[2] != null) ? $path_array[2] : $_GET['m'];\n$s     = isset($_GET['s']) ? $_GET['s'] : '60';\n$r     = isset($_GET['r']) ? $_GET['r'] : 'g';\n$query = http_build_query(array(\n    'gravatar_id' => $m,\n    'size'        => $s,\n    'rating'      => $r,\n));\n\n$url = 'https://secure.gravatar.com/avatar/index.php?' . $query;\n$ch  = curl_init();\ncurl_setopt($ch, CURLOPT_URL, $url);\ncurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\ncurl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 5);\n$res = curl_exec($ch);\necho $res;\ncurl_close($ch);\n\n演示地址：\nhttp://api.kotori.love/gravatar/06a2950d128ec9faf155e28d9e889baa?s=100&amp;r=g\n 如果要使用缓存的话，Github 上有一个现成的项目。\n要应用在 WordPress 中，将以下代码加入 functions.php 中：\nfunction MyAvatar($avatar) {\n        $avatar = str_replace(array(\"www.gravatar.com/avatar\",\"0.gravatar.com/avatar\",\"1.gravatar.com/avatar\",\"2.gravatar.com/avatar\",\"secure.gravatar.com\"),\"beta.api.kotori.love/gravatar\",$avatar);\n        return $avatar;\n}\nadd_filter('get_avatar', 'MyAvatar');\n\n最后附上一个 Nginx 反代的配置：\nhttp {\n  proxy_cache_path  /var/cache/nginx levels=1:2 keys_zone=gravatar:8m max_size=10000m inactive=600m;\n  proxy_temp_path /var/cache/nginx/tmp;\n\n  server {\n    listen 80;\n    server_name ruby-china.org;\n\n    location /avatar {\n      proxy_redirect     off;\n      proxy_set_header   Host $host;\n      proxy_set_header   X-Forwarded-Host $host;\n      proxy_set_header   X-Forwarded-Server $host;\n      proxy_set_header   X-Real-IP        $remote_addr;\n      proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;\n      proxy_pass         http://gravatar.com;\n      proxy_cache ruby_china;\n      proxy_cache_valid  200 302  300d;\n      proxy_cache_valid  404 502  1m;\n      expires           7d;\n    }\n  }\n}\n\n","url":"/archives/fetch-gravatar-with-php.html","date":"Jul 12, 2015"},{"title":"Typecho 主题制作总结","content":"由于 Typecho 相比 WordPress，所提供的接口较少，所以有些地方需要注意下。\n首页文章无限加载文章\n首先在 functions.php 中加入一段判断 ajax 请求的方法：\nfunction is_ajax()\n{\n    if (isset($_SERVER['HTTP_X_REQUESTED_WITH'])) {\n        if ('xmlhttprequest' == strtolower($_SERVER['HTTP_X_REQUESTED_WITH'])) {\n            return true;\n        }\n    }\n    return false;\n}\n\n然后在首页模板 index.php 中加入判断，if (is_ajax ()): 则不输出 header footer 等信息。\n最后一步，再模板公共 js 文件中加入以下代码：\n    var page = 1;\n    var $body = (window.opera) ? (document.compatMode == \"CSS1Compat\" ? $('html') : $('body')) : $('html,body');\n    $('#blog_load_more').click(function(event) {\n        $(this).hide();\n        $('#spinner').show();\n        $.ajax({\n            type: 'get',\n            url: SITE.default_url + '/page/' + parseInt(page + 1),\n            success: function(data, textStatus, XMLHttpRequest) {\n                page++;\n                $('.w-blog-list').append(data);\n                $('#spinner').hide();\n                $('#blog_load_more').show();\n            },\n            error: function(MLHttpRequest, textStatus, errorThrown) {\n                $('#spinner').hide();\n                $.jGrowl('Network Error');\n            }\n        });\n    });\n\n其中 #blog_load_more 为需要绑定的加载更多按钮，#spinner 为加载过程中的动画，.w-blog-list 为首页文章列表容器。\n由于 Typecho 并没有 Ajax 钩子函数，所以需要在 functions.php 中加入以下代码：\nfunction site_data()\n{\n    $array = array(\n        'site_url'         => Helper::options()->siteUrl,\n        'default_url'      => Helper::options()->siteUrl . 'index.php',\n        'theme_images_url' => Helper::options()->themeUrl . '/assets/images/',\n    );\n    echo json_encode($array);\n}\n\n之后在 footer.php 中引入该数据：\n&lt;script type=\"text/javascript\">\nvar SITE = &lt;?php site_data()?>;\n&lt;/script>\n\n此处的 SITE 就是一个 JSON 对象，可以直接用了。\nWordPress 的 add_filter 很好用，Typecho 也可以实现类似的功能：\n比如想把文章中的图片都加上 rel=&quot;fancybox&quot; 的属性，WordPress 可能使用的以下方法：\nadd_filter('the_content', 'fancybox_replace');\nfunction fancybox_replace($content)\n{\n    global $post;\n    $pattern     = \"/&lt;a(.*?)href=('|\\\")([^>]*).(bmp|gif|jpeg|jpg|png)('|\\\")(.*?)>(.*?)&lt;\\/a>/i\";\n    $replacement = '&lt;a$1href=$2$3.$4$5 target=\"_blank\" rel=\"fancybox\"$6>$7&lt;/a>';\n    $content     = preg_replace($pattern, $replacement, $content);\n    return $content;\n}\n\nTypecho 中可以这么写：\nfunction themeInit($archive)\n{\n    if ($archive->is('single')) {\n        $archive->content = fancybox_replace($archive->content);\n    }\n\n}\n\n获取文章第一张图片\n分为 markdown 和 html 两种方式\nfunction get_post_img($archive)\n{\n    $cid = $archive->cid;\n    $db = Typecho_Db::get();\n    $rs = $db->fetchRow($db->select('table.contents.text')\n                               ->from('table.contents')\n                               ->where('cid=?', $cid));\n    $text = $rs['text'];\n    if (0 === strpos($text, '')) {\n        preg_match('/!\\[[^\\]]*]\\([^\\)]*\\.(png|jpeg|jpg|gif|bmp)\\)/i', $text, $img);\n        if (empty($img)) {\n            return 'none';\n        } else {\n            preg_match(\"/(?:\\()(.*)(?:\\))/i\", $img[0], $result);\n            $img_url = $result[1];\n            return '&lt;img src=\"' . $img_url . '\"/>';\n        }\n    } else {\n        preg_match_all(\"/\\&lt;img.*?src\\=\\\"(.*?)\\\"[^>]*>/i\", $text, $img);\n        if (empty($img)) {\n            return 'none';\n        } else {\n            $img_url = $img[1][0];\n            return '&lt;img src=\"' . $img_url . '\"/>';\n        }\n    }\n}\n\n评论列表加 @\nfunction get_comment_at($coid)\n{\n    $db   = Typecho_Db::get();\n    $prow = $db->fetchRow($db->select('parent')->from('table.comments')\n                                 ->where('coid = ? AND status = ?', $coid, 'approved'));\n    $parent = $prow['parent'];\n    if ($parent != \"0\") {\n        $arow = $db->fetchRow($db->select('author')->from('table.comments')\n                                     ->where('coid = ? AND status = ?', $parent, 'approved'));\n        $author = $arow['author'];\n        $href   = '&lt;a href=\"#comment-' . $parent . '\">@' . $author . '&lt;/a>';\n        echo $href;\n    } else {\n        echo '';\n    }\n\n}\n\n非插件实现文章阅读次数统计\n在文章页面引入 get_post_view () 方法。\n//get_post_view($this)\nfunction get_post_view($archive)\n{\n    $cid    = $archive->cid;\n    $db     = Typecho_Db::get();\n    $prefix = $db->getPrefix();\n    if (!array_key_exists('views', $db->fetchRow($db->select()->from('table.contents')))) {\n        $db->query('ALTER TABLE `' . $prefix . 'contents` ADD `views` INT(10) DEFAULT 0;');\n        echo 0;\n        return;\n    }\n    $row = $db->fetchRow($db->select('views')->from('table.contents')->where('cid = ?', $cid));\n    if ($archive->is('single')) {\n       $db->query($db->update('table.contents')->rows(array('views' => (int) $row['views'] + 1))->where('cid = ?', $cid));\n    }\n    echo $row['views'];\n}\n\n判断移动端访问\nfunction is_mobile()\n{\n    $user_agent     = $_SERVER['HTTP_USER_AGENT'];\n    $mobile_browser = array(\n        \"mqqbrowser\", //手机QQ浏览器\n        \"opera mobi\", //手机opera\n        \"juc\", \"iuc\", //uc浏览器\n        \"fennec\", \"ios\", \"applewebKit/420\", \"applewebkit/525\", \"applewebkit/532\", \"ipad\", \"iphone\", \"ipaq\", \"ipod\",\n        \"iemobile\", \"windows ce\", //windows phone\n        \"240x320\", \"480x640\", \"acer\", \"android\", \"anywhereyougo.com\", \"asus\", \"audio\", \"blackberry\",\n        \"blazer\", \"coolpad\", \"dopod\", \"etouch\", \"hitachi\", \"htc\", \"huawei\", \"jbrowser\", \"lenovo\",\n        \"lg\", \"lg-\", \"lge-\", \"lge\", \"mobi\", \"moto\", \"nokia\", \"phone\", \"samsung\", \"sony\",\n        \"symbian\", \"tablet\", \"tianyu\", \"wap\", \"xda\", \"xde\", \"zte\",\n    );\n    $is_mobile = false;\n    foreach ($mobile_browser as $device) {\n        if (stristr($user_agent, $device)) {\n            $is_mobile = true;\n            break;\n        }\n    }\n    return $is_mobile;\n}\n\najax 评论\nAjaxComments 有小 bug，不太好用，直接食用以下的修改版代码，在公共 js 中调用 ajaxComments () 方法即可\nfunction ajaxComment() {\n    var selector = {\n        commentMainFrame: '#comment',\n        commentList: '#commentlist',\n        commentNumText: '#comment h3',\n        commentReplyButton: '#comment span.reply',\n        submitForm: '#commentform',\n        submitTextarea: '#textarea',\n        submitButton: '#submit',\n    };\n    var parentId = '';\n    bindCommentReplyButton();\n    $(selector.submitTextarea).after('&lt;div style=\"display:none;\" id=\"ajaxCommentMsg\">&lt;\\/div>');\n    $msg = $('#ajaxCommentMsg');\n    $(document).on('submit', selector.submitForm, function() {\n        $msg.empty();\n        $(selector.submitButton).val('发射中哦=A=');\n        $(selector.submitButton).attr('disabled', true).fadeTo('slow', 0.5);\n        if ($(selector.submitForm).find('#author')[0]) {\n            if ($(selector.submitForm).find('#author').val() == '') {\n                message('昵称没填呢QAQ');\n                enableCommentButton();\n                return false;\n            }\n            if ($(selector.submitForm).find('#mail').val() == '') {\n                message('邮箱没填呢QAQ');\n                enableCommentButton();\n                return false;\n            }\n            var filter = /^[^@\\s&lt;&amp;>]+@([a-z0-9]+\\.)+[a-z]{2,4}$/i;\n            if (!filter.test($(selector.submitForm).find('#mail').val())) {\n                message('邮箱地址不正确呢QAQ');\n                enableCommentButton();\n                return false;\n            }\n        }\n        if ($(selector.submitForm).find(selector.submitTextarea).val() == '') {\n            message('评论似乎什么也没写呢QAQ');\n            enableCommentButton();\n            return false;\n        }\n        $.ajax({\n            url: $(this).attr('action'),\n            type: $(this).attr('method'),\n            data: $(this).serializeArray(),\n            error: function() {\n                message('发射失败,请重试!');\n                setTimeout(NProgress.done, 500)\n                enableCommentButton();\n                return false;\n            },\n            success: function(data) {\n                if (!$(selector.commentList, data).length) {\n                    errorMsg = data.match(/.+/g).join().match(/\\&lt;div.+\\>.+\\&lt;\\/div\\>/g).join().match(/[^\\,]+/g);\n                    $msg.html(errorMsg[0] + errorMsg[1] + errorMsg[2]);\n                    enableCommentButton();\n                    return false;\n                } else {\n                    userCommentId = $(selector.commentList, data).html().match(/id=\\\"?comment-\\d+/g).join().match(/\\d+/g).sort(function(a, b) {\n                        return a - b;\n                    }).pop();\n                    commentLi = '&lt;li id=\"comment-' + userCommentId + '\" class=\"comment\">' + $('#comment-' + userCommentId, data).html(); + '&lt;\\/li>';\n                    if (parentId) {\n                        if ($('#' + parentId).find(\".comment-children\").length &lt;= 0) {\n                            $('#' + parentId).append(\"&lt;ul class='children'>&lt;/ul>\");\n                        }\n                        $('#' + parentId + \" .children:first\").append(commentLi);\n                        parentId = ''\n                        $body.animate({\n                            scrollTop: $('#comment-' + userCommentId).offset().top - 450\n                        }, 900);\n                    } else {\n                        $(selector.commentList).prepend(commentLi)\n                        $body.animate({\n                            scrollTop: $('#comment-' + userCommentId).offset().top - 200\n                        }, 900);\n                    }\n                    //$('#comment-' + userCommentId).slideDown('slow');\n\n                    //console.log(userCommentId);\n                    $(selector.commentNumText).length ? (n = parseInt($(selector.commentNumText).text().match(/\\d+/)), $(selector.commentNumText).html($(selector.commentNumText).html().replace(n, n + 1))) : 0;\n                    TypechoComment.cancelReply();\n                    $(selector.submitTextarea).val('');\n                    $(selector.commentReplyButton + ' b, #cancel-comment-reply-link').unbind('click');\n                    bindCommentReplyButton();\n                    enableCommentButton();\n\n                }\n            }\n        });\n        return false;\n    });\n\n    function bindCommentReplyButton() {\n        $(document).on('click', selector.commentReplyButton, function() {\n            parentId = $(this).parents('li.comment').attr(\"id\");\n            $(selector.submitTextarea).focus();\n        });\n        $(document).on('click', '#cancel-comment-reply-link', function() {\n            parentId = '';\n        });\n    }\n\n    function enableCommentButton() {\n        $(selector.submitButton).attr('disabled', false).fadeTo('', 1);\n        $(selector.submitButton).val('发射=A=');\n    }\n\n    function message(msg) {\n        $msg.hide();\n        $msg.html(msg).slideToggle('fast');\n    }\n}\n\n\n无限嵌套评论\nfunction themeInit($archive)\n{\n    Helper::options()->commentsMaxNestingLevels = 999;\n}\n\n非插件实现路由\nfunction themeInit($archive)\n{\n    if ($archive->is('archive', 404))\n    {\n        $path_info = trim($archive->request->getPathinfo(), '/');\n        if ($path_info == 'i/redirect')\n        {\n            $url = urldecode($archive->request->url);\n            $archive->response->redirect($url);\n            exit;\n        }\n    }\n}\n\n","url":"/archives/typecho-theme-tips.html","date":"Jul 05, 2015"},{"title":"将 VPS 备份到 Dropbox 的脚本","content":"首先，需要创建一个 Dropbox 应用，可以从该网址进行创建：https://www.dropbox.com/developers/apps/create。\n在这里，应用类型选择 Dropbox API App，数据存储类型选择 Files and datastores，权限选择 Yes（应用只需要访问它创建的文件）。然后命名创建。\n下载 dropbox 备份脚本：\n# wget https://raw.github.com/andreafabrizi/Dropbox-Uploader/master/dropbox_uploader.sh\n\n然后，为该脚本添加执行权限：\n# chmod +x dropbox_uploader.sh\n\n执行该脚本：\n# ./dropbox_uploader.sh\n\n根据提示输入 Dropbox 应用中的 App key 和 App secret，许可类型选择 a，确认 y，复制给出的权限验证链接到浏览器，确认后回到终端按任意键完成。\n编写定时备份脚本，取名为 backup.sh。其代码如下：\n#!/bin/bash\n#MYSQL数据库帐号密码\nMYSQL_USR=\"root\"  # 数据库帐号\nMYSQL_PWD=\"password\"  # 数据库密码\n\n#定义需要备份的目录\nNGINX_CONF_DIR=/usr/local/nginx/conf  # nginx配置目录\nWEB_DIR=/home/wwwroot  # 网站数据存放目录\n\n#定义备份存放目录\nDROPBOX_DIR=/$(date +%Y-%m-%d)  # Dropbox上的备份目录\nLOCAL_BAK_DIR=/home/backup  # 本地备份文件存放目录\n\n#定义备份文件名称\nDBBakName=DB_$(date +%Y%m%d).tar.gz\nNginxConfBakName=NginxConf_$(date +%Y%m%d).tar.gz\nWebBakName=Web_$(date +%Y%m%d).tar.gz\n\n#定义旧数据名称\nOld_DROPBOX_DIR=/$(date -d -7day +%Y-%m-%d)\nOldDBBakName=DB_$(date -d -10day +%Y%m%d).tar.gz\nOldNginxConfBakName=NginxConf_$(date -d -10day +%Y%m%d).tar.gz\nOldWebBakName=Web_$(date -d -10day +%Y%m%d).tar.gz\n\ncd $LOCAL_BAK_DIR\n\n#使用命令导出SQL数据库,并且按数据库分个压缩\nfor db in `mysql -u$MYSQL_USR -p$MYSQL_PWD -B -N -e 'SHOW DATABASES' | xargs`; do\n    (/usr/local/mysql/bin/mysqldump -u$MYSQL_USR -p$MYSQL_PWD ${db} | gzip -9 - >  ${db}.sql.gz)\ndone\n\n#压缩数据库文件合并为一个压缩文件\ntar zcf $LOCAL_BAK_DIR/$DBBakName $LOCAL_BAK_DIR/*.sql.gz\nrm -rf $LOCAL_BAK_DIR/*.sql.gz\n\n#压缩Nginx配置数据\ncd $NGINX_CONF_DIR\ntar zcf $LOCAL_BAK_DIR/$NginxConfBakName ./*\n\n#压缩网站数据\ncd $WEB_DIR\ntar zcf $LOCAL_BAK_DIR/$WebBakName ./*\n\ncd /root/bin\n#开始上传\n./dropbox_uploader.sh upload $LOCAL_BAK_DIR/$DBBakName $DROPBOX_DIR/$DBBakName\n./dropbox_uploader.sh upload $LOCAL_BAK_DIR/$NginxConfBakName $DROPBOX_DIR/$NginxConfBakName\n./dropbox_uploader.sh upload $LOCAL_BAK_DIR/$WebBakName $DROPBOX_DIR/$WebBakName\n\n#删除旧数据\nrm -rf $LOCAL_BAK_DIR/$OldDBBakName $LOCAL_BAK_DIR/$OldNginxConfBakName $LOCAL_BAK_DIR/$OldWebBakName\n./dropbox_uploader.sh delete $Old_DROPBOX_DIR/\n\necho -e \"Backup Done!\"\n\n其中，用户可以根据自己的需求改编需要备份的目录，以及保留旧数据的时长（比如我这里设置的是 Dropbox 保留 7 天，本地保留 10 天）。\n接下来，为这个备份脚本增加执行权限：\n# chmod +x backup.sh\n\n此处可以先测试一下能否备份成功：\n\n\ncrontab –e，添加：\n30 3 * * * /root/bin/backup.sh\n\n这样，就可以每天凌晨 3：30 自动备份到 Dropbox 了。\n\n本文参考自：http://www.pythoner.com/324.html\n\n","url":"/archives/backup-vps-to-dropbox.html","date":"Apr 04, 2015"},{"title":"成功安装黑苹果 发此文以纪念","content":"\n","url":"/archives/successfully-installed-black-apple.html","date":"Mar 23, 2015"},{"title":"使用 VirtualBOX 虚拟机安装 OS X 10.10 Yosemite","content":"原文在 Windows7 下安装，经本人测试在 ArchLinux 下安装成功。\n建议电脑要求\nCPU Intel Core i5 / i7\n内存 4GB 以上\n硬盘 500GB 以上，NTFS 格式\n由于虚拟机不支持 Apple Quartz Extreme/Core Image, 需要 Quartz Extreme 的应用软件例如 iBooks Author，Pixelmator，SketchBook 等不能在虚拟机下使用 。\n安装步骤\n1. 下载:  http://pan.baidu.com/s/1mg5PdGk\n只需下载两个压缩包，其他软件去 Vbox 官网即可。\nMac OSX Yosemite.vdi  (解压 Mac OSX Yosemite.vdi.part1.rar Mac OSX Yosemite.vdi.part2.rar)\n2. 安装 Virtualbox\n3.1 在 VirtualBOX 新建虚拟电脑\n名称        :  OSXYosemite\n类型        :  Mac OS X\n版本        :  Mac OS X (64 bit)\n\n3.2 内存分配最少 2048 MB 以上\n\n3.3 选择 使用已有的虚拟硬盘文件  及选择解压后的文件 Mac OSX Yosemite.vdi\n\n\n3.4 打开 VirtualBOX 虚拟机的 设置\n\n去掉 软驱，检查及修改 系统主板设置如下\n\n3.5 显示 -&gt; 显存大小设置到最大 128 MB\n\n4.1 关闭 VirtualBOX\n4.2 鼠标右键单击 并选择 以系统管理员身份执行 VirtualBOX\n\n4.3 在 Windows 搜索 cmd , 鼠标右键单击选择 以系统管理员身份执行 cmd\n\n4.4 请根据 3.1 虚拟电脑的名称 OSXYosemite ,  在  cmd  命令行依次输入命令如下：\n（linux 下直接终端输入以下命令）\n\n5.3  如需要更改 虚拟机分辨率 1440×900 输入命令如下：\n\n\nVBoxManage setextradata “OSXYosemite” “VBoxInternal2/EfiGopMode” 4\n其中数字表示如下，虚拟机默认分辨率值是 2 – 1024×768\n0 – 640×480\n1 – 800×600\n2 – 1024×768\n3 – 1280×1024\n4 – 1440×900\n\n\n5.1 关闭 VirtualBOX 及 关闭 cmd 命令行窗口\n5.2 重新正常启动 VirtualBOX, 及启动 OSXYosemite 虚拟机文件\n\n5.3 启动过程可能停在这里一分钟\n\n5.4 启动 OSXYosemite 虚拟机文件进入登录页面后，录入用户密码为 Ngay2011\n\n5.5 成功进入 Mac OS X 系统后，开始系统偏好设置\n\n如需要更改语言 (左上角的 苹果菜单 -&gt; 系统偏好设置 (System Preferences) -&gt; Language &amp; Text, 重新启动后才会更新\n\n如需要更改时区 (左上角的 苹果菜单 -&gt; 系统偏好设置 (System Preferences) -&gt; 日期与时间 (Date &amp; Time) -&gt; 时区 (Time Zone)\n\n如需要更改密码 (左上角的 苹果菜单 -&gt; 系统偏好设置 (System Preferences) -&gt; 用户与群组 (Users &amp; Group)\n\n如需要更改安全性和隐私 (左上角的 苹果菜单 -&gt; 系统偏好设置 (System Preferences) -&gt; 安全性与隐私 (Security &amp; Privacy)\n\n如需要更改帐户名称或个人目录名称 请参考 -&gt; http://support.apple.com/kb/HT1428?viewlocale=zh_CN\n5.6 开始使用 Mac OS X 10.10 Yosemite 优胜美地\n\n","url":"/archives/use-virtualbox-virtual-machine-to-install-os-x-10-10-yosemite.html","date":"Mar 20, 2015"},{"title":"自制 chrome LOVE LIVE! 主题","content":"点击安装\n\n","url":"/archives/homemade-chrome-theme-love-live.html","date":"Mar 11, 2015"},{"title":"如何黑掉彩笔的网站 (¬_¬)","content":"\n转自 java 吧\nhttp://tieba.baidu.com/p/3567794788\n刚才看到吧里有只大彩笔在秀自己的网站：\n原帖地址：http://tieba.baidu.com/p/3567694132\n对于这样热情高涨的新手，我们一定要予以关（nue）照（dai），于是心血来潮，\n科普一下 XSS（Cross Site Scripting）黑站。\n中文叫跨站脚本攻击。\n\n\n首先，打开彩笔的目标网站（废话），并注册用户\n\n寻找一个可以提交字符串到服务器的页面\n并且保证这个字符串会在前台页面显示，比如贴吧的发帖之类的功能\n \n\n找到 html 标签，我们看到有 maxlength 属性，这里先干掉再说，因为一会我们要提交 js 代码\n这里就可见，web 的前台验证什么的，都是假的，客户端提交的数据，必须要做后台验证。\n \n\n准备一段 js，代表，这里以简单为主，仅仅测试\n \n\n粘到文本框里去\n \n\n提交成功\n看到没？彩笔做的网站，前台框架用得爽，后台验证完全没有，顺利过了\n \n\n打开相应的显示画面，看到了我们的 js 已经成功被执行\n \n\n查看一下源代码，我们的 js 已经被嵌入了 html\n \n总结：\n真正的坏人，不会上传一段 alert 那么简单。\n正如名字一样，跨站的意思是，大的脚本不会直接上传，一定是再远程。\n如果，他上传的是如下的代码，你觉得后果会如何？\n\n防范 xss 的方法，前面已经提到了，用户提交数据的时候，做后台验证是其一。\n其二就是前台展示数据的时候，一定要做代码转义。\n这里隆重推荐，我大微软的 asp.net MVC + razor 真心很强大。\n前台后台验证一条龙，显示转意一句话。\n","url":"/archives/how-to-hack-the-crayon-website.html","date":"Feb 05, 2015"},{"title":"Posutoba（仿百度贴吧）项目大致完成","content":"放几张图\n\n\n\n\n\n具体见 GitHub\n","url":"/archives/posutoba-imitation-baidu-project-completed.html","date":"Jan 30, 2015"},{"title":"备份一下 KDE 配置","content":"由于该博主的站经常挂，所以备份一下。\n\nhttp://sforkw.jd-app.com/?p=114\n\nKDE4 的配置参考\n西北工大回来后，时间又充裕了，所以又开始了折腾 KDE。\n话说 KDE 的渲染阴影等效果非常接近 MacBook。先放几张图：\n\n\n\n下面说一下，我的配置过程：\n\n\n发行版：\n我的发行版是 Arch，没有 Arch 强大的 AUR，很多桌面的配件很难装上。\n\n\n主题：\n我的 plasma 主题是 Helium 与 dynamo 主题混合而成。标题栏主题是 Qtcurve，图标主题是 dynamo 与 flattr 混合而成，鼠标主题是 Breeze。应用程序主题是 Qtcurve，配色是 Breeze。这些都可以到这里下载。先安装 qtcurve 再将下载下来的文件解压并覆盖～/.kde4/share/ 即可。注意，Qtcurve 的配置方案是 Breeze，并且在窗口管理器中设置边框大小是无侧边框。\n\n\n全局菜单：\n全局菜单可以先加 archlinuxcn 源，然后依次用 yaourt 安装 appmenu-qt,appmenu-qt5,appmenu-gtk,kdeplasma-applets-menubar 。完成之后在面板上添加刚安装的部件再打开 “系统设置&gt; 应用程序外观 &gt; 风格” 然后选择微调标签，修改 “菜单栏风格” 为 “仅导出” 就能有全局菜单了。\n\n\n最大化隐藏菜单栏：\n最大化隐藏菜单栏可以直接在 qtCurve 中配置，依然在 “窗口管理器” 中，勾选 “最大化窗口无边框” 复选框即可。\n\n\n最大化上面板显示窗口控制按钮：（最后一张图鼠标所指的地方）\n在 AUR 中安装 kdeplasma-applets-kwin-button-improved，然后在面板上重复三次添加这个部件，分别设置为最小化（iconify），最大化 / 回复（maximize/restore）和关闭（close）就行了。\n\n\nKDE 的 Mac 向折腾指南\n惯例，先上图：\n\n\n\n\n\n首先，KDE 的全局菜单可以参考我以前的文章 http://sforkw.jd-app.com/?p=114。\n然后，Plasma 的主题是 AG-plasma，aurorae 主题是 Yoxydaze-light。这些可以去 kde-look 里找。\n底部的 dock 是 plank，主题是 ArHU，在 deviantART 中找到的。另外，plank 上的图标是受 gtk 主题控制的，所以装 numix-circle 是最好不过的。\n我的 apps 文件可以在这里下载：http://pan.baidu.com/s/1hqGJDmk\n~/.config/plank/dock1/settings 文件：\n#This file auto-generated by Plank.\n#2014-12-06T09:47:52+0000\n\n[PlankDockPreferences]\n#Whether to show only windows of the current workspace.\nCurrentWorkspaceOnly=false\n#The size of dock icons (in pixels).\nIconSize=42\n#If 0, the dock won’t hide. If 1, the dock intelligently hides. If 2, the dock auto-hides. If 3, the dock dodges active maximized windows.\nHideMode=0\n#Time (in ms) to wait before unhiding the dock.\nUnhideDelay=0\n#The monitor number for the dock. Use -1 to keep on the primary monitor.\nMonitor=-1\n#List of *.dockitem files on this dock. DO NOT MODIFY\nDockItems=plank.dockitem;;google-chrome.dockitem;;dolphin.dockitem;;juk.dockitem;;eclipse.dockitem;;chrome-pjkebmlmkppdjcdcilfcjdkifljollfd-Default.dockitem;;kate.dockitem;;gwenview.dockitem;;wps-office-wps.dockitem;;konsole.dockitem;;sublime_text_3.dockitem;;love-wallpaper.dockitem;;ksysguard.dockitem;;virtualbox.dockitem\n#The position for the dock on the monitor. If 0, left. If 1, right. If 2, top. If 3, bottom.\nPosition=3\n#The dock’s position offset from center (in percent).\nOffset=0\n#The name of the dock’s theme to use.\nTheme=ArHU\n#The alignment for the dock on the monitor’s edge. If 0, panel-mode. If 1, left-aligned. If 2, right-aligned. If 3, centered.\nAlignment=3\n#The alignment of the items in this dock if panel-mode is used. If 1, left-aligned. If 2, right-aligned. If 3, centered.\nItemsAlignment=3\n#Whether to prevent drag’n’drop actions and lock items on the dock.\nLockItems=false\n#Whether to use pressure-based revealing of the dock if the support is available.\nPressureReveal=false\n#Whether to show only pinned applications. Useful for running more then one dock.\nPinnedOnly=true\n#Whether to automatically pin an application if it seems useful to do.\nAutoPinning=true\n\n~/.local/share/plank/themes/ArHU/ 中的 dock.theme 和 hover.theme 文件分别是：\n#This file auto-generated by Plank.\n#2014-12-06T06:22:37+0000\n\n[PlankDrawingTheme]\n#The roundness of the top corners.\nTopRoundness=6\n#The roundness of the bottom corners.\nBottomRoundness=0\n#The thickness (in pixels) of lines drawn.\nLineWidth=0\n#The color (RGBA) of the outer stroke.\nOuterStrokeColor=0;;0;;0;;0\n#The starting color (RGBA) of the fill gradient.\nFillStartColor=255;;255;;255;;150\n#The ending color (RGBA) of the fill gradient.\nFillEndColor=255;;255;;255;;150\n#The color (RGBA) of the inner stroke.\nInnerStrokeColor=255;;255;;255;;255\n\n[PlankDrawingDockTheme]\n#The padding on the left/right dock edges, in tenths of a percent of IconSize.\nHorizPadding=0\n#The padding on the top dock edge, in tenths of a percent of IconSize.\nTopPadding=1\n#The padding on the bottom dock edge, in tenths of a percent of IconSize.\nBottomPadding=1\n#The padding between items on the dock, in tenths of a percent of IconSize.\nItemPadding=4\n#The size of item indicators, in tenths of a percent of IconSize.\nIndicatorSize=0\n#The size of the icon-shadow behind every item, in tenths of a percent of IconSize.\nIconShadowSize=0\n#The height (in percent of IconSize) to bounce an icon when the application sets urgent.\nUrgentBounceHeight=0.10000000000000001\n#The height (in percent of IconSize) to bounce an icon when launching an application.\nLaunchBounceHeight=0.10000000000000001\n#The opacity value (0 to 1) to fade the dock to when hiding it.\nFadeOpacity=0\n#The amount of time (in ms) for click animations.\nClickTime=150\n#The amount of time (in ms) to bounce an urgent icon.\nUrgentBounceTime=300\n#The amount of time (in ms) to bounce an icon when launching an application.\nLaunchBounceTime=300\n#The amount of time (in ms) for active window indicator animations.\nActiveTime=150\n#The amount of time (in ms) to slide icons into/out of the dock.\nSlideTime=150\n#The time (in ms) to fade the dock in/out on a hide (if FadeOpacity is &amp;amp;lt; 1).\nFadeTime=100\n#The time (in ms) to slide the dock in/out on a hide (if FadeOpacity is 1).\nHideTime=100\n#The size of the urgent glow (shown when dock is hidden), in tenths of a percent of IconSize.\nGlowSize=30\n#The total time (in ms) to show the hidden-dock urgent glow.\nGlowTime=10000\n#The time (in ms) of each pulse of the hidden-dock urgent glow.\nGlowPulseTime=2000\n#The hue-shift (-180 to 180) of the urgent indicator color.\nUrgentHueShift=150\n#The time (in ms) to move an item to its new position.\nItemMoveTime=150\n\n#This theme written by Perian. thexperian.deviantart.com\n\n[PlankDrawingTheme]\nTopRoundness=3\nLineWidth=0\nOuterStrokeColor=0;;0;;0;;0\nFillStartColor=0;;0;;0;;150\nFillEndColor=0;;0;;0;;150\nInnerStrokeColor=0;;0;;0;;0\n\n以上是我折腾的结果，找主题也找了半天。大家如果有更好的主题与壁纸也拿来分享一下吧。\n","url":"/archives/backup-kde-configuration.html","date":"Jan 25, 2015"},{"title":"nginx 反向代理 Google 的参数配置","content":"{\nlisten 443;\nserver_name xxx.xxx;\nssl on;\nssl_certificate /usr/local/nginx/xxx.crt;#这里改为你自己的证书路径\nssl_certificate_key /usr/local/xxx.key;#这里改为你自己的密钥路径\n\nlocation / {\nproxy_redirect http://www.google.com/ /;\nproxy_cookie_domain google.com xxx.xxx;\nproxy_pass http://173.194.127.48;\nproxy_set_header Accept-Encoding &amp;quot;&amp;quot;;\nproxy_set_header User-Agent $http_user_agent;\nproxy_set_header Accept-Language &amp;quot;zh-CN&amp;quot;;\nproxy_set_header Cookie &amp;quot;PREF=ID=047808f19f6de346:U=0f62f33dd8549d11:FF=2:LD=zh-CN:NW=1:TM=1325338577:LM=1332142444:GM=1:SG=2:S=rE0SyJh2W1IQ-Maw&amp;quot;;\nsub_filter www.google.com xxx.xxx;\nsub_filter_once off;\n}\n}\n\nserver {\nlisten 80;\nserver_name xxx.xxx;\nrewrite ^(.*) https://xxx.xxx$1 permanent;\n}\n\n#把所有的xxx.xxx改为你自己的域名\n#不使用 SSL 证书进行反代 Google 的代码如下：\n\nserver {\nlisten 80;\nserver_name xxx.xxx;\n\nlocation / {\nproxy_redirect http://www.google.com/ /;\nproxy_cookie_domain google.com xxx.xxx;\nproxy_pass http://173.194.127.48;\nproxy_set_header Accept-Encoding &amp;quot;&amp;quot;;\nproxy_set_header User-Agent $http_user_agent;\nproxy_set_header Accept-Language &amp;quot;zh-CN&amp;quot;;\nproxy_set_header Cookie &amp;quot;PREF=ID=047808f19f6de346:U=0f62f33dd8549d11:FF=2:LD=zh-CN:NW=1:TM=1325338577:LM=1332142444:GM=1:SG=2:S=rE0SyJh2W1IQ-Maw&amp;quot;;\nsub_filter www.google.com xxx.xxx;\nsub_filter_once off;\n}\n}\n\n","url":"/archives/nginx-reverse-proxy-google-parameter-configuration.html","date":"Jan 14, 2015"},{"title":"诺艾尔……","content":"\nHp：0/100\n\nHp：-2158/100\n\nHp：-18956/100\n\n怪兽先生生病？\n【怪兽先生】受到诺艾尔的萌系光芒，失去了一只手臂。\n\n\n然后又变成 [怪兽][先生] 了\n\n这时候，哥哥的开始发挥作用了\n\n\n然后就玩脱了\n\n怪兽先生：我被你们两个调戏调戏戏……\n\n\n\n\n\n\n\n","url":"/archives/noel.html","date":"Nov 18, 2014"},{"title":"说好的教程 —— 贴吧助手搭建教程","content":"进入 SAE（http://sae.sina.com.cn）\n右上角登录 使用新浪 weibo 帐号登录。\n\n\n\n点击创建新应用\n\n名字随便写个，这里的二级域名一会会用到。开发语言选择 PHP，默认模板不用管。\n\n点击刚刚创建的应用\n\n\n点击左侧的服务管理中的 KVDB。\n\n\n点击启用 KVDB 服务（可能需要输入登录密码）\n\n\n同样，在左侧服务管理中点击 TaskQueue，选择创建队列\n\n\n填写内容如图\n\n\n下载代码包（http://git.oschina.net/sy/tbhelper）\n点击页面上的下载 zip，下载下来。\n\n\n将下载的 zip 解压缩，打开解压后文件中的 sae 文件夹\n修改 config.php\n第三行的 sytbhelper  修改为你的密码（这是管理密码，不用和你的百度密码一样）\n第五行的 test  修改为在上面新建的 TaskQueue 的名称\n\n\n然后修改 install.php 第 20 行，写上你的 BDUSS\nBUDSS 的获取方法（http://googlo.me/1618.html）如果会获取的话就不用看了\n\n使用 Cron 生成器，生成 config.yaml 信息，粘贴到 config.yaml 中，替换原有内容。\n\n效果如下图：\n\n\n全部修改完成后，选中所有文件，右键使用你的压缩软件压缩。（PS：一定要压缩成 zip 格式）\n\n\n然后点击 SAE 左侧应用管理中的代码管理 点击创建一个版本 版本号选择 1\n\n\n创建完成后，点击操作 - 上传代码包\n\n\n选择刚刚压缩的 sae.zip\n\n\n上传完成后，进入 http:// 你创建的应用名.sinaapp.com/install.php 安装\n结束。\n","url":"/archives/tutorial-to-build-tieba-assistant.html","date":"Nov 04, 2014"},{"title":"Archlinux 安装 gnome 图形界面的方法","content":"基本系统的安装方法就不说了，参照 wiki（https://wiki.archlinux.org/index.php/Beginners'_guide）即可。\n下面说说如何安装 gnome。\n1、装 X\npacman -S xorg-server xorg-server-utils xorg-xinit xorg-utils\n\n2、安装显卡驱动（intel）\npacman -S xf86-video-intel\n\n3、安装触摸板和声卡\npacman -S xf86-input-synaptics alsa-utils\n\n4、安装 gnome\npacman -S gnome gdm\n\n5、安装 gnome-extra（可选）\npacman -S gnome-extra\n\n6、设置服务\nsystemctl enable gdm\nsystemctl start gdm.service\n\n","url":"/archives/how-to-install-archlinux-gnome-graphical-user-interface.html","date":"Oct 21, 2014"},{"title":"Archlinux 字体配置","content":"转载自：http://www.kankanews.com/ICkengine/archives/87503.shtml\n安装用 infinality 打包过的 freetype2 和 fontconfig。freetype 是字体渲染程序，fontconfig 是对字体的配置规则。\n默认情况下的绘字库的显示效果不是很好，所以我们要安装打过补丁的版本。\n两个打过补丁的包名字叫做 freetype2-infinality 和 fontconfig-infinality。不过只能用 yaourt 安装。安装 yaourt：\npacman -S yaourt\n\n然后运行：\nyaourt freetype2-infinality\n\n之后可能会出现这样的一个列表：\n    2 aur/fontconfig-infinality-git 101.91eb8e6-1 (57) Fontconfig files for use with freetype2-infinality. GIT version.\n    3 aur/freetype2-infinality 2.4.12-2 (551) TrueType font rendering library with infinality patch\n    4 aur/freetype2-infinality-git 2.4.99.git20130513-1 (85) TrueType font rendering library with Infinality patch\n    5 aur/lib32-freetype2-infinality 2.4.12-2 (166) TrueType font rendering library (32-bit) with infinality patch\n    6 aur/lib32-freetype2-infinality-git 2.4.99.git20130513-1 (28) TrueType font rendering library (32-bit) with Infinality patch\n    7 aur/libreoffice-uglyfix-freetype2-infinality 2.4.6-1 (43) Compiles freetype2 .so files and puts them in the libreoffice directory to fix font ugliness\n    8 aur/openoffice-uglyfix-freetype2-infinality 2.4.6-1 (10) Compiles freetype2 .so files and puts them in the openoffice directory to fix font ugliness==&amp;amp;gt;\n     Enter n° of packages to be installed (ex: 1 2 3 or 1-3)==\n\n这时输入 “1 3”（1 空格 3）就可以安装这两个包了。如果你不是 root 用户，可能会要你输入密码。 当出现 &quot;Edit PKGBUILD ?[Y/n]&quot; 或者 &quot;Edit install.sh ?[Y/n]&quot;字样的时候，输入&quot;n&quot;表示不编辑。 在&quot;Continue building xxxx ?[Y/n]&quot;出现之后输入&quot;y&quot; 表示继续安装。\n由于 SourceForge 被墙，yaourt 无法下载 freetype 的源码包。这时候可以用代理手动安装。\nsource=(&quot;freetype/freetype-${pkgver}.tar.bz2&quot; &quot;http://www.infinality.net/fedora/linux/zips/freetype-infinality-${pkgver}-${_pkgdate}_${_pkgrel}-x86_64.tar.bz2&quot; &quot;freetype-2.2.1-enable-valid.patch::https://projects.archlinux.org/svntogit/packages.git/plain/trunk/freetype-2.2.1-enable-valid.patch?h=packages/freetype2&quot;)\n\n然后执行 makepkg -si 以安装，中间如果出现提示一直选择是。\n安装 fontconfig-infinality：\nyaourt fontconfig-infinality\n\n完毕之后，执行 /etc/fonts/infinality/infctl.sh setstyle，然后选择一个渲染风格（我设置了 5）。\n","url":"/archives/archlinux-font-config.html","date":"Oct 20, 2014"},{"title":"gnome-shell 透明的方法","content":"\n打开 /usr/share/gnome-shell/theme/gnome-shell.css\n把第一个 black 修改为 transparent 或者 rgba (0,0,0,0.3) 即可。\n\n","url":"/archives/gnome-shell-transparent-method.html","date":"Oct 20, 2014"},{"title":"Gnome 3.12 Applications Menu 添加 Logo","content":"效果图：\n\n扩展地址：apps-menu@gnome-shell-extensions.gcampax.github.com\n步骤：\n一、\n先找一张 png 格式的 logo: http://download.easyicon.net/png/1068656/256/ 转换为 svg 格式（注意路径）：\nmogrify -format svg -resize 48x48 '/usr/share/icons/Numix-Circle/scalable/apps/archlogo.png'\n没有 mogrify 命令的话先安装： pacman -S imagemagick\n二、\n参照以下代码修改 /usr/share/gnome-shell/extensions/apps-menu@gnome-shell-extensions.gcampax.github.com/extension.js:\n    this.actor.accessible_role = Atk.Role.LABEL;\n    let hbox = new St.BoxLayout({ style_class: 'panel-status-menu-box' });\n    // this._label = new St.Label({ text: _(&amp;quot;Applications&amp;quot;),\n    //                             y_expand: true,\n    //                             y_align: Clutter.ActorAlign.CENTER });\n\n    this._box = new St.BoxLayout();\n    this._iconBox = new St.Bin();\n    this._box.add(this._iconBox, { y_align: St.Align.MIDDLE, y_fill: false });\n    let logo = new St.Icon({ icon_name: 'archlogo', style_class: 'applications-menu-button-icon', icon_size: 22 });\n    this._iconBox.child = logo;\n    let label = new St.Label({ text: &amp;quot; &amp;quot; });\n    this._box.add(label, { y_align: St.Align.MIDDLE, y_fill: false });\n    this._label = new St.Label({ text: _(&amp;quot;Applications&amp;quot;) });\n    this._box.add(this._label, { y_align: St.Align.MIDDLE, y_fill: false });\n    this.actor.add_actor(this._box);\n\n    hbox.add_child(this._label);\n    hbox.add_child(new St.Label({ text: 'u25BE',\n    y_expand: true,\n    y_align: Clutter.ActorAlign.CENTER }));\n\n    this.actor.add_actor(hbox);\n    this.actor.name = 'panelApplications';\n    ....\n\n三、\n重启 gnome-shell。\n","url":"/archives/add-gnome-3-12-applications-menu-logo.html","date":"Oct 17, 2014"}]</script></div><footer id="footer" class="container" style="background:rgba(255,255,255,0)"><hr><div style="text-align:center;padding-bottom:9px"><p>© 2014 - 2020 <a href="/">あかねぞら</a>. Using <a target="_blank" href="https://hexo.io/">Hexo</a>  &amp; <a target="_blank" href="https://yumoe.com">Moricolor</a> / <a href="/atom.xml" data-nopjax="true">RSS</a></p></div></footer><script id="mori-json" type="text/json">{"bottomTools":{"hitokoto":true,"category":true,"tag":false,"page":true,"search":true},"comment":{"use":"disqus","shortname":"sora-diary"},"analytics":{"use":"google","id":"UA-70944432-1"},"sentry":{"dsn":"https://7bdda1be9b094ef0b6ff3c364024537c@sentry.io/2406563"},"url":"https://kotori.love"}</script><script src="/assets/app.js?v=c37fee7c7025be8c"></script></div></body></html>