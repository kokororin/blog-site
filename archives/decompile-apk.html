<!doctype html><html class="han-la"><head><link rel="manifest" href="/manifest.json"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="renderer" content="webkit"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#16a085"><meta name="description" content="Android 反编译"><meta name="keywords" content="Android,java,apk"><title>Android 反编译 | あかね空</title><link rel="icon shortcut" type="image/ico" href="/favicon.ico"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/assets/app.css?v=775bb307e8087fad"><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="あかね空" type="application/atom+xml"></head><body><div id="pjax-container"><div id="main" class="container"><div id="main-post" role="main" itemscope="" itemtype="http://schema.org/BlogPosting"><article class="post" style="padding-top:20px"><h2 itemprop="name headline" style="font-weight:400">Android 反编译</h2><div class="text-right"><div class="text-bar"><a href="/" class="fui-home"></a><a href="#disqus_thread" class="fui-bubble" data-action="comment-go"></a><a style="font-size:30px;margin-left:1px">·</a><a href="https://twitter.com/intent/tweet?url=https://kotori.love/archives/decompile-apk.html" target="_blank" rel="nofollow" data-placement="bottom" data-toggle="tooltip" title="Twitter" class="fui-twitter"></a><a href="https://www.facebook.com/sharer/sharer.php?u=https://kotori.love/archives/decompile-apk.html" target="_blank" rel="nofollow" data-placement="bottom" data-toggle="tooltip" title="Facebook" class="fui-facebook"></a></div><div class="post-info"><span class="post-info-n"><a href="/categories/%E7%A7%91%E6%8A%80/">科技</a></span><a href="/tags/Android/">Android</a><a href="/tags/java/">java</a><a href="/tags/apk/">apk</a><a><time datetime="2015-08-01T04:55:00.000Z">2015-08-01</time></a></div></div><div class="post-content" itemprop="articleBody"><blockquote><p>这篇草稿存了好久了，还是发出来吧。</p></blockquote><h3 id="首先介绍下要用到的工具：">首先介绍下要用到的工具：</h3><ul><li>jdk: Java Development Kit</li><li>baksmali：把 classes.dex 转为为 smali 文件的工具</li><li>dex2jar：classes.dex 转为 jar 包的工具</li><li>jdgui：阅读 jar 文件的工具</li><li>smali：把 smali 文件编译打包为 classes.dex 的工具</li></ul><p>其中关于 baksmali 和 smali 可以看下<a href="http://code.google.com/p/smali/" target="_blank" rel="noopener">谷歌</a>的介绍</p><p>反编译后得到的 dex 文件以及转为 jar 包后都无法进行修改，只能把 dex 文件转化为 smali 文件进行修改，然后再编译打包为 dex 文件，替换掉原有 apk 中的 dex 文件，然后对 apk 进行签名，这样就完成了对 apk 源码的修改，具体步骤如下：（以下操作是在 linux 下进行，windows 可能会略有差异）</p><p>1. 解压 apk 文件，获取 classes.dex 并拷贝到资源根目录（使用 zip 或其他解压工具即可）</p><p>2. 使用 baksmali 工具将 classes.dex 转为 smali 文件，在命令行定位到资源根目录并执行：</p><pre class="language-bash"><code class="language-bash">java -jar baksmali-2.0.3.jar -x classes.dex 
</code></pre><p>执行完后会在当前目录下生成 out 目录，目录结构跟源码相同，在对应目录下查找对应的 smali 文件</p><p>3. 使用 dex2jar 工具把 dex 转为 jar 文件，拷贝 classes.dex 到资源目录下的 dex2jar-0.0.9.15 目录下，把命令行定位到该目录并执行：</p><pre class="language-bash"><code class="language-bash">   ./dex2jar.sh classes.dex  <span class="token punctuation">(</span>windows:dex2jar.bat classes.dex<span class="token punctuation">)</span>
</code></pre><p>执行完后会在当前目录下生成 classes_dex2jar.jar 文件，然后可以通过 jdgui 进行查看</p><p>4. 使用 jdgui 工具查看 HelloWorld 的源码，根据不同的系统打开资源目录下对应的 jdgui 工具，然后把第 3 步生成的 classes_dex2jar.jar 文件拖到工具中</p><p>5. 修改对应的 smali 文件</p><p>6. 使用 smali-2.0.3.jar 工具把 smali 文件转为 dex 文件，把命令行定位到资源根目录并执行：</p><pre class="language-bash"><code class="language-bash">  java -jar smali-2.0.3.jar -o classes.dex out 
</code></pre><p>执行完后会生成并替换掉根目录下的 classes.dex 文件，这样就修改成功了</p><p>7. 把新生成的 classes.dex 文件替换到原来的 apk 文件里（使用压缩工具）</p><p>8. 使用签名工具对 apk 进行签名，把 apk 拷贝到资源根目录下的 sign_tool 目录，把命令行定位到该目录并执行：</p><pre class="language-bash"><code class="language-bash">   java -jar signapk.jar platform.x509.pem platform.pk8 HelloWorld.apk Signed.apk
</code></pre><p>执行完后会在该目录下生成 Signed.apk 文件，这个文件就是最终的文件了。</p></div></article></div><center><div id="postnav"><ul class="pager"><li class="previous"><a href="/"><span class="fui-home"></span></a></li><li class="next" data-action="comment-show"><a href="#"><span class="fui-chat"></span></a></li><li class="previous"><a href="/archives/kotori-php-framework.html" title="写了个 php 框架 (?)">写了个 php 框架 (?)</a></li><li class="next"><a href="/archives/hitokoto-data.html" title="一言同步数据">一言同步数据</a></li></ul></div></center><div id="disqus_thread" data-title="Android 反编译" data-permalink="https://kotori.love/archives/decompile-apk.html"></div><div class="post-tor-content"><div class="post-tor" id="postTor"><div class="torarc-t"><div class="torarc-tile"><a href="#main-post"><span class="tori">- TOC -</span></a><br><a href="#首先介绍下要用到的工具："><span class="tori">首先介绍下要用到的工具：</span><br></a></div></div></div></div></div><footer id="footer" class="container" style="background:rgba(255,255,255,0)"><hr><div style="text-align:center;padding-bottom:9px"><p>© 2014 - 2020 <a href="/">あかね空</a>. Using <a target="_blank" href="https://hexo.io/">Hexo</a>  &amp; <a target="_blank" href="https://yumoe.com">Moricolor</a> / <a href="/atom.xml" data-nopjax="true">RSS</a></p></div></footer><script id="mori-json" type="text/json">{"bottomTools":{"hitokoto":true,"category":true,"tag":false,"search":true},"comment":{"use":"disqus","shortname":"sora-diary"},"analytics":{"use":"google","id":"UA-70944432-1"},"sentry":{"dsn":"https://7bdda1be9b094ef0b6ff3c364024537c@sentry.io/2406563"},"url":"https://kotori.love"}</script><script src="/assets/app.js?v=c37fee7c7025be8c"></script></div></body></html>