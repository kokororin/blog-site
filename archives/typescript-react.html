<!doctype html>
<html class="han-la"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/><meta name="renderer" content="webkit"/><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/><meta name="theme-color" content="#16a085"/><title>TypeScript+React 中的一些坑 | ことりのおやつにしてやるぞー！</title><link rel="icon shortcut" type="image/ico" href="/favicon.ico"/><link rel="icon" href="/favicon.ico"/><link rel="stylesheet" href="/assets/app.css?v=8f16cadb70231219"/><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="ことりのおやつにしてやるぞー！" type="application/atom+xml">
</head><body><div id="pjax-container"><div id="main" class="container"><div id="main-post" role="main" itemscope="" itemType="http://schema.org/BlogPosting"><article class="post" style="padding-top:20px"><h2 itemProp="name headline" style="font-weight:normal">TypeScript+React 中的一些坑</h2><div class="text-right"><div class="text-bar"><a href="https://kotori.love" class="fui-home"></a><a href="#disqus_thread" class="fui-bubble" data-action="comment-go"></a><a style="font-size:30px;margin-left:1px">·</a><a href="https://twitter.com/intent/tweet?url=https://kotori.love/archives/typescript-react.html" target="_blank" rel="nofollow" data-placement="bottom" data-toggle="tooltip" title="Twitter" class="fui-twitter"></a><a href="https://www.facebook.com/sharer/sharer.php?u=https://kotori.love/archives/typescript-react.html" target="_blank" rel="nofollow" data-placement="bottom" data-toggle="tooltip" title="Facebook" class="fui-facebook"></a></div><div class="post-info"><span class="post-info-n"><a href="/categories/%E7%A7%91%E6%8A%80/">科技</a></span><a href="/tags/react/">react</a><a href="/tags/typescript/">typescript</a><a><time dateTime="2020-02-06T11:00:00.000Z">2020-02-06</time></a></div></div><div class="post-content" itemProp="articleBody"><h4 id="使用-ts-ignore忽略某一个props">使用 <code>@ts-ignore</code>  忽略某一个 props</h4>
<pre><code class="language-tsx">&lt;NavItem 
  to=&quot;/test&quot;
  componentClass={Link}&gt;
  Test
&lt;/NavItem&gt;
</code></pre>
<p>如果像这样， <code>NavItem</code>  组件上没有 <code>to</code>  这个属性，很自然的会报错。</p>
<pre><code>Property &#x27;to&#x27; does not exist on type &#x27;IntrinsicAttributes &amp; IntrinsicClassAttributes&lt;NavItem&gt; &amp; Readonly&lt;NavItemProps&gt; &amp; Readonly&lt;...&gt;&#x27;.ts(2769)
</code></pre>
<p>然而 TypeScript 只认带双斜杠的 <code>// @ts-ignore</code> ，JSX 代码中写注释的只能通过 <code>{/* */}</code> , 类似这样的代码是不行的呢</p>
<pre><code class="language-tsx">&lt;NavItem 
  // @ts-ignore
  to=&quot;/test&quot;
  componentClass={Link}&gt;
  Test
&lt;/NavItem&gt;
</code></pre>
<p>正确答案是这样的↓↓↓ ，加 <code>/* prettier-ignore */</code>  的原因是可能格式化后会破坏这种微妙的结构 hhh</p>
<pre><code class="language-tsx">{/*
  // @ts-ignore */ /* prettier-ignore */}
&lt;NavItem to=&quot;/test&quot;
  componentClass={Link}&gt;
  Test
&lt;/NavItem&gt;
</code></pre>
<h4 id="React-Router-相关">React Router 相关</h4>
<p>路由中参数的声明：</p>
<pre><code class="language-tsx">import { RouteComponentProps } from &#x27;react-router&#x27;;

interface IPageRouteInfo {
  id: string;
}

interface IPageProps extends RouteComponentProps&lt;IPageRouteInfo&gt; {}

class Page extends React.Component&lt;IPageProps&gt; {}
</code></pre>
<p><code>withRouter</code>  装饰器的用法，没找到什么好的方式，我一般这么写（（（</p>
<pre><code class="language-tsx">import { withRouter, RouteComponentProps } from &#x27;react-router&#x27;;

interface ISearchProps extends Partial&lt;RouteComponentProps&gt; {}

@(withRouter as any)
class Search extends React.Component&lt;ISearchProps&gt; {}
</code></pre>
<h4 id="为第三方库添加声明文件-d-ts">为第三方库添加声明文件 .d.ts</h4>
<p>有些库时没有声明文件的，需要自己添加添加声明文件。一般在 <code>src/types</code>  中新建一个 <code>模块名.d.ts</code> ，内容如下：</p>
<pre><code class="language-ts">declare module &#x27;scroll-to&#x27; {
  const scrollTo: (x: number, y: number, options: any) =&gt; void;
  export = scrollTo;
}
</code></pre>
<h4 id="使用ESLint取代TSLint">使用 ESLint 取代 TSLint</h4>
<p>由于 <code>TSLint</code>  已停止维护，推荐使用 <code>ESLint</code>  进行检查。</p>
<p>需要安装的包：</p>
<pre><code class="language-bash">yarn add @typescript-eslint/eslint-plugin @typescript-eslint/parser eslint eslint-plugin-react -D
</code></pre>
<p><code>.eslintrc.js</code>  配置：</p>
<pre><code class="language-js">module.exports = {
  parser: &#x27;@typescript-eslint/parser&#x27;,
  parserOptions: {
    ecmaFeatures: { jsx: true },
    ecmaVersion: 2019,
    sourceType: &#x27;module&#x27;,
    project: [&#x27;./tsconfig.json&#x27;],
    tsconfigRootDir: __dirname
  },
  env: {
    browser: true,
    es6: true,
    node: true
  },
  extends: [
    // ...
    &#x27;plugin:@typescript-eslint/eslint-recommended&#x27;,
    &#x27;plugin:@typescript-eslint/recommended&#x27;
  ],
  plugins: [
    &#x27;@typescript-eslint&#x27;,
    &#x27;react&#x27;
  ],
  settings: {
    react: {
      version: require(&#x27;react&#x27;).version
    }
  }
};
</code></pre>
<p>更多的规则可以查看<a href="https://github.com/typescript-eslint/typescript-eslint/tree/master/packages/eslint-plugin" target="_blank" rel="noopener"> typescript-eslint/typescript-eslint</a>。</p>
<h4 id="用TypeScript来写webpack配置">用 TypeScript 来写 webpack 配置</h4>
<p>有<s>强迫症患者</s>的同学可以用 TypeScript 的语法来写 webpack 的配置文件。</p>
<p>首先是需要安装的包：</p>
<pre><code class="language-bash">yarn add ts-node webpack webpack-cli webpack-dev-server @types/webpack @types/webpack-dev-server tsconfig-paths -D
</code></pre>
<p>在项目根目录下创建 <code>tsconfig-node.json</code> ：</p>
<pre><code class="language-json">{
  &quot;compilerOptions&quot;: {
    &quot;module&quot;: &quot;commonjs&quot;,
    &quot;target&quot;: &quot;es5&quot;,
    &quot;esModuleInterop&quot;: true
  }
}
</code></pre>
<p>创建 <code>webpack.config.ts</code> ：</p>
<pre><code class="language-ts">import webpack from &#x27;webpack&#x27;;

const config: webpack.Configuration = {
  // ...
};

export default config;
</code></pre>
<p>冲鸭！！</p>
<pre><code class="language-bash">cross-env TS_NODE_PROJECT=\&quot;tsconfig-node.json\&quot; NODE_ENV=development webpack-dev-server --config ./webpack.config.ts
</code></pre>
</div></article></div><center><div id="postnav"><ul class="pager"><li class="previous"><a href="https://kotori.love"><span class="fui-home"></span></a></li><li class="next" data-action="comment-show"><a href="#"><span class="fui-chat"></span></a></li><li class="previous"><a>Not left !!</a></li><li class="next"><a href="https://kotori.love/archives/first-post-2020.html" title="「2020」 除草 (★^O^★)">「2020」 除草 (★^O^★)</a></li></ul></div></center><div id="disqus_thread" style="display:none" data-title="TypeScript+React 中的一些坑" data-permalink="https://kotori.love/archives/typescript-react.html"></div></div><footer id="footer" class="container" style="background:rgba(255, 255, 255, 0)"><hr/><div style="text-align:center;padding-bottom:9px"><p>© 2015 - 2020 <a href="https://kotori.love">ことりのおやつにしてやるぞー！</a>. Using <a target="_blank" href="https://hexo.io/">Hexo</a>  &amp; <a target="_blank" href="https://yumoe.com">Moricolor</a> / <a href="/atom.xml" data-nopjax="true">RSS</a></p></div></footer><script id="mori-json" type="text/json">{"bottomTools":{"hitokoto":true,"category":true,"tag":false,"search":true},"comment":{"use":"disqus","shortname":"sora-diary"},"analytics":{"use":"google","id":"UA-70944432-1"},"url":"https://kotori.love"}</script><script src="/assets/app.js?v=4d4ce1c9f3bb6a3e"></script></div></body></html>