<!doctype html><html class="han-la"><head><link rel="manifest" href="/manifest.json"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="renderer" content="webkit"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#16a085"><meta name="description" content="TypeScript React 中的一些坑"><meta name="keywords" content="webpack,react,typescript"><title>TypeScript React 中的一些坑 | あかねぞら</title><link rel="icon shortcut" type="image/ico" href="/favicon.ico"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/assets/app.css?v=e6c0d2acc79754e3"><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="あかねぞら" type="application/atom+xml"></head><body><div id="pjax-container"><div id="main" class="container"><div id="main-post" role="main" itemscope="" itemtype="http://schema.org/BlogPosting"><article class="post" style="padding-top:20px"><h2 itemprop="name headline" style="font-weight:400">TypeScript React 中的一些坑</h2><div class="text-right"><div class="text-bar"><a href="/" class="fui-home"></a><a href="#disqus_thread" class="fui-bubble" data-action="comment-go"></a><a style="font-size:30px;margin-left:1px">·</a><a href="https://twitter.com/intent/tweet?url=https://kotori.love/archives/typescript-react.html" target="_blank" rel="nofollow" data-placement="bottom" data-toggle="tooltip" title="Twitter" class="fui-twitter"></a><a href="https://www.facebook.com/sharer/sharer.php?u=https://kotori.love/archives/typescript-react.html" target="_blank" rel="nofollow" data-placement="bottom" data-toggle="tooltip" title="Facebook" class="fui-facebook"></a></div><div class="post-info"><span class="post-info-n"><a href="/categories/%E7%A7%91%E6%8A%80/">科技</a></span><a href="/tags/webpack/">webpack</a><a href="/tags/react/">react</a><a href="/tags/typescript/">typescript</a><a><time datetime="2020-02-06T11:00:00.000Z">2020-02-06</time></a></div></div><div class="post-content" itemprop="articleBody"><h4 id="使用-ts-ignore忽略某一个props">使用 <code>// @ts-ignore</code> 忽略某一个 props</h4><pre class="language-tsx"><code class="language-tsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NavItem</span></span> 
  <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/test<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">componentClass</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>Link<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span>
  Test
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">NavItem</span></span><span class="token punctuation">&gt;</span></span>
</code></pre><p>如果像这样， <code>NavItem</code> 组件上没有 <code>to</code> 这个属性，很自然的会报错。</p><pre><code>Property &#x27;to&#x27; does not exist on type &#x27;IntrinsicAttributes &amp; IntrinsicClassAttributes&lt;NavItem&gt; &amp; Readonly&lt;NavItemProps&gt; &amp; Readonly&lt;...&gt;&#x27;.ts(2769)
</code></pre><p>然而 TypeScript 只认带双斜杠的 <code>// @ts-ignore</code> ，JSX 代码中写注释的只能通过 <code>{/* */}</code> , 类似这样的代码是不行的呢</p><pre class="language-tsx"><code class="language-tsx"><span class="token operator">&lt;</span>NavItem 
  <span class="token comment">// @ts-ignore</span>
  to<span class="token operator">=</span><span class="token string">&quot;/test&quot;</span>
  componentClass<span class="token operator">=</span><span class="token punctuation">{</span>Link<span class="token punctuation">}</span><span class="token operator">&gt;</span>
  Test
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">NavItem</span></span><span class="token punctuation">&gt;</span></span>
</code></pre><p>正确答案是这样的↓↓↓ ，加 <code>/* prettier-ignore */</code> 的原因是可能格式化后会破坏这种微妙的结构 hhh</p><pre class="language-tsx"><code class="language-tsx"><span class="token punctuation">{</span><span class="token comment">/*
  // @ts-ignore */</span> <span class="token comment">/* prettier-ignore */</span><span class="token punctuation">}</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NavItem</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/test<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">componentClass</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>Link<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span>
  Test
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">NavItem</span></span><span class="token punctuation">&gt;</span></span>
</code></pre><h4 id="React-Router-相关">React Router 相关</h4><p>路由中参数的声明：</p><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> RouteComponentProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react-router&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">IPageRouteInfo</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">IPageProps</span> <span class="token keyword">extends</span> <span class="token class-name">RouteComponentProps</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">IPageRouteInfo</span></span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Page</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">IPageProps</span></span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><p><code>withRouter</code> 装饰器的用法，没找到什么好的方式，我一般这么写（（（</p><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> withRouter<span class="token punctuation">,</span> RouteComponentProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react-router&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">ISearchProps</span> <span class="token keyword">extends</span> <span class="token class-name">Partial</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">RouteComponentProps</span></span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

@<span class="token punctuation">(</span>withRouter <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Search</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ISearchProps</span></span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><h4 id="为第三方库添加声明文件-d-ts">为第三方库添加声明文件 .d.ts</h4><p>有些库时没有声明文件的，需要自己添加添加声明文件。一般在 <code>src/types</code> 中新建一个 <code>模块名.d.ts</code> ，内容如下：</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">&#x27;scroll-to&#x27;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">scrollTo</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> options<span class="token operator">:</span> <span class="token builtin">any</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token keyword">export</span> <span class="token operator">=</span> scrollTo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="使用ESLint取代TSLint">使用 ESLint 取代 TSLint</h4><p>由于 <code>TSLint</code> 已停止维护，推荐使用 <code>ESLint</code> 进行检查。</p><p>需要安装的包：</p><pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> @typescript-eslint/eslint-plugin @typescript-eslint/parser eslint eslint-plugin-react -D
</code></pre><p><code>.eslintrc.js</code> 配置：</p><pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  parser<span class="token operator">:</span> <span class="token string">&#x27;@typescript-eslint/parser&#x27;</span><span class="token punctuation">,</span>
  parserOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    ecmaFeatures<span class="token operator">:</span> <span class="token punctuation">{</span> jsx<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    ecmaVersion<span class="token operator">:</span> <span class="token number">2019</span><span class="token punctuation">,</span>
    sourceType<span class="token operator">:</span> <span class="token string">&#x27;module&#x27;</span><span class="token punctuation">,</span>
    project<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;./tsconfig.json&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    tsconfigRootDir<span class="token operator">:</span> __dirname
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  env<span class="token operator">:</span> <span class="token punctuation">{</span>
    browser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    es6<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    node<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ...</span>
    <span class="token string">&#x27;plugin:@typescript-eslint/eslint-recommended&#x27;</span><span class="token punctuation">,</span>
    <span class="token string">&#x27;plugin:@typescript-eslint/recommended&#x27;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&#x27;@typescript-eslint&#x27;</span><span class="token punctuation">,</span>
    <span class="token string">&#x27;react&#x27;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  settings<span class="token operator">:</span> <span class="token punctuation">{</span>
    react<span class="token operator">:</span> <span class="token punctuation">{</span>
      version<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;react&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>version
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>更多的规则可以查看<a href="https://github.com/typescript-eslint/typescript-eslint/tree/master/packages/eslint-plugin" target="_blank" rel="noopener"> typescript-eslint/typescript-eslint</a>。</p><h4 id="用TypeScript来写webpack配置">用 TypeScript 来写 webpack 配置</h4><p>有<s>强迫症患者</s>的同学可以用 TypeScript 的语法来写 webpack 的配置文件。</p><p>首先是需要安装的包：</p><pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> ts-node webpack webpack-cli webpack-dev-server @types/webpack @types/webpack-dev-server tsconfig-paths -D
</code></pre><p>在项目根目录下创建 <code>tsconfig-node.json</code> ：</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;commonjs&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;es5&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;esModuleInterop&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>创建 <code>webpack.config.ts</code> ：</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> webpack <span class="token keyword">from</span> <span class="token string">&#x27;webpack&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> config<span class="token operator">:</span> webpack<span class="token punctuation">.</span>Configuration <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> config<span class="token punctuation">;</span>
</code></pre><p>冲鸭！！</p><pre class="language-bash"><code class="language-bash">cross-env <span class="token assign-left variable">TS_NODE_PROJECT</span><span class="token operator">=</span><span class="token punctuation">\</span>&quot;tsconfig-node.json<span class="token punctuation">\</span>&quot; <span class="token assign-left variable">NODE_ENV</span><span class="token operator">=</span>development webpack-dev-server --config ./webpack.config.ts
</code></pre></div></article></div><center><div id="postnav"><ul class="pager"><li class="previous"><a href="/"><span class="fui-home"></span></a></li><li class="next" data-action="comment-show"><a href="#"><span class="fui-chat"></span></a></li><li class="previous"><a>Not left !!</a></li><li class="next"><a href="/archives/first-post-2020.html" title="「2020」 除草 (★^O^★)">「2020」 除草 (★^O^★)</a></li></ul></div></center><div id="valine-comments" style="display:none"></div><div class="post-tor-content"><div class="post-tor" id="postTor"><div class="torarc-t"><div class="torarc-tile"><a href="#main-post"><span class="tori tori-first">- TOC -</span></a><br><a href="#使用-ts-ignore忽略某一个props"><span class="torii">使用 // @ts-ignore 忽略某一个 props</span><br></a><a href="#React-Router-相关"><span class="torii">React Router 相关</span><br></a><a href="#为第三方库添加声明文件-d-ts"><span class="torii">为第三方库添加声明文件 .d.ts</span><br></a><a href="#使用ESLint取代TSLint"><span class="torii">使用 ESLint 取代 TSLint</span><br></a><a href="#用TypeScript来写webpack配置"><span class="torii">用 TypeScript 来写 webpack 配置</span><br></a></div></div></div></div></div><footer id="footer" class="container" style="background:rgba(255,255,255,0)"><hr><div style="text-align:center;padding-bottom:9px"><p>© 2014 - 2020 <a href="/">あかねぞら</a>. Using <a target="_blank" href="https://hexo.io/">Hexo</a>  &amp; <a target="_blank" href="https://yumoe.com">Moricolor</a> / <a href="/atom.xml" data-nopjax="true">RSS</a></p></div></footer><script id="mori-json" type="text/json">{"bottomTools":{"hitokoto":true,"category":true,"tag":false,"page":true,"search":true},"style":{"color":{"enabled":false,"colors":["#f48fb1","#f48fb1","#f8bbd0"]}},"comment":{"use":"valine","appId":"ikbNNOUhw2U2KuYFXgcfb9GP-MdYXbMMI","appKey":"ggySdQdQ8EC21u2PXS8iOQNp"},"github":"https://github.com/kokororin","analytics":{"use":"google","id":"UA-70944432-1"},"sentry":{"dsn":"https://7bdda1be9b094ef0b6ff3c364024537c@sentry.io/2406563"}}</script><script src="/assets/app.js?v=897bd8f3fa35c080"></script></div></body></html>